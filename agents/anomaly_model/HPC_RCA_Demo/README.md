# HPC Root Cause Analysis API

è¯¥é¡¹ç›®å®ç°äº†ä¸€ä¸ªç”¨äºè¶…ç®—ç³»ç»Ÿå¤±è´¥ä½œä¸šæ ¹å› è®¡ç®—ç»“ç‚¹å®šä½çš„ç®—æ³•ï¼Œå¹¶é€šè¿‡ RESTful API å¯¹å¤–æä¾›æœåŠ¡ã€‚
ç®—æ³•åŸºäºè·¨å±‚çº§å› æœå…³ç³»å›¾ï¼ˆè®¡ç®—ç»“ç‚¹çº§ + æŒ‡æ ‡çº§ï¼‰ï¼Œä½¿ç”¨éšæœºæ¸¸èµ°ï¼ˆPersonalized PageRankï¼‰æ–¹æ³•ï¼Œè¯†åˆ«æœ€å¯èƒ½å¯¼è‡´ä½œä¸šå¤±è´¥çš„è®¡ç®—ç»“ç‚¹ã€‚

---

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

- ğŸ“Š è‡ªåŠ¨åŠ è½½ç›‘æ§æŒ‡æ ‡æ•°æ®ï¼ˆCSVæ ¼å¼ï¼‰
- ğŸ§  æ„å»ºå› æœå›¾ï¼ˆä½¿ç”¨ PCMCI ä¸æ»åç›¸å…³æ€§ï¼‰
- ğŸ” ä¾æ®å¼‚å¸¸ç¨‹åº¦åˆ†å¸ƒè¿›è¡Œ Personalized PageRank æ’å
- ğŸŒ æä¾›æ ‡å‡† RESTful API æ¥å£ï¼Œä¾¿äºé›†æˆè°ƒç”¨
- ğŸ“¦ æ”¯æŒå¯é…ç½®å‚æ•°ï¼šæ—¶é—´çª—å£ã€å…³é”®æŒ‡æ ‡ã€Top-K

---

## ğŸ“¥ è¾“å…¥æ•°æ®è¯´æ˜

ç®—æ³•æœŸæœ›çš„æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š

- è¾“å…¥ç›®å½• `folder_path` ä¸‹åº”åŒ…å«å¤šä¸ª CSV æ–‡ä»¶ï¼Œæ¯ä¸ªæ–‡ä»¶å¯¹åº”ä¸å¤±è´¥ä½œä¸šç›¸å…³çš„ä¸€ä¸ªè®¡ç®—ç»“ç‚¹ä¸Šé‡‡é›†çš„æŒ‡æ ‡ï¼›
- æ–‡ä»¶åæ ¼å¼å»ºè®®ä¸ºï¼š`<node_id>_<metric_name>.csv`ï¼›
- æ¯ä¸ª CSV æ–‡ä»¶å¿…é¡»åŒ…å«ä»¥ä¸‹ä¸¤åˆ—ï¼š

|      timestamp      | metric_name |
| :-----------------: | :---------: |
| 2025-06-14 22:49:00 |    0.75    |
| 2025-06-14 22:49:15 |    0.78    |
|         ...         |     ...     |

ç¤ºä¾‹ï¼ˆ`cn61903.csv`ï¼‰ï¼š

```csv

timestamp,node_arp_entries,...

2025-06-14 22:49:00,250,...

2025-06-14 22:49:15,250,...

...

```

æ‰€æœ‰æŒ‡æ ‡å°†ç»Ÿä¸€æŒ‰æ—¶é—´å¯¹é½ã€‚

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

### 2. å¯åŠ¨ API æœåŠ¡

```bash
uvicorn rca_api:app --reload --port 8000
```

---

## ğŸ“® æ¥å£ç¤ºä¾‹

### POST `/locate_root_cause`
`ï¼ˆä¾‹å¦‚ï¼šhttp://localhost:8000/locate_root_causeï¼‰`

```json
{
  "folder_path": "dataset",
  "job_id": "job_8113170",
  "failure_start": 1750129350,
  "failure_end": 1750129800,
  "failure_type": "network_bandwidth",
  "root_node": "cn61903",
  "golden_metrics": [],
  "top_k": 5
}
```

### è¿”å›ç»“æœ

```json
{
    "0": {
        "root_cause": "cn61903",
        "failure_type": "network_bandwidth",
        "top5": [
            [
                "cn61903:node_network_receive_bytes_total",
                0.28562277213130355
            ],
            [
                "cn61897:node_network_receive_bytes_total",
                0.24051390654043306
            ],
            [
                "cn61900:node_network_receive_bytes_total",
                0.23787163220132634
            ],
            [
                "cn61901:node_network_receive_bytes_total",
                0.05299224046255312
            ],
            [
                "cn61901:node_network_transmit_bytes_total",
                0.02971055174070751
            ]
        ]
    }
}
```

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„è¯´æ˜

```bash
â”œâ”€â”€ hpc_rca.py            # æ ¹å› åˆ†æä¸»é€»è¾‘
â”œâ”€â”€ rca_api.py            # FastAPI æ¥å£æœåŠ¡å®šä¹‰
â”œâ”€â”€ dataset/              # ç¤ºä¾‹æ•°æ®æ–‡ä»¶å¤¹
â”œâ”€â”€ images/               # ç»“ç‚¹çº§&æŒ‡æ ‡çº§å› æœå…³ç³»å›¾
â”œâ”€â”€ README.md             # ä½¿ç”¨è¯´æ˜ï¼ˆå½“å‰æ–‡ä»¶ï¼‰
â”œâ”€â”€ requirements.txt      # ä¾èµ–åŒ…åˆ—è¡¨
```

---

## ğŸ“œ å¼•ç”¨æŠ€æœ¯

- FastAPI
- NetworkX
- Tigramiteï¼ˆPCMCIå› æœå‘ç°ï¼‰
- Scikit-learn
- Pandas / Numpy

---

## ğŸ“§ è”ç³»

ä½œè€…ï¼šé™¶ç£Šï¼ˆleitao@mail.nankai.edu.cnï¼‰
å•ä½ï¼šå—å¼€å¤§å­¦ è½¯ä»¶å­¦é™¢
