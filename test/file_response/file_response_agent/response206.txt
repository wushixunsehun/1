{
    "query": "在VASP并行优化中，KPAR、NPAR、NCORE各自代表什么含义？它们之间是如何协同影响VASP整体并行效率的？",
    "summaries": [
        "该文本介绍了VASP中并行计算参数NCORE和KPAR的作用与设置方法。NCORE表示处理单个轨道的计算核心数，而KPAR用于将k点分配给不同的核心组。NCORE和NPAR共同决定并行方式，其中NPAR优先级更高。默认情况下，NCORE=1，适用于小单元和少量核心，但会增加内存需求和通信开销。在大规模并行系统上，建议将NCORE设为每插槽或节点的核心数，以提高性能和稳定性。当使用LMP2LT或LSMP2LT时，KPAR将不再适用。",
        "本文讨论了VASP中KPAR、NPAR、NCORE参数对单节点计算速度的影响。通过多个算例分析得出结论：KPAR×NPAR×NCORE应等于总核数以获得最佳性能；在单节点情况下，KPAR×NPAR越小，计算速度越快，这表明NCORE越大越有利于提高效率。该结论与之前的研究结果一致。",
        "NCORE的取值范围较小，适应性更强，通常4适合100原子单元，12-16适合400以上原子。VASP默认参数低效，优化参数可提升并行效率。当单节点核心数能被NCORE整除时，可减少BAND通信，提升效率。编译方面，Intel+IMPI+MKL性能优于GNU，3F系统OpenBLAS优于LAPACK/BLAS。官网建议仅供参考，实际需测试。"
    ],
    "contents": [
        "fashion. This means that a group of *N*=(# of cores/KPAR) compute cores together work on an individual **k**-point (choose KPAR such that it is an integer divisor of the total number of cores). Within this group of *N* cores that share the work on an individual **k**-point, the usual parallelism over bands and/or plane wave coefficients applies (as set by means of the [NCORE](https://www.vasp.at/wiki/index.php/NCORE) and [NPAR](https://www.vasp.at/wiki/index.php/NPAR) tags).\n**Note**: the data is not distributed additionally over **k**-points.\n**Note**: KPAR becomes obsolete if [LMP2LT](https://www.vasp.at/wiki/index.php/LMP2LT) or [LSMP2LT](https://www.vasp.at/wiki/index.php/LSMP2LT) are set and specifies the number of plane-waves treated in parallel, see [here](https://www.vasp.at/wiki/index.php/LTMP2Tutorial#Parallelization) for more information.\nNCORE\n[Jump to navigation](https://www.vasp.at/wiki/index.php/NCORE#mw-head)[Jump to search](https://www.vasp.at/wiki/index.php/NCORE#searchInput)\nNCORE = [integer]\nDefault: **NCORE** = 1\nDescription: NCORE determines the number of compute cores that work on an individual orbital (available as of VASP.5.2.13).\nVASP currently offers parallelization and data distribution over",
        "【已解决】vasp KPAR, NPAR, NCORE 对计算速度影响的进一步讨论-单节点\n**标签**: vasp\n**创建时间**: 2023-11-06 16:56:09\n**更新时间**: 2023-11-07 11:13:20\n**作者**: 梁言\n广\n20000\nTIME(s)\n图1 算例1 单节点56核\nX\n| ty\ni\nxe)\n\\\n,          fix\nRWVY\nuy\nuid\n¢\nH\n4000\n/\n了\n000\nSo\n图2 算例2 单节点32核\nONS\n/     A\nbik\nt   Ny\nS\nS\nS\nCA\n了\nSo\n图3 算例3 单节点32核\n**结论：\nKPAR   NAPR   NCORE 三者相乘最好等于核数\n单节点时，KPAR x NAPR 越小越快\n二者相乘越小，也代表NCORE越大，与之前的结论相互印证。**",
        "the number of compute cores that work on an individual orbital (available as of VASP.5.2.13).\nVASP currently offers parallelization and data distribution over bands and/or over plane wave coefficients, and as of VASP.5.3.2, parallelization over **k**-points (no data distribution, see [KPAR](https://www.vasp.at/wiki/index.php/KPAR)). To achieve high efficiency on massively parallel systems or modern multi-core machines, it is strongly recommended to use all parallelization options available. Most algorithms work with any data distribution (except for the single band conjugated gradient, which is obsolete).\nNCORE is available from VASP.5.2.13 on, and is more handy than the previous parameter [NPAR](https://www.vasp.at/wiki/index.php/NPAR). The user should either specify NCORE or [NPAR](https://www.vasp.at/wiki/index.php/NPAR), where [NPAR](https://www.vasp.at/wiki/index.php/NPAR) takes a higher preference. The relation between both parameters is\nNCORE =number-of-cores /KPAR / NPAR\nNCORE determines how many cores share the work on an individual orbital. The current default is NCORE=1, meaning that one orbital is treated by one core. [NPAR](https://www.vasp.at/wiki/index.php/NPAR) is then set to the total number of cores (divided by KPAR). If NCORE equals the total number of cores, [NPAR](https://www.vasp",
        "-cores-per-socket (or number-of-cores-per-node), since this reduces communication between the sockets or nodes. The best value NCORE depends somewhat on the number of atoms in the unit cell. Values around 4 are usually ideal for 100 atoms in the unit cell. For very large unit cells (more than 400 atoms) values around 12-16 are often optimal. If you run extensive simulations for similar systems, make your own tests.\n- Massively parallel machines with dedicated network (maybe Cray):\nLPLANE = .FALSE.\nNPAR   = sqrt(number of cores)\nNSIM   = 1\n官网建议仅供参考，很多情况并不是最优。\n总结\n1. NCORE 比NPAR 具有更小的最优取值空间，可以更好的适应不同的并行核心数与节点硬件；\n2. VASP 默认并行参数（KPAR=1 & NCORE=1）非常低效，最优的运行参数可大大提高并行扩展性与运行速度；\n3. 当单节点核心数可被NCORE 整除时，能够在部分多节点计算算例中增加效率；\n单节点核心数可被NCORE 整除时，可使BAND 并行通信限制在节点内，理论上总会带来好处。实践上，在单KPOINT 多节点算例中，BAND 通信影响较小，原因可解释为多节点的单KPOINT 计算本身的通讯时间很长，抑制了“可整除”带来的BAND 并行通讯降低的好处。\n4. 编译方面，HPC系统，intel +IMPI+MKL性能优于GNU；3F系统openblas优于lapack/blas;",
        "to the total number of cores (divided by KPAR). If NCORE equals the total number of cores, [NPAR](https://www.vasp.at/wiki/index.php/NPAR) is set to 1. This implies data distribution over plane wave coefficients only: all cores will work together on every individual band, i.e., the plane wave coefficients of each band are distributed over all cores. This is usually very slow and should be avoided.\nNCORE=1 is the optimal setting for small unit cells, and platforms with a small communication bandwidth. It is also a good choice for up to 8 cores. However, this mode substantially increases the memory requirements, because the non-local projector functions must be stored entirely on each core. In addition, substantial all-to-all communications are required to orthogonalize the bands.\nOn massively parallel systems and modern multi-core machines we strongly recommend to set\nNCORE = 2 up to number-of-cores-per-socket (or number-of-cores-per-node)\nFor large unit cells, we found that this can improve the performance by up to a factor four compared to the default, and it also significantly improves the stability of the code due to reduced memory requirements. Ideally, NCORE should be a factor of the number-of-cores-per-socket (or number-of-cores-per-node), since this reduces communication between the sockets or nodes. The best value NCORE depends"
    ]
}