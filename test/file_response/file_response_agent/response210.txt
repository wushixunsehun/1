{
    "query": "VASP运行报错 internal error in SETUP_DEG_CLUSTERS: NB_TOT exceeds NMAX_DEG 如何解决？",
    "summaries": [
        "【已解决】EX运行vasp报错NB_TOT exceeds NMAX_DEG。错误提示需将NMAX_DEG增加至82。解决方法是修改源码中NMAX_DEG参数并重新编译。具体步骤包括加载编译器和库，解压VASP源码，使用sed命令修改subrot_cluster.F文件中的NMAX_DEG值，调整makefile.include配置，最后执行make编译。",
        "该问题为VASP计算中出现的“old and the new charge density differ”报错，使用三星内存可解决。建议前往HPC4平台进行计算，并调整INCAR参数，如设置NPAR=15以调用15个节点。输入文件仅保留四个，同时配置DFT-D3修正、电子和离子松弛参数，确保收敛条件合理。",
        "HPC4平台成功部署VASP 5.3.5，包括标准版和NEB版本。安装过程涉及加载Intel编译器、MPI、MKL和FFTW环境，编译VASP库和主程序，修改makefile配置以适配环境。NEB版本额外需下载并集成VTST工具，修改main.F文件及makefile添加相关模块。整个过程解决了编译警告，确保VASP正常运行。"
    ],
    "contents": [
        "fftw3d.o  fft3dlib.o   $(MKL_FFTW_PATH)/libfftw3xf_intel.a\n< INCS = -I$(MKLROOT)/include/fftw\n> #FFT3D   = fftmpiw.o fftmpi_map.o  fftw3d.o  fft3dlib.o   $(MKL_FFTW_PATH)/libfftw3xf_intel.a\n> #INCS = -I$(MKLROOT)/include/fftw\nmake\n结束！\nvasp5.3.5 -neb 安装\n在vasp.3.5基础上增加部分：\n- 在VTST官网上下载vtstcode以及vtstscripts文件夹，http://theory.cm.utexas.edu/vtsttools/installation.html.\n- 将vtstcode以及vtstscripts文件下的所有文件，全部复制到vasp5.3文件夹下，覆盖。\n- 更改main.F文件\nCALL CHAIN_FORCE(T_INFO%NIONS,DYN%POSION,TOTEN,TIFOR, &\nLATT_CUR%A,LATT_CUR%B,IO%IU6)\n改为\nCALL CHAIN_FORCE(T_INFO%NIONS,DYN%POSION,TOTEN,TIFOR, &\nTSIF,LATT_CUR%A,LATT_CUR%B,IO%IU6)\n-  在makefile中chain.o之前添添加：\nbfgs.o dynmat.o instanton.o lbfgs.o sd.o  cg.o dimer.o bbm.o \\\nfire.o lanczos.o neb.o qm.o opt.o \\\n修改配置文件\ncp makefile.linux_ifc_P4 makefile\n修改内容如下：\nvasp.5.3-neb]$ diff makefile makefile.linux_ifc_P4\n99c99\n<           -DCACHE_SIZE=12000 -DPGF90 -Davoidalloc \\\n>           -DCACHE_SIZE=12000 -DPGF90 -Davoidalloc -DNGXhalf \\\n139c139\n< MKLROOT=/fs1/software/intel/2020.2/mkl\n>\n149c149\n< BLAS=   -mkl\n> BLAS= -lguide  -mkl\n205,206c205,206\n< FC=mpif90 -f90=ifort\n< FCL=",
        "= $(CPP_) -DMPI  -DHOST=\\\"LinuxIFC\\\" -DIFC \\\n<      -DCACHE_SIZE=4000 -DPGF90 -Davoidalloc  \\\n<      -DMPI_BLOCK=8000 -Duse_collective -DscaLAPACK\n< #    -DRPROMU_DGEMV  -DRACCMU_DGEMV\n> #CPP    = $(CPP_) -DMPI  -DHOST=\\\"LinuxIFC\\\" -DIFC \\\n> #     -DCACHE_SIZE=4000 -DPGF90 -Davoidalloc -DNGZhalf \\\n> #     -DMPI_BLOCK=8000 -Duse_collective -DscaLAPACK\n> ##    -DRPROMU_DGEMV  -DRACCMU_DGEMV\n234,235c234,235\n< BLACS= -lmkl_blacs_intelmpi_lp64\n< SCA= $(MKL_PATH)/libmkl_scalapack_lp64.a $(BLACS)\n> #BLACS= -lmkl_blacs_openmpi_lp64\n> #SCA= $(MKL_PATH)/libmkl_scalapack_lp64.a $(BLACS)\n241,243c241,243\n< LIB     = -L../vasp.5.lib -ldmy  \\\n<       ../vasp.5.lib/linpack_double.o \\\n<       $(SCA) $(LAPACK) $(BLAS)\n> #LIB     = -L../vasp.5.lib -ldmy  \\\n> #      ../vasp.5.lib/linpack_double.o \\\n> #      $(SCA) $(LAPACK) $(BLAS)\n257,258c257,258\n< FFT3D   = fftmpiw.o fftmpi_map.o  fftw3d.o  fft3dlib.o   $(MKL_FFTW_PATH)/libfftw3xf_intel.a\n< INCS = -I$(MKLROOT)/include/fftw\n> #FFT3D",
        "(Write CHGCAR or not)\nADDGRID= .TRUE.        (Increase grid, helps GGA convergence)\n# LVTOT  = .TRUE.      (Write total electrostatic potential into LOCPOT or not)\n# LVHAR  = .TRUE.      (Write ionic + Hartree electrostatic potential into LOCPOT or not)\n# NELECT =             (No. of electrons: charged cells, be careful)\n# LPLANE = .TRUE.      (Real space distribution, supercells)\n# NWRITE = 2           (Medium-level output)\n# KPAR   = 2           (Divides k-grid into separate groups)\n# NGXF    = 300        (FFT grid mesh density for nice charge/potential plots)\n# NGYF    = 300        (FFT grid mesh density for nice charge/potential plots)\n# NGZF    = 300        (FFT grid mesh density for nice charge/potential plots)\nElectronic Relaxation\nISMEAR =  0            (Gaussian smearing, metals:1)\nSIGMA  =  0.1         (Smearing value in eV, metals:0.2)\nNELM   =  100           (Max electronic SCF steps)\nNELMIN =  6            (Min electronic SCF steps)\nEDIFF  =  1E-04        (SCF energy convergence, in eV)\n#",
        "【已解决】EX运行vasp报错NB_TOT exceeds NMAX_DEG\n**标签**: 无标签\n**创建时间**: 2024-08-27 15:34:31\n**更新时间**: 2024-08-27 15:34:31\n**作者**: 陈维耀\n参考：https://blog.csdn.net/icehoqion/article/details/139435321\n**报错**：\ninternal error in SETUP_DEG_CLUSTERS: NB_TOT exceeds NMAX_DEG\nincrease NMAX_DEG to          82\n**解决**：修改源码`NMAX_DEG`参数重编\nmodule purge\nmodule load Intel_compiler/19.0.4\nmodule load MPI/openmpi/4.1.2-mpi-x-icc19.0\nmodule load MKL/19.1.2\npv vasp.5.4.4.tar.gz | tar xzf -\ncd vasp.5.4.4\nsed -i \"s/NMAX_DEG=48/NMAX_DEG=480/\" src/subrot_cluster.F\ncp arch/makefile.include.linux_intel makefile.include\nsed -i \"s/mpiifort/mpifort/\" makefile.include\n# openmp\nsed -i \"s/-mkl=sequential/-qopenmp -mkl=sequential/\" makefile.include\n# mkl\nsed -i \"s/-lmkl_blacs_intelmpi_lp64/-lmkl_blacs_openmpi_lp64 -lmkl_gf_ilp64 -lmkl_core -lmkl_gnu_thread/\" makefile.include\nmake",
        "【已解决】 HPC4部署vasp 5.3.5\n**标签**: vasp hpc4 5.3.5 neb vtst\n**创建时间**: 2021-11-12 17:30:53\n**更新时间**: 2021-11-17 16:22:58\n**作者**: 刘栋杰\nHPC4安装vasp 5.3.5\n加载环境\n1) Intel_compiler/19.1.2(default)   2) MPI/Intel/IMPI/2019.8.254(default)   3) MKL/19.1.2(default)   4) fftw/3.3.10-icc19.1-IMPI2019.8\n标准版编译\n安装 vasp.5.lib\ntar zxvf vasp.5.lib.tar.gz\ncd vasp.5.lib\nmv makefile.linux_ifc_P4 makefile\nvim makefile\nFC=ifc 改为 FC=ifort\nmake 2>&1 | tee make.LOG\n备注：可能会遇到 warning，可以忽略。\n安装 vasp.5.3.5\ntar zxvf vasp.5.3.5.tar.gz\ncd vasp.5.3\n修改配置文件\ncp makefile.linux_ifc_P4 makefile\n修改内容如下：\nvasp.5.3]$ diff makefile makefile.linux_ifc_P4\n99c99\n<           -DCACHE_SIZE=12000 -DPGF90 -Davoidalloc \\\n>           -DCACHE_SIZE=12000 -DPGF90 -Davoidalloc -DNGXhalf \\\n139c139\n< MKLROOT=/fs1/software/intel/2020.2/mkl\n>\n149c149\n< BLAS=   -mkl\n> BLAS= -lguide  -mkl\n205,206c205,206\n< FC=mpif90 -f90=ifort\n< FCL=$(FC)\n> #FC=mpif90\n> #FCL=$(FC)\n223,226c223,226\n< CPP    = $(CPP_) -DMPI  -DHOST=\\\"LinuxIFC\\\" -DIFC \\\n<      -DCACHE_SIZE=4000 -DPGF90 -Davoidalloc",
        "【已解决】 vasp  very serious problems  the old and the new charge density differ 报错\n**标签**: 无标签\n**创建时间**: 2024-11-27 16:50:09\n**更新时间**: 2024-12-10 15:43:47\n**作者**: 梁言\n仅针对这个报错，使用三星内存可以计算。如遇到相同问题，建议去HPC4\n调整INCAR 参数也许有效\n原程序 vasp641-openmpi-wannier-opt-vtst-sol\n新程序 vasp641-mpich\n同时INCAR 增加NPAR = 15 （调用15个节点）\n只保留四个输入文件提交\n###\nDFT-D3 Correction\nIVDW   =  11           (DFT-D3 method of method with no damping)\nNPAR = 15\nGlobal Parameters\nISTART =  1            (Read existing wavefunction, if there)\nISPIN  =  1            (Non-Spin polarised DFT)\n# ICHARG =  11         (Non-self-consistent: GGA/LDA band structures)\nLREAL  = Auto       (Projection operators: automatic)\nENCUT  =  300        (Cut-off energy for plane wave basis set, in eV)\nPREC   =  Normal   (Precision level: Normal or Accurate, set Accurate when perform structure lattice relaxation calculation)\nLWAVE  = F        (Write WAVECAR or not)\nLCHARG = F        (Write CHGCAR or not)\nADDGRID= .TRUE.        (Increase grid, helps GGA convergence)\n# LVTOT  = .TRUE.",
        "(Min electronic SCF steps)\nEDIFF  =  1E-04        (SCF energy convergence, in eV)\n# GGA  =  PS           (PBEsol exchange-correlation)\nIonic Relaxation\nNSW    =  200          (Max ionic steps)\nIBRION =  2            (Algorithm: 0-MD, 1-Quasi-New, 2-CG)\nISIF   =  2            (Stress/relaxation: 2-Ions, 3-Shape/Ions/V, 4-Shape/Ions)\nEDIFFG = -1E-02        (Ionic convergence, eV/AA)\n# ISYM =  2            (Symmetry: 0=none, 2=GGA, 3=hybrids)\nAMIN = 0.01\nNCORE = 28"
    ]
}