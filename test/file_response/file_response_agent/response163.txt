{
    "query": "如何为lisn用户开通ssh到服务器节点的权限？",
    "summaries": [
        "EX系统使用ssh时出现OPENSSL_1_1_1b报错，解决方法是在~/.bashrc中添加export LD_LIBRARY_PATH=/usr/lib64:$LD_LIBRARY_PATH。",
        "文本内容主要涉及Linux系统中OpenSSL和SSH的版本信息、安装过程中遇到的错误及解决方法、系统安全加固措施，包括欢迎信息配置、禁止使用su、密码复杂度设置、密码锁定机制等。重点包括配置文件修改和相关命令的使用。",
        "用户在使用ssh连接计算节点时出现错误：ssh: symbol lookup error: ssh: undefined symbol: EVP_KDF_ctrl, version OPENSSL_1_1_1b。原因是加载了Anaconda环境，修改了LD_LIBRARY_PATH，导致ssh动态链接了Anaconda中的库而非系统库。通过检查ldd输出发现，ssh依赖的libcrypto.so.1.1和其它库均来自Anaconda路径，而非系统/lib64目录。解决方法是避免在环境变量中引入Anaconda库，确保ssh使用系统标准库。"
    ],
    "contents": [
        "or additional information, please contact:*\\n\"\nprintf \"*\\e[1;33m support@nscc-tj.cn (Hardware) / service@nscc-tj.cn (Software)* \\e[0m\\n\"\nprintf \"*******************************************************************\\n\"\n\n###Redhat登录节点####\n\n$ cat /etc/motd.d/welcome \n*******************************************************************\n* Welcome to NSCC-TJ Supercomputer System.*\n* For questions or additional information, please contact:*\n* support@nscc-tj.cn (Hardware) / service@nscc-tj.cn (Software)*\n*******************************************************************\n2.5.2 用户禁止使用su\n$ vim /etc/pam.d/su\n15 authrequiredpam_wheel.so\n2.5.3 用户密码复杂度\n# 登录节点需安装\n###Ubuntu######\n$ apt install libpam-pwquality\n$ vim /etc/pam.d/common-password\n25 passwordrequisitepam_pwquality.sotry_first_pass minlen=12 difok=5 retry=3 minclass=3\n###REDHAT######\nvim /etc/pam.d/password-auth\nauthrequiredpam_env.so\nauthrequiredpam_faillock.so even_deny_root preauth silent",
        "【已解决】ssh到计算节点报错：ssh: symbol lookup error: ssh: undefined symbol: EVP_KDF_ctrl, version OPENSSL_1_1_1b\n**标签**: ssh\n**创建时间**: 2021-11-10 17:03:13\n**更新时间**: 2021-11-10 17:39:46\n**作者**: 聂鹏飞\n用户ssh到计算节点时报错：\nssh: symbol lookup error: ssh: undefined symbol: EVP_KDF_ctrl, version OPENSSL_1_1_1b\n原因：加载系统上的anaconda环境时，修改了LD_LIBRARY_PATH，使ssh动态链接了anaconda下面的库，而没有用/lib64下面的\n(/fs1/home/zhaof3/software/cwatm-py) [zhaof3@th-hpc4-ln0 ~]$ ldd /usr/bin/ssh\nlinux-vdso.so.1 (0x00007ffd00efe000)\n/usr/local/lib/libth.so (0x000014b138750000)\nlibcrypto.so.1.1 => /fs1/software/python/3.8_anaconda_2021.05/lib/libcrypto.so.1.1 (0x000014b138484000) # 比如\nlibdl.so.2 => /lib64/libdl.so.2 (0x000014b138280000)\nlibutil.so.1 => /lib64/libutil.so.1 (0x000014b13807c000)\nlibz.so.1 => /fs1/software/python/3.8_anaconda_2021.05/lib/libz.so.1 (0x000014b138e17000) # 比如\nlibcrypt.so.1 => /lib64/libcrypt.so.1 (0x000014b137e53000)\nlibresolv.so.2 => /lib64/libresolv.so.2 (0x000014b137c3c000)\nlibselinux.so.1 => /lib64/libselinux.so.1 (0x000014b137a12000)\nlibgssapi_krb5.so.2 => /fs1/software/python/3.8_anaconda_2021.05/lib/libgssapi_krb5.so.2 (0x000014b138dc2000) # 比如\nlibkrb5.so.3 => /fs1/software/python/3.8_anaconda_2021.05/lib/libkrb5.so.3 (0x000014b138cef000) # 比如\nlibk5crypto.so.3 => /fs1/software/python/3.8_anaconda_2021.05/",
        "【已解决】EX系统ssh报错OPENSSL_1_1_1b\n**标签**: 无标签\n**创建时间**: 2023-09-07 14:06:45\n**更新时间**: 2023-09-07 14:06:45\n**作者**: 张天奇\n在~/.bashrc中添加：\nexport LD_LIBRARY_PATH=/usr/lib64:$LD_LIBRARY_PATH",
        "=5 retry=3 minclass=3\n###REDHAT######\nvim /etc/pam.d/password-auth\nauthrequiredpam_env.so\nauthrequiredpam_faillock.so even_deny_root preauth silent auditdeny=5 unlock_time=1800\nauthrequiredpam_faildelay.so delay=2000000\nauth[default=1 ignore=ignore success=ok]pam_usertype.so isregular\nauth[default=1 ignore=ignore success=ok]pam_localuser.so\nauthsufficientpam_unix.so nullok try_first_pass\nauth[default=1 ignore=ignore success=ok]pam_usertype.so isregular\n#authsufficientpam_sss.so forward_pass\nauthsufficientpam_ldap.so try_first_pass\nauthrequiredpam_deny.so\nauth[default=die]pam_faillock.so authfail audit deny=5 unlock_time=1800\nminlen=12 密码不能少于12位\nretry=3错误3次提示\nminclass=3 最少3中字符组合 \ndifok=5 至少有5个字符不能和旧密码一样\n2.5.4 用户密码锁定\n# ubuntu系统使用这种方式\n$ vim /etc/pam.d/sshd\nauth required pam_tally2.so deny=5 onerr=fail audit unlock_time=600 even_deny_root root_unlock_time=1800\n# redhat\nvim /etc/pam.d/password-auth\nauthrequiredpam_env.so\nauthrequiredpam_faillock.so even_deny_root preauth silent auditdeny=5 unlock_time=1800\nauthrequiredpam_faildelay.so delay=2000000\nauth[default=1 ignore=ignore success=ok]pam_usertype.so isregular\nauth[default=1 ignore=ignore success=ok]pam_localuser.so\nauthsufficientpam_unix.so nullok try_first_pass\nauth[default=1 ignore=ignore success=ok]pam_usertype.so isregular\n#authsufficientpam_sss.so forward_pass\nauthsufficientpam_ldap.so try_first_pass\nauthrequiredpam_deny.so\nauth[default=die]pam_faillock.so authfail audit deny=5",
        "usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin:/usr/local/openssl/bin\n8.查看版本\n# openssl version\nOpenSSL 1.1.1m 14 Dec 2021\n# ssh -V\nOpenSSH_8.2p1 Ubuntu-4ubuntu0.2, OpenSSL 1.1.1m 14 Dec 2021\n9.错误记录\n(1)编译安装过程在设置完架构后，还需要再执行一遍\n./config --prefix=/usr/local/openssl\napt remove openssl之后ssh功能失效\n(2)经常查看日志，找到是ldap有问题，部分缺失\n# tail -f /var/log/sec\n# tail -f /var/log/openvpn/\n# tail -f /var/log/syslog\n# cd /var/log/\n# tail -f auth.log\n(3)对比ln5和ln4上安装的ldap，安装缺失的ldap程序\n# ldd /lib/security/pam_ldap.so\n# ldd /usr/lib/aarch64-linux-gnu/security/pam_ldap.so\n# dpkg -l |grep ldap\n# apt install libnscc-ldapd\n# apt install libnss-ldapd\n2.5系统安全加固\n2.5.1 欢迎信息配置\n# Ubantu 登录节点\n\n$ vim /etc/update-motd.d/welcome\n#!/bin/sh\n\nprintf \"*******************************************************************\\n\"\nprintf \"* Welcome to NSCC-TJ Supercomputer System.*\\n\"\nprintf \"* For questions or additional information, please contact:*\\n\"\nprintf \"*\\e[1;33m support@nscc-tj.cn (Hardware) / service@nscc-tj.cn"
    ]
}