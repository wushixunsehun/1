{
    "query": "TH-3M1 上，nankai 用户运行 dsp 程序导致系统 MDS（元数据服务器）宕机。给出可能的原因？和排查步骤。",
    "summaries": [
        "系统出现多个故障，包括TH-3F的握手次数变化、TH-HPC的raid1和raid2超时故障。集群总览页面整合了节点、作业和存储信息。运维平台用于处理故障，值班人员可通过登录平台查看报警信息并执行操作。Lustre存储故障处理包括挂起作业、查询日志、重启节点等步骤。",
        "当命令执行时，可能返回“无法找到文件”错误并永久删除MDS上的文件。无法在文件系统未挂载时直接解析MDS元数据。若OST故障，可使用循环OST或新格式化OST替换。此时丢失的对象会被创建并读取为零。每个OST包含LAST_ID文件，记录MDS预创建的最后一个对象。MDT中的lov_objid表示MDS分配给文件的最后一个对象。LAST_ID应大于lov_objid，否则可能导致对象创建问题。从Lustre 2.5开始，MDS会自动同步LAST_ID和lov_objid。从2.6开始，LFSCK可自动修复LAST_ID文件。若磁盘损坏或恢复，LAST_ID可能不一致，导致错误信息。此时MDS会调整lov_objid以避免删除数据。未被引用的对象将在下次LFSCK时放入lost+found目录。启动Lustre时可能出现“bind: Address already in use”错误，需确保先启动Lustre再启动portmap服务，或更改端口。错误-28（ENOSPC）表示OST空间不足，可通过扩展空间或迁移文件解决。",
        "该文本描述了节点列表和相关系统状态信息，包括节点数量、核心数、分区状态等。部分节点出现异常日志，如dmesg输出显示错误信息，涉及网络设备和内存分配问题。同时，有操作记录显示取消了test预约并尝试释放节点。"
    ],
    "contents": [
        "18229-18259. 18261-18272. 18274-18334. 1833\n6-18362 18365-18366 18368-18371 18373-18379 18381-18382 . 18384-18398, 18400-18431]\n\nLroot@mn6 “1#\n取消test预约。\nCroot@mn6 “]# yhcontrol delete reservation=test\nCroot@mn6 “]# yhcontrol show reservation test\nReservation test not found\n14）放出节点\n检查节点dmesg，看看有无异常信息，执行：clush-w $nodelist\"dmesg-T\"\n[rootemn6“]# clush -wu cn[17408-17419.17421-17444.17446-17467.17469-17475.17478-17483.17485-17515.17517-17524.17526-17531.17533-175\n39.17541-17555.17557-17571.17573-17582.17584-17607.17616-17644.17646-17659.17661-17942.17953-17968.17970-17975.17977-17991.18000-180\n13.18015-18061.18063-18143.18148-18152.18154-18183.18192-18227.18229-18259.18261-18272.18274-18334.18336-18362.18365-18366.18368-183\n71.18373-18379.18381-18382.18384-18398.18400-18420.18429-18431] “dmesg -T\"\n\ncn17953: [Tue May20221 zni_dev 0000:01:00.0: _intr. new FPQ packet:\n\ncn17953: [Tue May2022] [ERR_PKT]: class=1:¥C0, type=2:¥P_ACCESS.\n\ncn17953: [Tue May2022] flit[00]: 0x0000142301100400.2801200000004000.0000618045062b49.38e2000135045081\n\ncn17953: [Tue May2022] flit[01]: 0x0000000000001647.fb74000000000000.000040000000001d.000000000061b978\n\ncn17955: [Tue May2022] zni_dev 0000:01:00.0: _wait_tp_dq_empty, after 85, DQ in TP of Yp#24\"s is not empty\n\ncn17987: [Tue May2022] zni_dev 0000:01:00.0: _wait_tp_dq_empty, after 85, DQ in TP of Yp#24-s is not empty\n\ncn17989: [Tue May2022] zni_dev 0000:01:00.0: _wait_tp_dq_empty, after 85, DQ in TP of ¥P",
        "避免使用端口 988。如采您收到此错误，请执行以下操作:。 再司动任何使用 sunrpe 的服务前司动 Lustre 文件系统。。为 Lustre 文件系统使用988 以外的端口。这可在LNet 模块中的/etc/modprobe.d/lustre.conf 配置，如:options lnet accept Port988”在使用 sunrpe 的服务之前，将 modprobe ptlrpe 添加到您鸭系统司动脚本中。这会使 Lustre 文件系统绑定到问口 988 sunrpe 以选择不同的端口。注意您还可以使用sysct1命令缓解 NFS 客户端获取 Lustre 服务端口。但这是一个解雇部分问题的变通办法，因为其他用户空间 RPC 服务器仍然可以获取端口。Okt35.3.6. 处理错误\"- 28\"在写入或同步操作期间发生的 Linux 错误 -28 (ENOSPC) 指示在 OST 上的现有文(FH OST 已满〈或几乎已满) 而无法绑盖写或更新。要验证是否属于这种情况，请ERIK OST 的客户站上输入:”clienty Ifs df-h UUID bytes Used Available Use% Mounted on myth-MDT0000_UUID12.9G 1.5G 10.6G 12% /myth[MDT: 0] myth-OST0000 UUID 3.6T 3.1T 388.9G 89%425\n—ULDNn—ULD&—ULDLustre 文件系统操作手册 译者:As大/ myth[OST: 0] myth-OST0001 UUID 3.6T 3.6T 64.0K 100% / myth[OST: 1] myth-OST0002 UUID 3.6T 3.1T 394.6G 89% /myth[OST: 2] myth-OST0003 UUID 5.4T 5.0T267.8G 95% /myth[OST:3] myth-OST0004_UUID 5.4T 2.9T 2.2T 57% /myth[OST:4]filesystem summary: 21.6T 17.8T 3.2T 85% /myth *~*解雇这个问题，您可以扩展 OST 的磁盘空间，或使用Lfs _migrate将文件迁移至不那么拥挤的 OST 上。(Lustre2.6 引入) 在某些情况下，一些持有打开的文件的进程",
        "not empty\n\ncn17989: [Tue May2022] zni_dev 0000:01:00.0: _wait_tp_dq_empty, after 85, DQ in TP of ¥P#24°s is not empty\n\ncn18119: [Tue May2022] alloc_contig_range: [780d9250, 780d9260) PFNs busy\n\ncn18119: [Tue May2022] alloc_contig_range: [780d9270, 780d9280) PFNs busy\n\ncn18119: [Tue May2022] alloc_contig_range: [780d9280, 780d9290) PFNs busy\n\ncn18119: [Tue May2022] alloc_contig_range: [780d9290, 780d92a0) PFNs busy\n\ncn18119: [Tue May2022] alloc_contig_range: [780d92a0, 780d92b0) PFNs busy\n\ncn18119: [Tue May2022] alloc_contig_range: [780d92b0。780d92c0) PFNs busy\n\ncn18004: [Tue May2022] zni_dev 0000:01:00.0: _wait_tp_dq_empty, after 85, DQ in TP of Yp#24-s is not empty\n\ncn18009: [Tue May2022] zni_dev 0000:01:00.0: _wait_tp_dq_empty, after 85, DQ in TP of ¥P#24’s is not empty\n\ncn17966: [Tue May2022] zni_dev 0000:01:00.0: _wait_tp_dq_empty, after 85, DQ in TP of ¥P#24°s is not empty\n\ncn17967: [Tue May2022] zni_dev 0000:01:00.0: _intr。new FPQ packet\n\ncn17967: [Tue May2022] [ERR_PKT]: class=1:¥C0, type=2:¥P_ACCESS\n\ncn17967: [Tue May2022] flit[00]: 0x0000142301100400.0801200000000000.00006180450623fa.88e21001350450a7\n\ncn17967: [Tue May2022] flit[01]: 0x000000000000d777",
        "TH-3F: mn26 : S07C11PU06,，\n\n握手次数发生变化\n\nTH-HPC: ost64 : raid1出现\ntimeout故障\n\n” TH-HPC: ost64 : raid2出现\n\ntimeout故障\n（2）集群总览\nHPC、HPC4、1903都有自己的集群总览页面，将节点情况、作业情况、存储情况集中展示，以TH-HPC4总览页面为例，可以看出其实就是把原来分散的节点、作业、存储使用率监控数据整合到一个页面展示。\n© 2024年05月29日15.35 。 用户名-fengqiang 退出 |\n\nTH-HPCAEIE |\n\nnnil wasecere |)TeI] reuse7\n\neRss© pending 9 ne\n=omm\n\n服务节点o55%所 ee\n2Bs2s加\n\noR加15416127703(T)\n77\n\nseat=pn\n».6 6eo 0 0*\n\nJIL| |__ eee II\nost i7\n\nTT\n三 系统故障处理\n一线值班员通过运维平台处理系统故障，下面介绍运维平台的登录、使用方法。\n3.1 运维平台登录\n每个值班人员都有自己的运维平台账号，值班室调试机的chrome浏览器上有登录运维平台的书签，值班人员点击书签，输入用户名和密码，再点击登录，可登录到运维平台。\n© 新标签页x 十\n\n& > GC Q 在Google中拓索，或者输入一个网址\n\nB ses SO NSCCRERE @ SEEEXHET © EesueTe B 2ARER\n图3-1 浏览器书签\n一一\n\n河统一监控运维平台\n\n一一\n\n用户登录\n图3-2 登录页面\n3.2 功能概述\n登陆运维平台后，选择左侧边栏的 “运维总览”页面，该页面显示当前的系统报警情况，这样值班人员就可以直接在运维平台上获取需要处理的报警信息，不需要去显示系统报警的监控大屏去获取报警信息。\n右上角点击账号--个人信息，可以更改密码。\n统一监控运维平台iQxX * 2 ee\n\nOo RL报警开关\n04\n剧本编排\n剧本执行\n集群故障点故障级别发生时间状态操作\nTH-3F7. =e 警告2024-05-",
        ", 18192-18227 , 18229-18259 . 18261-18272 . 18274-18334 , 18336-18362 . 18365-18366 . 18368-18371.\n18373-18379 18381-18382 . 18384-18398 . 18400-18431] NodeCnt=971 CoreCnt=15536 Features=(null) PartitionName=(null) Flags=MAINT .SPEC_NOD\nES\n\nTRES=cpu=15536\n\nUsers=root Groups=(null) Accounts=(null) Licenses=(null) State=ACTIVE BurstBuffer=(null) Watts=n/a\n\nMaxStartDelay=(null)\n\nCroot@mn6 “J# yhi -n cnl17408-17419,17421-17444 17446-17467 17469-17475 .17478-17483,17485-17515 17517-17524 17526-17531 .17533-17539.\n17541-17555 17557-17571 17573-17582 ,,17584-17607 17616-17644 , 17646-17659, 17661-17944 17946-17947 17949-17968 17970-17975 17977-17995.\n18000-18013 18015-18061 18063-18143, 18148-18152, 18154-18187, 18192-18227, 18229-18259 18261-18272, 18274-18334, 18336-18362. 18365-18366.\n18368-18371 18373-18379 , 18381-18382, 18384-18398 18400-18431] -p ALL\n\nPARTITION AVAIL TIMELIMIT NODES STATE NODELIST\n\nALLup infinite | 971 drain$ |cnl17408-17419 17421-17444, 17446-17467 17469-17475 17478-17483 17485-17515 17517-17524 1752\n6-17531.17533-17539 \"1784121771.17573-17582.17584-17607.17616-17644.17646-17659.17661-17944.17946-17947.17949-17968.1797\n0-17975 17977-17995 18000-18013. 18015-18061, 18063-18143. 18148-18152. 18154-18187 ,18192-18227 _ 18229-18259. 18261-18272. 18274-18334. 1833\n6-18362 18365-18366 18368-18371 18373-18379 18381-18382 . 18384-18398, 18400-18431]",
        "统一监控运维平台iQxX * 2 ee\n\nOo RL报警开关\n04\n剧本编排\n剧本执行\n集群故障点故障级别发生时间状态操作\nTH-3F7. =e 警告2024-05-16T15:33:05未处理\nTH-HPC44e 警告2024-05-16T15:05:41未处理\nTH-3Feeee 通知2024-04-10T16:23:35未处理\nTH-3Mi7e 通知2024-04-04T08:22:06未处理\n\n共4条数据10条[页\n点击左侧边栏的“剧本执行”，可以切换到运维操作页面，点击TH-HPC、TH-3F等可以连接对应的集群，超过5分钟没有操作，将断开连接集群。\n运维操作的主要功能如下图所示：\n统一监控运维平台= 运维管理、\n\n定制大屏Bas 运维总揪\n\n其他操作 节点操作\n\nTH-HPC4\n\nTH-3F\nBIASTH-3M.\n\nTH-3K\n\n操作提示: 点击左侧树中集群名以连接集群 ~ 点击操作类型 ~ 点击操作按钮 ~ 填入参数，执行操作\n\n查看\n文档\n存情节点，怠 。重户、关机、开机、重启pdp、查看负载、查看日志.\n| ESR oO BEE, 查看dmesg、查看lustre active情况、关机、开机\n\n重启ntp\n本\n重启mysql\n\n| BRR © BSRR SHEARER HERRRACAE SRTBE SMa Bie.\n注意：运维操作页面内，在不同集群之间切换，标签保留。如果运维操作切换到运维总览或监控页面，运维操作内的标签全部会关掉。\n3.3 Lustre存储故障\n3.3.1 mds/ost报宕机或报unhealthy\n（1）挂起对应分区作业，并在微信群通知业务部门。\n查询报警的mds/ost属于哪个分区，参照下表：\nmds节点 | ost节点 | 存储分区 | 所属集群\nmds0 | ost0-7,ost40-47 | THL5 | HPC-ES\nmds1 | ost8-39 | THL6 | HPC1\nmds2 | ost48-79 | THL7 | HPC2\nmds3 | ost80-111 | THL8 |",
        "HPC-ES\nmds1 | ost8-39 | THL6 | HPC1\nmds2 | ost48-79 | THL7 | HPC2\nmds3 | ost80-111 | THL8 | HPC3\nmds4 | ost112-143 | fs1 | HPC4\n例如mds1宕机，即需要挂起THL6的分区作业，如下图所示。\n统一监控运维平台= 运维管理、\n\n定制大屏剧本执行\n\nTH-HPC\n其他操作 节点操作\n\n TH-HPCA© TH-HPC > THL6\n© TH-HPC\n日 中 存储分区操作\ngris 2EL分区作业恢复\n\nQTH7\nOTH\nO AiReE\nO 用户操作\n© 作灿操作\n\n四 肥各二人矿\n如下图查看日志，如果有-30或scsi cmnd错误，联系二线值班人员处理；如果没有报-30或scsi cmnd错误，进行下一步。\n统一监控运维平台= 运维管理、\n\n定制大屏剧本执行\n\nTH-HPCTH-HPC4\n\n其他操作\n\nof 节点编号: mds1\n\n日 ce TH-HPC\n序号: 2488\n©) HPC1-127\n日 storage节点名称: mds1\n TH-3F\n\n查询内存\n\n清除进程标记硬盘\n\n所属集群 TH-HPC\n所属分区:_null\n\n存储位置: 老机房-TH-HPC-HPC1-\n127-21.0\n\n查询硬盘信息Airaid (SB\n\ncpu进程排序mem进程排序\n\n硬盘大小. 无硬盘\n节点状态: 连接成功 |\n\n查询rsf信息\n\nBRE\n重启mds。选择“其他操作”—对应集群—“其他操作”—“电源管理”。\n输入“节点名”和“动作（重启）”后确认。\nTH-HPC TH-HPC4\n节点操作\n\nTH-HPC4PDTH-HPC\n\nafer]\n\n剧本编排BO 存储分区操作\n\nOTHLS登陆节点部署客户端-， MDS节点部署客户.， OSTHRBBEP...计算节点部署客户端.， 远程在线用户\n剧本执行四THL6\n二emsiveenee wm—\n© 资源操作\n\n0 用户操作\n\n© 作业操作mds1:查询日志 久",
        "OST 的情况下 〈如由于磁盘上启用了写入缓存引起的故障，或 OST 从旧的备份或重新格式化后恢复) ，LAST_ID 值可能会变得不一致，并生成类似于以下内容的消息:\"mytnh-OST0002: Too many FIDS to precreate, OST replaced orreformatted: LFSCK will clean up\"如果 OST 上先前创建的对象的记录与 MDS 上的先前分配的对象之间存在显着差异(Hila, MDS 已损坏或从备份中恢复，如果未校验则可能导致严重的数据丢失) ，则可能导致类似情形。这将产生如下信息:424\n—Lustre 文件系统操作手册这ay\"myth-OSTO002: too large difference between2 MDS LAST ID [0x1000200000000: 0x100048:0x0] (1048648) and3—OST LAST ID [0x1000200000000: 0x2232123:0x0] (35856675), trust the OST\"在这种情况下，MDS 将修改 lov_objid 的值以与 OST 的值相匹配，从而避免删除现有的可能包含数据的对象。MDT 上引用这些对象的文件不会丢失。任何未被引用的OST 对象将在下次运行LFSCK 布局检查时被添加到.1usttre/lost+found目录中。35.3.5. 处理\"Bind: Address already in use\" 错误在司动过程中，Lustre 软件可能会报告bindq: Address already in use 错误并拒绝启动操作。这是由于在 Lustre 文件系统局动之前司动了 portmap 服务 GH ATENFS 锁定) ，并绑定到默认端口 988。您必须在客户端、0SS 和 MDS “i ERS BT serIP 表中为传入连接打开端口 988。LNet 将在可用的预六端口上为每个客户端一服务磺对创建三个传出连接 CM 1023、1022 和 1021 开始)。不笠的是，您不能设置 sunprc 以避免使用端口 988。如采您收到此错误，请执行以下操作:。 再司动任何使用 sunrpe 的服务前司动 Lustre 文件系统。。为 Lustre 文件系统使用988 以外的端口。这可在LNet",
        "命令时，可能会返回一个“无法找到文件\" 错误，并将 MDS 上的文件永久删除。目前无法在文件系统不能挂载的情况下直接从 MDS 中解析元数据。如有果改障 OST没有局动，则挂载文件系统的其它方法是使用一个循环 OST 或新格式化的 OST 将其蔡换。在这种情况下，丢失的对象被创建，且被读为零质充。35.3.4. 修复 OST 上错误的LAST ID每个OST 都包含一个LAST_ID 文件，该文件保存由MDS 〈预) 创建的最后一个对象。MDT 包含一个 lov_objid 文件，其中的值代表 MDS 分配给文件的最后一个对象。FEILER ESATA], MDT 在 OST 上会保留一些预驳创建的《但未分配的) 对象，而LAST_ID 和1lov_objid 之间的关系应为LAST_ID > lov_objid。文件值中的兰异都会导致OST 下次连接到 MDS 时在 OST 上创建对象。这些对象从未实际分配给文件，它们的长度为0 (空)。但是，如果 lov_objid >LAST_ ID，表明 MDS 将这些对象分配给了 OST 上不存在的文件。相反，如果 lov_objid 远远小于LAST _ID (至少2 万个对象) ，则表明 OST 之前在MDS 的请求下分配了对象〈很可能包含数据) ，但它不知道这些对象的存在。从 Lustre 2.5 开始，如果 lov_objid 和LAST ID 文件不同步，则 MDS 与 OSS A动使其重新同步。这可能会导致 0ST 上的一些空间在下一次运行 LESCK 之前无法使用，但可以避免挂载文件系统的问题。从Lustre2.6开始, LFSCK 会根据OST 上存在的对象, 目动修复 OST 上的LAST ID文件，以防该文件被损坏。在磁盘损坏 OST 的情况下 〈如由于磁盘上启用了写入缓存引起的故障，或 OST 从旧的备份或重新格式化后恢复) ，LAST_ID 值可能会变得不一致，并生成类似于"
    ]
}