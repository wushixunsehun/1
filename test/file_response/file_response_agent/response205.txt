{
    "query": "在HPC4系统中，用户编译程序出现\"undefined reference to symbol 'FT_Init_FreeType'\"等链接错误，导致编译失败。请分析导致这个错误的主要原因，并说明如何正确解决这一类链接问题？",
    "summaries": [
        "编译过程中因fontconfig依赖的freetype版本过低导致错误，通过更换fontconfig和freetype版本解决。后续链接时出现undefined reference to 'FT_New_Face'错误，原因是缺少freetype库，解决方法是在链接命令中添加-lfreetype参数。",
        "HPC4系统编译报错问题由songkn用户提出，主要表现为链接错误。解决方法包括加载必要的模块如Intel_compiler、MPI、GCC、blas和lapack。编写Makefile时需正确设置编译器和库路径。报错信息显示缺少符号引用，如`MAIN`、`_gfortran_os_error`、`zheev_`和OpenMP相关函数。最终通过调整Makefile中的编译选项和库链接解决编译问题。",
        "编译过程中出现多个“undefined reference”错误，主要涉及未定义的符号如`kmpc_reduce@@VERSION`和`WINDWAVE.F90`中的未定义引用。错误信息显示链接器无法找到相关库或符号，可能由于缺少依赖库（如libiomp5.so）或链接顺序不当导致。最终导致`vasp`可执行文件未能生成，编译失败。"
    ],
    "contents": [
        "f90\n$(FC) $(FFLAGS) $(INC) -c $^ -o $@\nclean：\nrm -f $(PRO) *.o *.mod\nmake\n报错信息\n报错1：\n/fs1/software/intel/2020.2/compilers_and_libraries_2020.2.254/linux/compiler/lib/intel64_lin/for_main.o: In function `main':\nfor_main.c:(.text+0x2e): undefined reference to `MAIN'\ninterband_CALp.o: In function `cal_MOD_hamsea':\ninterband_CALp.f90:(.text+0x778): undefined reference to `_gfortran_os_error'\ninterband_CALp.f90:(.text+0xc62): undefined reference to `zheev_'\ninterband_CALp.f90:(.text+0x15de): undefined reference to `_gfortran_runtime_error'\ninterband_CALp.f90:(.text+0x1a8a): undefined reference to `omp_get_num_threads_'\ninterband_CALp.f90:(.text+0x1ced): undefined reference to `omp_get_thread_num_'\ninterband_CALp.f90:(.text+0x1f02): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.f90:(.text+0x2f15): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.f90:(.text+0x30c1): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.f90:(.text+0x3246): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.f90:(.text+0x3412): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.o:interband_CALp.f90:(.text+0x394a): more undefined references to `_gfortran_matmul_c8' follow\ninterband_CALp.o: In function `cal_MOD_hamsea':\ninterband_CALp",
        "auger.o dmatrix.o phonon.o wannier_mats.o elphon.o core_con_mat.o embed.o extpot.o fftmpiw.o fftmpi_map.o fft3dlib.o fftw3d.o /THL7/software/intel2019.5/mkl/interfaces/fftw3xf/libfftw3xf_intel.a main.o  -Llib -ldmy -Lparser -lparser /THL7/software/intel2019.5/mkl/lib/intel64/libmkl_scalapack_lp64.a -lmkl_blacs_intelmpi_lp64 -Wl,start-group /THL7/home/xlzhou/WORKSPACE/zhenqing/local/SCPC/dlmg-v3.1.0-rc.17/lib/libdlmg.a -Wl,end-group -Wl,start-group /THL7/home/xlzhou/WORKSPACE/zhenqing/local/SCPC/pspfft/lib/libpspfft.a -Wl,end-group -L/THL7/home/xlzhou/WORKSPACE/zhenqing/local/dftd4/lib64 -ldftd4 -lstdc++\nld: /THL7/home/xlzhou/WORKSPACE/zhenqing/local/SCPC/dlmg-v3.1.0-rc.17/lib/libdlmg.a(dl_mg_utils.o): undefined reference to symbol 'kmpc_reduce@@VERSION'\n/THL7/software/intel2019.5/compilers_and_libraries_2019.5.281/linux/ipp/../compiler/lib/intel64/libiomp5.so: error adding symbols: DSO missing from command line\nmake[2]: *** [vasp] Error 1\nmake[2]: Leaving directory `/THL7/home/xlzhou/WORKSPACE/zhenqing/local/vasp.6.2.1/build/std'\ncp: cannot stat 'vasp': No such file or directory\nmake[1]: *** [all] Error 1\nmake[1]: Leaving directory `/THL7/home/xlzhou/WORKSPACE/zhenqing/local/vasp.6.2.1/build/std'\nmake: *** [std] Error 2\n类似报错\nWINDWAVE.F90:(.text+0x1c9d): undefined reference to `",
        ".o subrot.o subrot_scf.o paircorrection.o rpa_force.o ml_interface.o force.o pwlhf.o gw_model.o optreal.o steep.o rmm-diis.o davidson.o david_inner.o root_find.o lcao_bare.o locproj.o electron_common.o electron.o rot.o electron_all.o shm.o pardens.o optics.o constr_cell_relax.o stm.o finite_diff.o elpol.o hamil_lr.o rmm-diis_lr.o subrot_lr.o lr_helper.o hamil_lrf.o elinear_response.o ilinear_response.o linear_optics.o setlocalpp.o wannier.o electron_OEP.o electron_lhf.o twoelectron4o.o gauss_quad.o m_unirnk.o minimax_ini.o minimax_dependence.o minimax_functions1D.o minimax_functions2D.o minimax_struct.o minimax_varpro.o minimax.o mlwf.o ratpol.o pade_fit.o screened_2e.o wave_cacher.o crpa.o chi_base.o wpot.o local_field.o ump2.o ump2kpar.o fcidump.o ump2no.o bse_te.o bse.o time_propagation.o acfdt.o afqmc.o rpax.o chi.o acfdt_GG.o dmft.o GG_base.o greens_orbital.o lt_mp2.o rnd_orb_mp2.o greens_real_space.o chi_GG.o chi_super.o sydmat.o rmm-diis_mlr.o linear_response_NMR.o wannier_interpol.o wave_interpolate.o linear_response.o auger.o dmatrix.o phonon.o wannier_mats.o elphon.o core_con_mat.o embed.o extpot.o fftmpiw.o fftmpi_map.o fft3dlib",
        "> Error: ProcessError: Command exited with status 1:\n'/fs1/home/laswda/.spack/stage/spack-stage-fontconfig-2.13.1-fbfon2fpizuutdlvdre3qm6ord743fgl/spack-src/configure' 'prefix=/fs1/home/laswda/spack/user/linux-rhel8-cascadelake/intel-19.1.2.254/fontconfig-2.13.1-fbfon2f' 'enable-libxml2' 'disable-docs' 'with-default-fonts=/fs1/home/laswda/spack/user/linux-rhel8-cascadelake/intel-19.1.2.254/font-util-1.3.2-otravxq/share/fonts'\n1 error found in build log:\n164    checking for struct statvfs.f_fstypename... no\n165    checking for struct statfs.f_flags... yes\n166    checking for struct statfs.f_fstypename... no\n167    checking for struct dirent.d_type... yes\n168    checking The type of len parameter of gperf hash/lookup function... size_t\n169    checking for FREETYPE... no\n>> 170    configure: error: Package requirements (freetype2 >= 21.0.15) were not met:\n171\n172    Package dependency requirement 'freetype2 >= 21.0.15' could not be satisfied.\n173    Package 'freetype2' has version '19.0.13', required version is '>= 21.0.15'\n174\n175    Consider adjusting the PKG_CONFIG_PATH environment variable if you\n176    installed software in a non-standard prefix.\nSee build log for details:\n/fs1/home/laswda/.spack/stage/spack-stage-fontconfig-2.13.1-fbfon2fpizuutdlvdre3qm6ord743fgl/spack-build-out.txt\n解决\n更换fontconfig的版本\nspack install ncl@6.6.2%intel@19.1.2.254",
        "home/laswda/.spack/stage/spack-stage-fontconfig-2.13.1-fbfon2fpizuutdlvdre3qm6ord743fgl/spack-build-out.txt\n解决\n更换fontconfig的版本\nspack install ncl@6.6.2%intel@19.1.2.254^freetype@2.7.1^fontconfig@2.12.3  OK\nsource <(spack module tcl loads dependencies /az5mw4j)\n报错6\n报错信息\nifort -o plot_level.exe   plot_level.o module_header.o module_map_stuff.o module_ncarg.o module_read_station.o date_pack_module.o -L/fs1/home/laswda/spack/user/linux-rhel8-cascadelake/intel-19.1.2.254/ncl-6.6.2-az5mw4j/lib -lncarg -lncarg_gks -lncarg_c -lX11 -lm -lcairo -L/fs1/software/netcdf/4.8.0-gcc8.4-IMPI2019.8/lib -lnetcdf -lnetcdff -I/fs1/software/netcdf/4.8.0-gcc8.4-IMPI2019.8/include\nld: /fs1/home/laswda/spack/user/linux-rhel8-cascadelake/intel-19.1.2.254/ncl-6.6.2-az5mw4j/lib/libncarg_gks.a(cro.o): undefined reference to symbol 'FT_New_Face'\n/fs1/home/laswda/spack/user/linux-rhel8-cascadelake/intel-19.1.2.254/freetype-2.7.1-y6ws7xn/lib/libfreetype.so.6: error adding symbols: DSO missing from command line\nmake: [Makefile:61: plot_level.exe] Error 1 (ignored)\nifort -o plot_soundings.exe   plot_soundings.o module_mapinfo.o module_report.o module_skewt.o date_pack_module.o -L/fs1/home/laswda/spack/user/linux-rhel8-cascadelake/intel-19.1.2.254/ncl-6.6.2-az5mw4j/lib -lncarg -lncarg_gks -lncarg_c -lX11 -lm -lcairo -L/fs1/software/netcdf/",
        "(.text+0x394a): more undefined references to `_gfortran_matmul_c8' follow\ninterband_CALp.o: In function `cal_MOD_hamsea':\ninterband_CALp.f90:(.text+0x7f06): undefined reference to `omp_get_thread_num_'\ninterband_CALp.f90:(.text+0x830a): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.f90:(.text+0x881b): undefined reference to `omp_get_thread_num_'\ninterband_CALp.f90:(.text+0x8b5b): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.f90:(.text+0x9b8e): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.f90:(.text+0x9d3f): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.f90:(.text+0x9eaf): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.f90:(.text+0xa073): undefined reference to `_gfortran_matmul_c8'\ninterband_CALp.o:interband_CALp.f90:(.text+0xa598): more undefined references to `_gfortran_matmul_c8' follow\ninterband_CALp.o: In function `cal_MOD_hamsea':\ninterband_CALp.f90:(.text+0xbe34): undefined reference to `_gfortran_runtime_error_at'\ninterband_CALp.f90:(.text+0xbe52): undefined reference to `_gfortran_runtime_error_at'\ninterband_CALp.f90:(.text+0xbe68): undefined reference to `_gfortran_runtime_error_at'\ninterband_CALp.f90:(.text+0xbe7e): undefined reference to `_gfortran_runtime_error_at'\ninterband_CALp.f90:(.text+0xbe94): undefined reference to `_gfortran_runtime_error_at'\ninterband_CALp",
        "【已解决】HPC4系统编译报错解决\n**标签**: HPC4系统，编译报错\n**创建时间**: 2022-05-10 14:59:02\n**更新时间**: 2022-05-10 14:59:02\n**作者**: 李云龙\n**问题**：编译报错\n需求\nsongkn用户在hpc4系统编译程序报错\n解决\n环境加载\nmodule add Intel_compiler/19.1.2\nmodule add MPI/Intel/IMPI/2019.8.254\nmodule add GCC/8.4.1\nmodule add blas/3.10.0-icc19.1\nmodule add lapack/3.10.0-icc19.1\n编写makefile文件\nFC=mpiifort\n#FC=mpif90\nFFLAGSO3 -qopenmp -nostdinc\n#FFLAGSO3 -fopenmp -nostdinc\n#LIB= -L/fs1/software/intel/2020.2/mkl/lib/intel64 -lmkl_lapack95_ilp64\n#INCI/fs1/software/lapack/3.10.0-icc19.1/include\n#INCI/fs1/software/lapack/3.10.0-gcc8.4/include\n#INCI/fs1/software/intel/2020.2/mkl/include\n#INCI/fs1/software/intel/2020.2/mkl/include\n#LIBL/fs1/software/lapack/3.10.0-icc19.1/lib64 -llapack -L/fs1/software/blas/3.10.0-icc19.1/lib -lblas\nLIBF=/fs1/software/lapack/3.10.0-icc19.1/lib/liblapack.a /fs1/software/blas/3.10.0-icc19.1/lib/libblas.a\nSRC= interband_CALp.f90 interband_MAINp.f90\nOBJ=$(SRC:.f90=.o)\nPRO=a.out #可执行文件名\n$(PRO):$(OBJ)\n$(FC) $(FFLAGS) $(LIB) -o $(PRO) $(OBJ) $(LIBF)\n$(OBJ):%.o : %.f90\n$(FC) $(FFLAGS) $(INC) -c $^ -o $@\nclean：\nrm -f $(PRO) *.o *.mod",
        "-cascadelake/intel-19.1.2.254/ncl-6.6.2-az5mw4j/lib -lncarg -lncarg_gks -lncarg_c -lX11 -lm -lcairo -L/fs1/software/netcdf/4.8.0-gcc8.4-IMPI2019.8/lib -lnetcdf -lnetcdff -I/fs1/software/netcdf/4.8.0-gcc8.4-IMPI2019.8/include\nld: /fs1/home/laswda/spack/user/linux-rhel8-cascadelake/intel-19.1.2.254/ncl-6.6.2-az5mw4j/lib/libncarg_gks.a(cro.o): undefined reference to symbol 'FT_New_Face'\n/fs1/home/laswda/spack/user/linux-rhel8-cascadelake/intel-19.1.2.254/freetype-2.7.1-y6ws7xn/lib/libfreetype.so.6: error adding symbols: DSO missing from command line\nmake: [Makefile:64: plot_soundings.exe] Error 1 (ignored)\n解决：在-lcairo后面添加-lfreetype"
    ]
}