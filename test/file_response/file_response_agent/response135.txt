{
    "query": "系统中网络延迟最低的节点是哪台？",
    "summaries": [
        "TH-3F系统网络速度测试使用osu-5.8程序进行，基于gcc9.3.0编译，测试了不同mpi版本（mpi-x、mpi-x + tcp、mpi-n）的延时和带宽。测试节点为cn[2987-2988]。结果显示，随着数据大小增加，延时和带宽变化明显，其中mpi-x在大部分情况下表现最佳，而mpi-n延时较高。带宽方面，mpi-x在大尺寸数据下具有显著优势。测试数据仅供参考。",
        "TH-3F系统进行了VASP单节点性能测试，使用CuInS2算例进行结构优化。测试了不同K点设置下的性能，并对比了56核和64核的运行时间。测试中调整了并行参数，包括NPAR=4和KPAR=2。结果显示，64核在sm和tcp模式下性能优于56核glex模式。",
        "Lustre 2.3 引入了多项参数和功能，用于优化 MDS 服务线程和网络性能。管理员可通过设置 `_num_threads` 控制线程数量，禁用自动创建。Node Affinity 功能允许将 MDS 线程绑定到特定 CPU 分区（CPT），提升缓存效率和内存局部性。此外，可配置 `mds_num_cpts`、`mds_rdpg_num_cpts` 和 `mds_attr_num_cpts` 来指定线程绑定的 CPT 范围。LNet 参数如 `tx_buffer_size`、`rx_buffer_size` 和 `enable_irq_affinity` 可调整网络性能，而 `credits` 参数影响网络通信的信用值，以适应不同网络环境。路由器缓存区功能则通过分配不同大小的缓冲区来优化消息转发。这些功能为系统调优提供了更多控制选项。"
    ],
    "contents": [
        "|1048576|295.9|1697.58|1666.93|\n|2097152|577.8|3280.66|3268.78|\n|4194304|1141.11|6404.55|6376.47|\n带宽\n|Size|Bandwidth(MB/s)|Bandwidth(MB/s)|Bandwidth(MB/s)|\n||mpi-x|mpi-x + tcp|mpi-n|\n|1|1.04|0.11|0.19|\n|2|2.4|0.23|0.41|\n|4|4.89|0.46|0.85|\n|8|9.83|0.88|1.7|\n|16|19.67|1.82|3.5|\n|32|33.91|3.65|7.07|\n|64|73.36|19.61|14.34|\n|128|120.16|37.1|28.11|\n|256|218.55|65.24|58.01|\n|512|321.64|118.24|80.07|\n|1024|604.87|216.47|97.34|\n|2048|1103.78|352.07|187.03|\n|4096|1943.86|504.83|338.42|\n|8192|2566.68|619.3|561.36|\n|16384|2859.07|725.06|729.3|\n|32768|3073.43|811.26|811.91|\n|65536|5399.88|825.17|895.16|\n|131072|5587.81|859.92|955.32|\n|262144|5623.41|936.48|1015.54|\n|524288|5522.76|824.43|854.67|\n|1048576|5503.29|681.39|665.71|\n|2097152|5557.89|644.95|689.92|\n|4194304|6956.75|650.1|655.16|",
        "=    0    number of steps for IOM\nIBRION =    -1    ionic relax: 0-MD 1-quasi-New 2-CG\nISIF   =     2    stress and relaxation\nPOTIM = 0.2\nISYM=0\nDOS related values:\nISMEAR =     0;\nSIGMA  =   0.05\n#NEDOS=2999\nWrite flags\nLWAVE  =      F    write WAVECAR\nLCHARG =      T    write CHGCAR\nLVTOT  =      F    write LOCPOT, local potential\nLORBIT = 11\nALGO=Fast\nLMAXMIX=4\nLDAU=T\nLDAUTYPE=2\nLDAUL=2 -1 -1\nLDAUU=2.20 0.00 0\nLDAUJ=0.20 0.00 0\nLDAUPRINT=2\nKPOINTS\n选择5组K点测试\n7-7-3     8-8-4    9-9-5     10-10-6    11-11-7\n作业脚本\n一个节点56核，计算结构优化。\n#!/bin/bash\nyhrun -N 1 -n 56  -p thcp1  vasp_ncl\n调整参数\nINCAR\n其余不变\nNPAR = 4\nKPAR =2\n作业脚本\n#!/bin/bash\nexport UCX_TLS=sm\nNODES=1\nCORES=64\nPARTITION=thcp1  # use 'yhi' to check partitions\nEXE=vasp # choose one vasp version to run. e.g. vasp / vasp_ncl / vasp_gam / vasp_neb ...\nUCX_TLS=sm,tcp yhrun -N $NODES -n $CORES -p $PARTITION $EXE\n测试数据\n|TH-3F|单节点测试|vasp5.4.4|\n|VASP测试|用户测试|nscc-tj|\n|KPOINTS",
        "【已解决】TH-3F系统VASP单节点性能测试\n**标签**: TH-3F VASP  sm, tcp, glex 性能测试\n**创建时间**: 2022-09-23 10:50:57\n**更新时间**: 2022-09-23 10:50:57\n**作者**: 刘栋杰\nTH-3F系统VASP单节点性能测试\n用户算例\nPOSCAR\nPOSCAR-CuInS2\n1.00000000000000\n5.5935662547724148   -0.0000001972541281    0.0000002856271407\n-0.0000001982126414    5.5935662339574144    0.0000001488971322\n0.0000005736285978    0.0000003005384429   11.2906108404215839\nCu   In   S\n4     4     8\nDirect\n-0.0000000374484856  0.4999999641516956  0.2500000387262479\n0.5000000028390460 -0.0000000078451421  0.7499999891387383\n0.4999999631667135  0.5000000353607148  0.5000001806741946\n0.0000000255524713  0.0000000594474677 -0.0000001852810345\n0.0000000251258136  0.4999999786961337  0.7500000536607697\n0.4999999674254817 -0.0000000221437011  0.2499999788249322\n0.4999999849653031  0.5000000123838864  0.0000001468171165\n0.0000000149209289 -0.0000000016277274  0.4999998626520079\n0.7500005080070462  0.2194776843469671  0.8750002226413106\n0.2499995117587629  0.7805222670736877  0.8750001899530040\n0.2194770895357970  0.2500003327695614  0.1249998773550668\n0.7805229278848418  0.7499996809912697  0.1249998710181722\n0.2805221962357510  0.2500005051614309  0.6249998062116768\n0.7194778145299330  0.7499995039139766  0.6249998424424036\n0.2499995594992707  0.7194771218760166  0.3750001221478534\n0.7500004670013228  0.2805229064437607  0.3750000890175397\nINCAR\n$ cat INCAR\nStartparameter for this run:\nISTART = 0    job   : 0-new  1-cont  2-samecut\nICHARG = 2    charge: 1-file 2-atom 10-const\nISPIN=2\nElectronic Relaxation\nENCUT  =  550.0 eV\nNPAR = 4\nNELMIN =8\nLREAL= Auto !evaluate projection operators in real space\nEDIFF=10-6\nIonic relaxation\nEDIFFG = -0.02     stopping-criterion for IOM\nNSW    =    0    number of steps for IOM\nIBRION =    -1    ionic relax: 0-MD 1-quasi-New 2",
        "MDS MAX THREADS) “4 1024.注意圭载时，每个 CPT 每个服务局动两个 O0SS 和 MDS 线程，根据服务奉负载来动态增加运行的服务线程数量。设置* _num threads参数将立即为该服务局动指定数量的线程，同时禁用线程目动创建。(在 Lustre 2.3 中引入)Lustre 2.3 中引入了新的参数，为管理员提供了更多的控制。388\nLustre 文件系统操作手册 Pea Parmdqs rdqpg _ num threads一控制提供读取页服务的线程数。读取页服务用于处理文件关闭和 readdir 操作。mds attr num threads一控制为运行 Lustre 1.8 的客户端提供 setattr 服务的线34.2. 绑定 MDS 服务线程到 CPU 分区在 Lustre 2.3 版中引入的 Node Affinity (节点关联性) ，可以将 MDS 线程绑定到特定的 CPU 分区 (CPT) ,以提高 CPU 高速缓存使用率和内存局部性。将自动选择 CPT 数和 CPU 核心绑定的默认值，以便为给定数量的 CPU 提供良好的整体性能。管理员也可更改这些设置。有关指定 CPU 内核到 CPT 的有映射的详细信息，请参见本章第 4 节\"Tibcf调试\"。 mdqs_num cpts=[EXPRESSION] 绑定默认 MDS 服务线程 至由[EXPRESSION]定义的CPTs。如，mqs_num cpts=[0-3] 将绑定 MDS服务线程至CPT [0,1,2，3]。*mds rdpg num_cpts=[EXPRESSION] 绑和定读取页服务线程 至由[EXPRESSION]定义的CPTs。读取页服务负责处理文件关闭操作及readdir 请求。如，mqs_rqpg_num_cpts=[4]将绑定读取页服务线程至 CPT4。P>*mds attr num cpts=[EXPRESSION] 3h cE setattr AK 务线 程 至 由[EXPRESSION]定 义 的 CPTS。 WY WM fE KM 件/etc/modprobe.dq/1LIustre.conf中载入模块前设置参数。如:options lnet networks=tcp0",
        "【已解决】TH-3F 系统网络速度测试\n**标签**: th-3f,  延时,  带宽\n**创建时间**: 2021-12-03 14:51:32\n**更新时间**: 2021-12-10 14:42:23\n**作者**: 郑刚\n**问题**：TH-3F 系统网络速度测试\nTH-3F 系统网络速度测试\n> 数据仅供参考\n测试方法\n使用 osu-5.8 程序测试，基于 gcc9.3.0 编译，使用不同的 mpi 版本\n- mpich/mpi-x-gcc9.3.0 + glex\n- mpich/mpi-x-gcc9.3.0 + tcp\n- mpich/mpi-n-gcc9.3.0 + tcp\n测试节点\ncn[2987-2988]\n测试结果\n延时\n|Size|Latency (us)|Latency (us)|Latency (us)|\n||mpi-x|mpi-x + tcp|mpi-n|\n|0|4.53|16.42|28.08|\n|1|4.4|16.27|27.93|\n|2|4.4|16.28|27.95|\n|4|4.39|16.23|27.99|\n|8|4.39|16.25|28.02|\n|16|4.39|16.19|27.94|\n|32|4.54|18.43|28.42|\n|64|4.49|33.54|28.26|\n|128|5.9|28.77|28.36|\n|256|6.13|28.96|28.64|\n|512|6.37|29.31|28.93|\n|1024|6.8|30.38|35.75|\n|2048|7.56|31.47|36.03|\n|4096|8.78|33.93|37.71|\n|8192|11.19|41.27|42.51|\n|16384|16.34|55.29|55.92|\n|32768|22.62|76.18|80.02|\n|65536|30.59|128.5|122.11|\n|131072|48.71|203.53|235.91|\n|262144|84.38|406.94|385.07|\n|524288|154.77|825.19|812.75|\n|1048576|295.9|1697.58|1666.93|\n|2097152|577.8|3280.66|3268.78|\n|4194304|1141.11|6404.55|6376.47|\n带宽\n|Size|Bandwidth(MB/s)|Bandwidth(MB/s)|",
        "N $NODES -n $CORES -p $PARTITION $EXE\n测试数据\n|TH-3F|单节点测试|vasp5.4.4|\n|VASP测试|用户测试|nscc-tj|\n|KPOINTS|56核-glex|64核-sm，tcp|\n|10106|4160.572|1917.167|\n|11117|5639.05|2610.358|\n|773|1000.443|464.892|\n|884|1772.705|817.589|\n|995|2736.395|1312.553|\n|并行参数设置|NPAR=4|NPAR=4|\n|添加：||KPAR=2|\nTH-3F VASP测试\n317\n日56核好ex 日64核sm， tcp",
        "CPU 分区，通过 LNet 模块的选项进行指定。例如，o2ipbo(ib0) [0,1] 确保了o2ipb0的所有应妃由在CEPT0和CPT1上执行的LND 线程处理; tcpl (eth0) [0] 确保了tcpl的消息由CPT0上的线程处理。34.3.4. 网络接口信用网络接口 (ND 信用在所有 CPU 分区 (CPT) 之间共享。例如，如果一台机器有四个 CPT 且 NI 信用值为 S12，则每个分区有 128 个信用值。如果系统中存在大量 CPT，则 LNet 将检查并验证每个CPT 的 NI 信用值，以确保每个 CPT 都有可用的信用值。如果一人台机需有16个CPT且NI信用值为236，则每个分区只有 16 个信用值，将可能会对性能产生负面影响。因此，LNet SA aka (Bie A 8*peer credits (默认情况下，peer _ credits 为 8) ，因此每个分区都有 64 个信用值。增加 creqits/ Peer_creqdits 数使得 LNet FENIAN KITA Qik BREN网络或对等节点并保持传输人饱和，从而提高高延迟网络的性能〈以消耗更多内存为代价)。管理员可以使用ksoclnd或ko2iblndq修改 NI {AAA Ee PIN IA, TCP 连接的信用值被设置为 256。ksocklnd credits=256Wt IB 连接的信用值为 256:ko2iblnd credits=256390\n—Lustre 文件系统操作手册 译者:注意在 Lustre 2.3 及以上版本中，LNet 可能会重新验证 NI 积分，则管理员请求可能不会持续。34.3.5. 路由器缓存区当一个节氮被设置为LNet 路由融时，会分配三个缓存区: 极小、小和大的缓存区。这些缓存区按 CPU 分区分配，用于缓存到达路由需竺转发到下一跳的消县。三种不同大小的缓存区适应不同大小的消四。如采消息可以放入极小缓冲区，那么使用极小的缓冲区; URE ABEL AD IZ神区但是可以放入小组神区，则使用小缓冲区; 如采消息不适用于极小或小绥补区，则EA KBHPXBet",
        "由[EXPRESSION]定 义 的 CPTS。 WY WM fE KM 件/etc/modprobe.dq/1LIustre.conf中载入模块前设置参数。如:options lnet networks=tcp0 (eth0)options mdt mds_ num cpPts=[0]34.3. LNet 参数调试本贡主要介绍 LNet 可调参数。在某些系统上可能需要使用这些参数来提高性能。34.3.1. 发送和接收缓冲区大小内核在网络上分配发送和接收信息的缓冲区。使用ksocklnd 分开设置用于发送和接收信息的绥神区的参数。1 options ksocklnd tx buffer Sizer0 rx puffer size-0如果这些参数保留默认值 《0) ，系统会目动调整发送和接收缓神区大小。几乎在所有情况下，此默认设置会产生最佳性能。如果您不是网络专家，请不要尝试调整这些参389\n——11Lustre 文件系统操作手册 译者:As大34.3.2. 硬件中断 (enable irq affinity)Poe) 25 78 Bic is EG AS) Te A AY HE A RSE GE CPU 进行处理。在某些情况下，我们希望将网络流量保持在单个 CPU 本地，以便保持处理需缓存温度并减少环境切换的影响。这特别有利于具有多个网络接口尤其是接口数量等于 CPU 数量时的 SMP 系统。司用enable irq affinity参数，请输入:options ksocklnd enable irg affinity=1在其它情况下，如果您运行在一个含单个快速接口《如 10Gb/s) 和两个以上的 CPU的SMP 平台，则蔡用该参数可能会提升性能:options ksocklnd enable irg affinity=-0此参数默认为关闭。请通过测试更改此参数时的性能情况来进行调试。(在 Lustre2.3 中引入)34.3.3. 绑定针对 CPU 分区的网络接口Lustre 2.3 及以上版本提供了高级网络接口控制。管理员可以将接口绑定到一个或多个 CPU 分区，通过 LNet 模块的选项进行指定。例如，o2ipbo(ib0) [0,1] 确保了o2ipb0的所有应妃由在CEPT0和CPT1上执行的LND 线程处理; tcpl ("
    ]
}