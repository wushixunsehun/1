{
    "query": "管理服务器 MGS 在 Lustre 中具体承担哪些职责？",
    "summaries": [
        "Lustre 文件系统操作手册摘要：介绍了如何创建和挂载 Lustre 文件系统，包括使用 mkfs.lustre 命令创建 MGS、MDT 和 OST，以及通过 mount.lustre 挂载文件系统。详细说明了挂载选项，如 mgsname、block_device、安全设置、flock 选项、statfs 行为等，帮助用户优化和管理 Lustre 文件系统。",
        "Lustre 文件系统通过 HSM（Hierarchical Storage Management）管理数据在文件系统与存储解决方案之间的迁移。请求包括 ARCHIVE、RELEASE、RESTORE、REMOVE 和 CANCEL，其中 RELEASE 是同步操作，其他由 MDT 协调处理。默认请求超时时间为 3600 秒，可通过命令设置。自动恢复机制在访问已释放文件时触发，IO 会被阻塞直到恢复完成。用户可通过命令监控请求状态和文件状态，文件状态包括 NOARCHIVE、NORELEASE、DIRTY 和 LOST。调试工具可控制协调器行为、设置最大请求数、调整策略及 grace delay。HSM 变更日志记录相关事件类型，如存档、恢复、取消等。",
        "Lustre 文件系统操作手册摘要：本文介绍了Lustre文件系统的管理操作，包括MGS和MDT的配置、设置只读模式、LNet网络的启动与关闭、路由健康状态更新机制以及InfiniBand网络的负载平衡配置。主要步骤包括挂载文件系统、修改参数、验证配置、设置只读模式防止数据修改，以及管理LNet网络的启动、关闭和多轨配置。这些操作有助于优化Lustre性能和确保系统稳定性。"
    ],
    "contents": [
        "Lustre 文件系统操作手册这ay选项block_ device44.15.3. 选项选项mgsname=mgsnode [:mgsnode ]mgsnode=mgsnid[,mgsnid]mgssec=flavor说明在物理磁盘 block_device 上局动由mkfs. lustre (8) 命令定义的目标服务。指定block device，可使用1 label 来查找具有该标签 (如testfs-MDT0000) 的第一个块设备，或通过U uuid 选项使用UUID。如果在同一节点上存在目标文件系统的设备级备份，请格外小心。这是因为如果目标文件系统没有使用tune2fs (8)或类似命令进行更改，会产生重复的标签和 UUID 。挂载在 mountpoint 上的目标服务文件系统仅对qf (1) 操作有用，并会出现在/Proc/Vmounts中，表明该设备正在使用中。说明mgsname 是以冒号分隔的 mgsnode 名称列表，可运行 MGS 服务。如果 MGS 服务配置为 HA 故障切换模式且可能在任何一个节点上运行，则可指定多个 mgsnode 值。如果 mgsnode 有不同的LNet 接口，则每个mgsnode 通过逗号分隔的 NID 列表进行指定指定连接 MGS 的初始网络 RPC 的加密特性。砷安全的特性有: nul1，Plain和gssnul1，分别表示用于测试目的的蔡用、无加密功能或非完整性功能。Kerberos 特性有: krb5n,krb5a，krb5i和krb5p。共享密钥的风格有: skn，ska，ski和skpi。客户端到服577\nLustre 文件系统操作手册这ay选项 说明务髓连接的安全特性在客户端从 MGS 获取的文件系统配置中指定。skpath=file|directory 为此 mount 命令加载的密钥文件的文件路径或目exclude=ostlist录路径。密钥将被插入到内核的KEY SPEC SESSION KEYRING密钥环中，并附价有包含1ustre :字样及后缀的说明。该后绥取诀于 mount 命令的会话是用于 MGS，MDT/OST 还是客户问。司动客户端或MDT，指定不符试连接的已知的非活动 OST 列表〈由冒号分隔)。除了标准的 mount(8) 选项外，Lustre 还能读懂以下特定于客户端的选项:选项always pingflocklocalflock说明即使服务",
        "无法提交请求。。Ppurge: 清除所有记录的请求。不改变协调器状态。307\nLustre 文件系统操作手册这ay26.6.2. max requestsmax requests jéla] WYANT RAL (BED Dia) 。该值与代理数量无Ko例如，如果有2个MDT 和4个代理，代理不需要处理 2 倍的max_1 $ lctl set param mdt.SFSNAME-MDTO000.hsm.max requests=1026.6.3. policy更改系统行为，其值可以通过将+ 或 (EA BOR ASI AE BR1 $ lctl set Param mdt.SFSNAME-MDTO000.hsm.policy=+NRA可 以是以下情况组合的值:* NRA: 不进行重坛。如果恢复失败，不自动重调度请求。。NBR : 不阻塞 IO 来等待恢复。即触发恢复 ，但不阻塞客户端。访|返回 ENODRATA。26.6.4. grace delayrequests.可已释放的文件grace_delay 指的从整个请求列表中清除请求〈成功或失败) 的延迟，单位为秒。1 $ lctl set param mdqt.SESNAMPE-MDT0000.nhsm.grace delay=1026.7. 变更日志Lustre S/F RBCS Shae HSM 相关事件的类型为 HSM 的变更日志。1 16HSM 13:49:471.469433938 2013.10.01 0x280 t=[0x200000400: 0x1: 0x0]有 i 信息可以写入每条 HSM 记录: 变更文件的FID AI ACHENS. fey LA下信息进行编码 〈最低位在前)错误代码〈如采存在) (7 bits)。 HSM 事件 (3 bits)* HE ARCHIVE = 0: 文件已被存档。。 HE RESTORE = 1: 文件已恢复。。 HE CANCEL = 2: 关于此文件的请求已被取消。* HE RELEASE = 3: 文件已被释放。* HE REMOVE = 4: 已删除的请求被自动执行。\"HE_STATE = 5 : 文件标志已更改。308\nLustre 文件系统操作手册",
        "peer) 的健康状态更新机制，有两种:。LNet 可以主动检查所有路由的健康状况，并目动将其标记为dead' 或alive。默认人情况下，该功能为关闭状态，可通过设置auto_qown启用，并根据需要设facheck routers before use。如果系统中存在已死亡的路由，系统司动时进行的初始检查可能导致router_ping_ timeout时间的暂停。。当出现通信错误时，所有 LND 都会通知 LNet 端〈不一定是路由) 已下线。该功能呈始终开局，并且没有参数可以关闭它。但如果将 LNet 模块参数auto_qown设置为0，则 LNet 将忽略所有这种端下线的通知。这两种机制的关键不同点在于:。 路由 Pinger 只检查路由的健康状态，而 LND 则会注意到所有和死掉的端，无论这些Shine AY ATER EE© 路由通过发送 ping 命令来主动检查路由的健康状态，而 LND 2 feb EA al信和时才会注意到一个死邱的端。”路由 Pinger 可 以将路由从活动状态变为死亡状态，反之亦然，但LND 只能标记端为下线状态。15.2. 启动和关闭 LNetLustre 软件可自动启动和关闭 LNet, {A LNET 也可以以独立方式手动启动。这个方IBAA Assi ao) Lustre 文件系统之前验证网络设置是否正毅。15.2.1. 启动 LNet司动 LNet，运行:1 S modprobe Inet2 $ lctl network up查看本地 NID 列表，运行:1 $ lctl list _nids该命令显示了 Lustre 文件系统的网络配置。如果网络未正确设置，碍看modules .conf文件中networks=行，并确保已正确安装和配置网络层模块。想要获取最佳远程 NID, ，运行:151\nLustre 文件系统操作手册 译者:这ay1 $ lctl which nid NIDsan NIDs为可用 NID 列表。玄俞令将从远程主机列表中选取\" tee\" FY NID, BI ASH Se Fes a fs BY使用 的 NID。15.2.1.1. 启动客户端”司动",
        "mount -t lustre /dev/mgs device /mgs _ mount point碍看其是否获知所有文件系统。mgs:/root# lctl get param mgs.MGS.filesystems5. KK MDT 上移除 MG 选项，设置新的MGS NID.mds# tunefs.lustre --nomgs --mgsnode=new_mgs_ nid/dev/mdt-deviceJaz MDT.mds# mount -t lustre /dev/mdt_ device /mdt_ mount point碍看 MGS 配置是否正确。mgs# lctl get param mgs.MGS.live.filesystem name14.14. 将 MDT 设置为只读有时候，在服务器上直接将文件系统标记为只读，而不需要重新安装客户端并设置选项是很好的。如果有一个恶意客户端正在删除文件，或者在系统下线时，对防止已经安装的客户端再修改系统可能会很有用。将mdt.*.readonly 参数设置为1，可以立即将 MDT 设置为只读。以后所有的MDT 修改将立即返回一个“只读文件系统\" 错误 〈(EROFS) ，直到该参数被设置为 0。下面是一个将readonl1y设置为 1，验证当前设置，从客户端进行写入，并将参数再设置为 0 的例子。—mds# lctl set param mdt.fs-MDTO000.readonly=12 mdt.fs-+¥DTO000. readonly=14 mds# lctl get param mdt.fs-MDTO000.readonly5 mdt.fs-Y¥DTO000.readonly=17 client$ touch test file8 touch: cannot touch “’ test file: Read-only file system10 mds# lctl set param mdt.fs-MDT0000.readonly=011 mdt. £s-MDTO000.readonly=0150\nLustre 文件系统操作手册这ay第十五章管理 Lustre Networking (LNet)15.1. 更新路由或端的健康状态LNET 路由或疝 (peer) 的健康状态更新机制，有两种:。LNet 可以主动检查所有路由的健康状况，并目动将其标记为dead' 或alive。默认人情况下，该功能为关闭状态，可通过设置auto",
        "指定不符试连接的已知的非活动 OST 列表〈由冒号分隔)。除了标准的 mount(8) 选项外，Lustre 还能读懂以下特定于客户端的选项:选项always pingflocklocalflock说明即使服务从PtIzpPc模块配置了suppress_pings选项，客户端也会在空闲时定期 ping 服务器。这使得客户端即使不是外部客户端运行状况监视机制的一部分也能够可靠地使用文件系统。(在Lustre 2.9 中引入)使用flock (2) 系统调用在参与的应用程序之间启用文件锁定文持，以便文件锁定在所有使用此挂载选项的客户端节点上保持一致。这将在应用程序需要路多个客户端节点进行一致的用户空间文件锁定时非常有用，但为了保持此一致性同时也增加了通信开局用客户端本地flock(2)支持，仅使用客户端本地的文件锁定。这比使用全局flLock选项更快，并且可以用于依赖于flock (2)但仅在单个节点上运行的应用程序。它通过仅使用 Linux 内核锁实现了最小开销。xm378\nayLustre 文件系统操作手册 译者: 李选项 说明noflock 完全禁用flock (2) ，为默认选项。调用flock (2) 的应用程序会出现ENOSYS错误。管理员可以根据需要选择1ocalf1lock或flock挂载选项。可使用不同的选项挂载客户端，但只有那些使用flock挂载的客户端才能相互保持一致性。lazystatfs 在某些 OST 或 MDT 无啊应或已在配置中暂时或永久禁用时仍允许返回statfs(2) (pedt (1)和1Lfs-dqf(1)使用)，从而避免所有目标都可用前的阻塞。这是目 Lustre 2.9.0 以来的默认行为。nolazystatfs 使statfs (2) BAIE, BAA OST 和MDT 都可用后再返回空间使用情况。user xattr 人允许user .*命名空间中的普通用户获取/设置扩展属性。有关更多详细信息，请参见attt (5) 于册页。nouser xattr 禁用usez .*命名空间中的普通用户使用扩展属性。root 和系统进程仍可以使用扩展属性。verbose 启用额外的 mount/umount 控制台消息。noverbose AS FA AY SAY) mount/umount 控制台消息。user fid2path",
        "一个或多个 copytool 实例可能会遇到导致它们无法啊应的情况。为避免系统阻塞对相关文件的访问，我们为请求处理定义了一个超时值。copytool 必须在这上段时间内完全完成请求，其默认值为 3600 秒。1 $ lctl set param -n mdt.lustre-MDT0000.hsm.active request timeout305\nLustre 文件系统操作手册这ay26.4.每个26.4.请求文件系统和 HSM 解决方案之间的数据管理是由请求驱动的。有以下五种类型 :ARCHIVE: 从 Lustre 文件系统揽贝数据至 HSM 解决方案。RELEASE : 从 Lustre 文件系统移除数据。RESTORE : 从 HSM 解决方案拷回数据至相应的 Lustre 文件系统。REMOVE : 从HSM 解决方案中删除拷贝数据。CANCEL : 取消进行中或等待中的请求。JAA RELEASE 是同步进行且不需要协调需配合的操作。其他请求由协调锅处理，MDT 协调釉对和它们进行弹性的管理。1. 命令请求通 了过1fs ff 6人 th Ae:1 $ lfs hsm archive [--archive=ID] FILE1 [FILE2...]2 $ lfs hsm release FILE1 [FILE2...]3 $ lfs hsm restore FILE1 [FILE2...]4 $ fs hsm remove FILE1 [FILE2...]26.4如果没有通过 --archive #$% ARCHIVE ID ，请求将被发送到默认 ARCHIVE ID..2. 自动恢复当一个进程试图读取或修改已释放的文件时，它们将被被目动恢复。相关 IO 将被阻塞文件1 S ca直到文件恢复完成。这些操作对进程来说是透明的。例如，以下命令将自动恢复该(如果它已被释放) :t /mnt/lustre/released file26.4.3. 请求监控1 S 1Lc可以监控每个 MDT 上的已注册请求列表和它们的状况，运行:tl get Param -n mdt.lustreMDT0000.hsm.actions当前复制工具正在处理的请求列表可通过以下命令获取:1 $ lctl get param -n mdt.lustre-MDTO0000.",
        "列表。玄俞令将从远程主机列表中选取\" tee\" FY NID, BI ASH Se Fes a fs BY使用 的 NID。15.2.1.1. 启动客户端”司动 TCP 客户端，运行:1 mount -t lustre mdsnode: /mdsA/client /mnt/lustre/Jao) Elan 客户端，运行:1 mount -t lustre 2@elan0:/mdsA/client /mnt/lustre15.2.2. 关闭 LNet在移除 LNet 模块乙前，必须移除 LNet 引用。通前，关闭 Lustre 文件系统时会目动删除这些引用。但对于独立路由，关闭 LNet 需要明确的步又。运行:1 lctl network unconfigure注意试图在停止网络之前删除 Lustre 模块可能会导致系统月泪或 LNet 挂起。如果发生这种情况，必须重新司动节点〈在大多数情况下) 。请确保在外载模块之前 Lustre 网络和 Lustre S/F ABER, FREE rmmod -f.取消 LNet 网络配置，请运行:1 modprobe - JIna and lnet modules注意凶载所有 Lustre 模块，请运行:S lustre rmmod15.3. 基于 LNet 多轨配置的硬件使用LNet 在双轨 (dual-rail) IB 群集 (o2iblnd) 的两个轨道上聚合带宽 ，请考虑以下几点问题:。 LNet 可以使用多轨 Cmulti-rail) 配置，但并不会在它们之间进行负载均衡。在通信中实际使用的轨道由端的 NID 决定。”硬件多轨 LNet 配置不会增加一级额外的网络容错。下面章节中描述的配置仅用于增加缀合带宽。。对一给定端NID，Lustre 贡点总是使用某一相同本地 NID 进行通信。如何确定本地NID ，请参照:152\nLustre 文件系统操作手册 译者:这ay。 最低的优先值〈优先值越低，优先级越高，在 Lustre 2.5 中引入) ;。 最少的跳数，以减少路由;。在\"metworks\" 或\"ip2nets'\"LNet 配置字符串中位于首位。15.4. 利用 InfiniBand* 网络实现负载平衡47 Lustre 文件系统中的OSS 有",
        ":tl get Param -n mdt.lustreMDT0000.hsm.actions当前复制工具正在处理的请求列表可通过以下命令获取:1 $ lctl get param -n mdt.lustre-MDTO0000.hsm.active requests306\nLustre 文件系统操作手册 译者:这ay26.5. 文件状态当文件被存档〈释放) ，它们在 Lustre 文件系统上的状态发生改变。使用以下1fs命令碍看文件状态:1 $ lfs hsm State FILE1 [FILE2...]可以为每个文件设置以下的特定策略标志:* NOARCHIVE : 该文件永远不会被存档。* NORELEASE : 该文件永远不会被释放。如果已经设置了RELEASED标志，则不能再设置此标志。。DIRTY: 文件在复制到 HSM 解决方案后发生了更改。DIRTY 文件需要再次存档。DIRTY 标志只能在已有EXIST标志的情况下设置。以下选项只能由 root 用户设置 :。 LOST: 该文件已存档，但其在 HSM 解雇方案上的副本由于某种原因 (如磁盘损坏) 丢失，并且不能进行恢复。如果该文件处于 RELEASE 状态，则文件丢失; 如果不处于RELEASE 状态，则该文件需要再次存档。有些标志可通过以下命令手动设置或清除:1S 1fs hsm set [FLAGS] FILE] [FILE2...]2 $ lfs hsm clear [FLAGS] FILE1 [FILE2...]26.6. 调试26.6.1. hsm_controlpolicyhsm control 负责控制协调堪活动并可以祖除动作列表。1 $ lctl set Param mdt.SFSNAME-MDTO000.hsm_control=purge可能的值有:。enabled : 司动协调需线程。在可用复制工具实例上分发请求。。 disabled: 暂停协调器活动，将不进行新请求分发，不处理超时。新的请求会被注册，但只有协调喜重新启动后才会进行处理。。 shutdown : 关闭协调器线程。将无法提交请求。。Ppurge: 清除所有记录的请求。不改变协调器状态。307\nLustre 文件系统操作手册这ay26.6.2. max requestsmax requests jéla] WYANT RAL (BED",
        "打印简明信息。重新格式化已有的 Lustre fea.用于优化 MDT 的 inode 大小。打印更多信息。575\nLustre 文件系统操作手册这ay44.14.3. 示例在文件系统 testfs 的节点cfs21上创建组合的MGS 和 MDT:1 mkfs.lustre --fsname-testfs --mdt --mgs /dev/sdal在文件系统 testis 的任一节点上创建一个OST (使用以上 MGS) :1 mkfs.lustre --fsname-testfs --mgsnode=cfs21@tcp0 --ost --index=0 /dev/sdb在节点cfs22上创建独立的 MGS:1 mkfs.lustre --mgs /dev/sdal在文件系统 myfsl WET EGET MDT 〈使用以上 MGS):1 mkfs.lustre --fsname=myfs1 --mdt --mgsnode=cfs22@tcp0 /dev/sda2也可参见\"本章滴 14. mkfs.lustre\", \"15. mount.lustre\".44.15. mount.lustremount.lustre 实用程序可用于局动 Lustre 客户端或目标服务。44.15.1. 梗概1 mount -t lustre [-o options] device mountpoint44.15.2. 说明使用 mount.lustre 实用程序司动 Lustre 客户端或目标服务，不应直接调用。它是通过 mount(8) 调用的辅助程序。使用 umount 命令停止 Lustre 客户端和目标。device 选项有两种形式，有具体取决于客户端或目标服务是否已启动:选项 说明mgsname:/fsname[/subdir] 通过联系 mgsname 上的 Lustre ManagementService，在目录 mountpoint 中的客户端上挂载名为 fname 的 Lustre 文件系统〈如果指定了subdir ，则从文件系统的子目录 subdir 启动) 。mgsname 的格式定义如下。可在fstab (5) 中列出客户端文件系统，以便在司动时自动挂载。客户端文件系统即可像其他本地文件系统一样使用，并提供完整的 POSIX 标准兼容接口。576\nLustre 文件系统操作手册这ay选项block_ device44.15.3. 选项选项mgsname=mgsnode [:mgsnode ]mgsnode=mgsnid[,mgsnid]mgssec=flavor说明在物理磁盘 block_device 上局动由mkfs"
    ]
}