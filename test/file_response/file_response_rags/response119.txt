{
    "query": "在Lustre文件系统中，如何处理OST降级状态以避免影响整体性能？请说明标记OST降级的操作步骤及相关参数配置。",
    "summaries": [
        "Lustre 文件系统操作手册摘要：使用 `umount` 命令优雅地关闭 Lustre OST、MDT 或 MGT，保留客户端连接状态。若使用 `-f` 强制标志，将中断连接且不恢复。对于故障切换模式，可通过 `--param=\"failover.mode=failout\"` 设置为 failout 模式，避免等待 OST 恢复。OST 降级时，MDS 不再分配新对象，可通过 `lctl set_param` 标记或恢复 OST 的降级状态。Lustre 支持多个文件系统，需确保 `--fsname` 唯一，挂载时使用对应 MGS 节点和文件系统名称。",
        "Lustre 文件系统操作手册摘要：当 OST 损坏时，可使用 `mkfs.lustre` 命令替换故障 OST，并通过 `--replace` 选项恢复配置。若配置文件不可用，可从其他 OST 复制 `mountdata` 文件。挂载新 OST 后，需恢复配置并重新激活。若 OST 不可用，需在 MGS 中更新状态。可通过 `lctl` 命令获取 OST 节点信息，更改故障节点地址或分离 MGS/MDT。操作需注意备份与配置恢复，确保文件系统正常运行。",
        "Lustre 文件系统操作手册内容涉及文件系统配置、快照管理、迁移以及条带化设置。主要步骤包括使用 `tunefs.lustre` 重新格式化和写入配置，挂载和卸载文件系统，删除旧快照以释放空间，调整快照卷大小，以及在 ZFS 和 ldiskfs 之间迁移 OST 或 MDT。条带化方面，Lustre 使用循环或加权算法分配数据到 OST，确保空间平衡，提高 I/O 性能。文件条带化数量受限于 MDT 类型和配置，合理设置条带参数可优化性能。"
    ],
    "contents": [
        "为 0。我们建议通过一个自动脚本来实现各个 RAID 设备状态的监控，如通过 MD-RAID的maaqm (8) 命令以及--monitot 来标记受影响的设备处于降级状态还是已恢复状态。13.8. 运行多个 Lustre 文件系统在确保NID:fsname 唯一性的情况下，Lustre 可文持多文件系统。每个文件系统在创建时都必须使用 --fsname 参数分配一个唯一的名称。如果只存在单个MGS ，则强制执行文件系统名称唯一性。如果存在多个 MGS 〈如每个 MDS 上都有一个MGS) FH管理员负责确保文件系统名称是唯一的。单个 MGS 和唯一的文件系统名称提供了单一的管理点，即使该文件系统尚未挂载，也可对该文件系统发出命令。Lustre 在单个MGS 上支持多个文件系统。由于只有一个MGS，fsname 保证是唯一的。Lustre 也人允许多个 MGS 共存。例如，不同的 Lustre 软件版本上同时使用了多个文件系统，需要多个 MGS。在这种情况下必须格外小心，以确保文件系统名称是唯一的。在未来可能互操作的所有系统中，每个文件系统都应该有一个唯一的 finame。默认情况下，mkfs .Lustre 命令将创建一个名为 Lustre的文件系统。如须在格式化时指定不同的文件系统名称〈限制为 8 个字符) ，请使用--fsname 选项:1 mkfs.lustre —-fsname=2 file system name注意127\n—234—12345678910111213—Lustre 文件系统操作手册 译者:新文件系统的MDT、OSTs 必须使用相同的文件名 (蔡代设备名)。例如对于新文件系统foo，MDT 和两个OSTS 将被命名为 foo-MDT0000 , foo-OST0000 和foo-OSTO0O001。在文件系统上挂载客户端，运行:client# mount -七 lustremgsnode:/new_fsname/mount point在文件系统foo 的裁入点 mntfoo 上挂载一个客户端，运行:client# mount -t lustre mgsnode:/foo /mnt/foo注意如果客户端要挂载多个文件系统，为避免文件在不同文件系统间移动时出现问题，请在/etc/xattr.conf 文件中增加: lustre.* skip注意为确保新的MDT 已被添加",
        "\"failover.mode=failout\" 选项进行指定:1 oss# mkfs.lustre --fsname=2 fsname --mgsnode=3 mgs NID --param-failover.mode=failout4 --ost --index=5 ost_index6 /dev/ost_ block deviceFE PIRI BHP, FE MGS (mds0) testfs文件系统上为 OSTs 指定了 failout 模式。1 oss# mkfs.lustre --fEsname=testfs --=mgsnode=mds0--paranefailover.mode=failout2 --ost --index=3 /dev/sdb在首次文件系统配置后，请使用 tunefs.1ustre 工具进行模式更改。在下面的例子中，横式被设置为 failout :1 $ tunefs.lustre --param failover.mode=failout2 /dev/ost_device注意在运行该命令前，请僵载所有会被 failover/failout 切换所影响的 OSTs.120\n———Lustre 文件系统操作手册 译者:As大13.7. 处置降级 OST BEER AEDILustre 具备告知功能，可以在当外部 RAID 阵列出现性能下降 〈以致整体文件系统性能下降) 时，及时告知 Lustre 系统。该性能下降通币是由于人役盘发生故障而未被更换，或更换了新磁盘正在重建所造成的。当 OST 处于降级状态时，MDS 将不会为其分配新对象，从而避免因OST 降级引起全局性能下降。每个OST 都有一个 degraded 参数，用于指定 OST 是否在降级模式下运行。将OST 标记为降级，请运行:lctl set Param obdfilter. {OST name} .degraded=1将 OST 恢复正冰模式，请运行:lctl set Param obdfilter. {OST name} .degraded=0WAU GETS OSTs 当前处于降级模式，请运行:lctl get_param obdfilter.* .degraded# OST 因重启或其它状况被重新挂哉，该标志将被重置为 0。我们建议通过一个自动脚本来实现各个 RAID 设备状态的监控，如通过 MD-RAID的maaqm (8) 命令以及--monitot 来标记受影响的设备处于降级状态还是已",
        "MDT MGS writeconf )21 Persistent mount opts: errors=remount-ro,1open nopriv,user xattr190\n2527282930313233343536383940414243444546Lustre 文件系统操作手册 译者:这ayParameters:Writing CONFIGS/mountdatacfs21:~# tunefs.lustre --reformat --fsname=back --writeconf/dev/vgmain/OSTO.b1checking for existing Lustre datafound Lustre dataReading CONFIGS/mountdataRead previous values:Target: main-OSTO000Index: 0Lustre FS: mainMount type: ldiskfsFlags: Ox2(OST )Persistent mount opts: errors=remount-ro, extents,mballocParameters: mgsnode=192.168.0.21@tcpPermanent disk data:Target: back-OST0000Index: 0Lustre FS: backMount type: ldiskfsFlags: 0Ox102(OST writeconf )Persistent mount opts: errors=remount-ro, extents,mballocParameters: mgsnode=192.168.0.21@tcpWriting CONFIGS/mountdataHan CPE RAY, TN CR PBR last_revd 文件。cfs21:~# mount -t ldiskfs /dev/vgmain/MDTO.b1 /mnt/mdtbackcfs21:~# rm /mnt/mdtback/last_rcvdcfs21:~# umount /mnt/mdtbackcfs21:~# mount -t ldiskfs /dev/vgmain/OSTO.b1 /mnt/ostbackcfs21:~# rm /mnt/ostback/last_rcvdcfs21:~# umount /mnt/ostback2. 从 LVM 快照挂载文件系统，如:19]\n111Lustre 文件系统操作手册%ty这aycfs21:~# mount -t lustre /dev/vgmain/MDTO.b1 /mnt/mdtbackcfs21:~# mount -t lustre /dev/vgmain/OST0.b1 /mnt/ostbackcfs21:~# mount -t lustre cfs21:/back /mnt/back3. 注意截至快照时间的原目录内容。例如:cf£s21:~/cfs/bl_5/lustre/utils# 1s /mnt/backfstab passwds18.5.5. 删除旧的快照要回收磁盘空间，请投照备份策略的要求删除旧快照，运行;lvremove /dev/vgmain/MDTO.b118.5.6. 更改快照卷大小如果您发现每日增量小于或",
        "get param osc.*.ost_conn_uuidosc. testfs-OSTO0000-osc-£1579000.0st_conn_uuid=192.168.20.1@tcposc. testfs-OST0001-osc-£1579000.0st_conn_uuid=192.168.20.1@tcposc. testfs-OST0002-osc-f£1579000.0st_conn_uuid=192.168.20.1@tcposc. testfs-OST0003-osc-£1579000.0st_conn_uuid=192.168.20.1@tcposc. testfs-OST0004-osc-f£1579000.0st_conn_uuid=192.168.20.1@tcp14.12. 更改故障节点地址更改故隐菠氮的地址《如使用节氮广共换季氮Y) ，在 OSS/OST 分区上运行“取决于定义NID 时使用的选项):oss# tunefs.lustre --erase-params --servicenode=NID /qev/ost device或oss# tunefs.lustre --erase-params --failnode=NID /dev/ost_device14.13. 分离组合的 MGS/MDT以下操作在服务硕和客户端开机状态下进行，并假设 MGS “Tr -G MDS “i RAAT El1. 暂停 MDS 服务。印载 MDT.umount -f /dev/mdt device2. 创建 MGS.mds# mkfs.lustre --mgs --device-size=size /dev/mgs device3. 从 MDT 磁盘拷贝配置信息至新的 MGS 磁盘。mds# mount -t ldiskfs -o ro /dev/mdt device /mdt_mount pointmds# mount -t ldiskfs -o rw /dev/mgs device /mgs mount pointmds# cp -r /mdt_ mount point/CONFIGS/ filesystem name-* /mgs mount point/CON-FIGS/. ~*’mds# umount /mgs mount pointmds# umount /mdt_ mount point149\nLustre 文件系统操作手册这ayJaz MGS.mgs# mount -t lustre /dev/mgs device /mgs _ mount point碍看其是否获知所有文件系统。mgs:/root# lctl get param mgs.MGS.filesystems5. KK",
        "/tmp/mountdata oss0:/tmp/mountdata3 oss0# dd if=/tmp/mountdata of=/mnt/ost/CONFIGS/mountdata bs=4 count=1seek=5 skip=5 conv=notrunc5. $k OST 文件系统。oss# umount /mnt/ost14.9.6. 重新激活 OST如果 OST 永久不可用，须在 MGS 配置中重新激活它。—mgs# lctl conf param ost_name.osc.active=1如果 OST 暂时不可用，须在 MGS 和客户端上重新激活它。—mds# lctl set param osp.fsname-OSTnumber-* .-active=1Nclient# lctl set param osc.fsname-OSTnumber-* .-active=114.10. 终止恢复可使用 lctl 工具或通过abort recov选项 (mount -o abort recov) 终止恢复。启动一个目标，请运行:—mds# mount -t lustre -L mdt_ name -oO abort recov /mount point注意恢复过程将被阻塞，直到所有 OST 都可用时。14.11. 确定服务 OST 的机器在管理 Lustre 文件系统的过程中，您可能需要确定哪台机器正在为特定的 OST 提供服务。这不像识别机器 IP 地址那么简单，卫 只是 Lustre 软件使用的几种网络协议之一，因此 LNet 使用NID 而不是卫 地址作为节点标识符。要识别服务 OST HN HLar NID,请在客户端上运行以下命令之一〈不必是 root FA):—client$ lctl get param osc.fsname-OSTnumber* .ost_conn_uuid148\n————Lustre 文件系统操作手册 译者:这ayclient$ lctl get param osc. *-OST0000* .ost_conn_uuidosc. testfs-OSTO0000-osc-£1579000.0st_conn_uuid=192.168.20.1@tcpclient$ lctl get param osc.*.ost_conn_uuidosc. testfs-OSTO0000-osc-£1579000.0st_conn_uuid=192.168.20.1@tcposc. testfs-OST0001-osc-£1579000.0st_conn_uuid",
        "sdo on /mnt/ostl type lustre (ro)4 /dev/sde on /mnt/ost2 type lustre (ro)56 [root@ossl ~]# umount -a -t lustre7 [155336.491445] Lustre: Failing over testfs-OSTO00028 [155336.556752] Lustre: server umount testfs-OSTO0002 complete13.5. FEAR as LR A tp关闭 lustre OST, MDT 或 MGT, 请运行 umount /mount point 命令。以下是在挂载点 /mnt/ost0 关闭 OST( ost0) testis 文件系统的例子:1 [root@oss1 ~]# umount /mnt/ost02 [ 385.142264] Lustre: Failing over testfs-OSTO0003 [ 385.210810] Lustre: server umount testfs-OSTO000 complete125\nLustre 文件系统操作手册 译者:As大使用 umount 命令是一种优雅地停止服务器的方式，因为它保留了客户端的连接状态。下次司动时，服务锅将重新连接客户端，然后执行恢复过程。如果使用了强制标志 (-£) ，服务器则会中断所有客户端连接并停止恢复。重新启动后，服务器不会进行恢复。任何当前连接的客户端在重新连接之前都会收到 IO 错误。注意如果您使用了 loop 设备，请加上 -d 标志，以安全地清除 loop 设备。13.6. 为 OSTS 指定故障切换模式在 Lustre 文件系统中，由于 OST 故障、网络故障、OST 未挂在等原因而无法访问HY OST 可以通过以下两种方式之一进行处置:。failout 模式: Lustre 客户端在超时后将立即接收到错误消息，而不是一直等待OST 恢复。。 failover 模式: Lustre 将等待 OST 恢复。默认情况下,，Lustre 文件系统在 OSTs FoR A failover 模式. 若您想采用 failout模式，请通过 --param=\"failover.mode=failout\" 选项进行指定:1 oss# mkfs.lustre --fsname=2 fsname --mgsnode=3 mgs NID --param-failover.mode=failout4 --ost --",
        "Lustre 文件系统配置(如果可用)。存储在 OST 上的所有对象都将永久丢失，使用 OST 的文件应该从备份中删除和 或) 恢复。Lustre 2.5 及更高版本中，可在不恢复配置文件的情况下替换 OST 至原索引处。请在格式化时使用 --z*eplace 选项:oss# mkfs.lustre --ost --reformat --replace --index=old_ost index \\other options /dev/new_ ost devMDS 和 OSS fart Ras\" OST HY LAST ID 值。当 OST 文件系统完全无法访问时，OST 配置文件未备份时，即使 OST 文件系统完全无法访问，仍可在相同索引处用新的 OST 蔡换故障 OST.1. 更早的版本中的 OST 文件系统格式化和配置恢复 〈不使用 --*eplace 选项) 。oss# mkfs.lustre --ost --reformat --index-old_ost_ index \\other options /dev/new ost dev2. 挂载 OST 文件系统。oss# mkdir /mnt/ostoss# mount -t ldiskfs /dev/new_ost dev /mnt/ost3. 恢复 OST 配置文件《如有果可用)。oss# tar xvf ost _name.tar -C /mnt/ost147\nLustre 文件系统操作手册 译者:这ay4. Hipr el a OST 配置文件〈如采恢复不可用)。当使用默认参数 〈一般情况下适用于所有文件系统) 第一次挂载 OST AY,last revd 文件将会被重建。CONEIGS/mountdata 文件由mkfs.1Lustre 在格式化时创建，并含有标志设置以癌 MGS 发出注册请求。可从另一个工作中的 OST 复制标志。1 ossl# debugfs -c -R \"dump CONFIGS/mountdata /tmp\" /dev/other _osdev2 ossl# scp /tmp/mountdata oss0:/tmp/mountdata3 oss0# dd if=/tmp/mountdata of=/mnt/ost/CONFIGS/mountdata bs=4 count=1seek=5 skip=5",
        "passwds18.5.5. 删除旧的快照要回收磁盘空间，请投照备份策略的要求删除旧快照，运行;lvremove /dev/vgmain/MDTO.b118.5.6. 更改快照卷大小如果您发现每日增量小于或大于预期，您还可以扩展或收缩快照卷，运行:lvextend -L10G /dev/vgmain/MDTO.b1注意在更老的 LVM 版本中，扩展快照卷可能不可用。该功能在 LVM v2.02.01 IEF.18.6. ZFS 和ldiskfs 目标文件系统间的迁移M Lustre 2.11.0 开始，可以在ZFS 和ldiskfs 后端乙间进行迁移。要迁移 OST, Bef使用1fs find/lfs_migrate 在文件系统正在使用时清空 0ST，然后使用新的 fstype重狐格式化 OST.18.6.1. 从 ZFS 迁移至 ldiskfs 文件系统第一步，请按照本章第 3 节\" 备份 O0ST或MDT 〈后端文件系统级别) \" 中介绍的方法使用 tar 进行 ZFS 后端备份。第二步，请将备份恢复到基于 ldiskfs 的系统，参照第 4\"恢复文件级备份\"。18.6.2. 从 ldiskfs 迁移至 ZFS 文件系统第一步，请按照本草第 3 人\"备份 OST 或 MDT 〈后端文件系统级别) \" 中介绍的方法使用 tar 进行 ldiskfs 后端备份。第二步，请将备份恢复到基于 ZFS IY KS, BRASBB 4S\" 恢复文件级备份\"。192\nLustre 文件系统操作手册 译者:As大注意对于从 ldiskfs 到 zfs 的迁移，需要在公载目标之前局用 index_backup。这和是基于Idiskfs 季规备份/恢复的一个附加步骤，很容易被忽略。第十九章管理文件布局〈条带化) 及剩余空间19.1. Lustre 文件系统条带化如何工作在 Lustre 文件系统中，MDS 使用循环算法或加权算法将对象分配给 OST。当可用空间大小平衡恨好时 〈默认情况下，不同 OST 之间的空闲空间相关不到 17%即算平衔良好) ，循环算法用于选择要写入条佛的下一个 OST. MDS 定期调整条佛布局以消除一些算法退化",
        "时 〈默认情况下，不同 OST 之间的空闲空间相关不到 17%即算平衔良好) ，循环算法用于选择要写入条佛的下一个 OST. MDS 定期调整条佛布局以消除一些算法退化的情况，如创建非彰规律的、总是偏好序列中某个特定 OST 的文件布局 (AR带化类型 ) 。OST 的使用通季非名均衡。但是，如有果用户创建一些特大文件或指定错误的条市参数，将可能会导致 OST 的用量不均衡。当 OST 之间的可用空间相差超过特定数量 CRWA 17%) IY, MDS 将使用加权随机分配，从而优先在拥有更多可用空间的 OST 上分配对象。【〈这会影响IO 性能，直到空间使用再次平衡。) 有关如何分配条带的更详细说明，请参见本草第 6 节\" 管理可用空间\"。受限于存储在MDT 上的属性所允许的最大大小,文件只能在有限数量的 OST 上进行条带化。如果 MDT 基于 ldiskfs ，而又不具备ea_inoqe Whe, 文件最多可以分为 160个0OSTs。如果是基于 ZFS 的MDT，或者如果基于 ldiskfs 的MDT 局用了 ea_inode 功能，文件做多可以条带化到 2000 个 OST 上。有关更多信息，请参见本章第 7 节\"Lustre条囊化内部参数\"。19.2. Lustre 文件布局〈条带化) 的一些考量是否设置文件条带、选择什么样的参数值取决于您的需求。原则上您应该在满足需求的前提下尽可能地在更少的对象上进行条带化。进行文件条带化的一些动机包括 :。 提供高带宽访问。 许多应用程序都需要对某个文件进行高带宽访问，其对带宽的需求可能比单个 OSS 能提供的带宽要高。比如一些应用程序可能需要将来自数百个下氮的数据写入单个文件，或者在局动时需要从多个节点加载二进制可执行文件。在这些情况下，可将文件分割到尽可能多的 OSS 上，以达到该文件所需的峰值聚合带宽。请注意，只有当文件大小很大或文件一次被许多节点访问时，才建议使用大量OSS 进行分条。目前，Lustre"
    ]
}