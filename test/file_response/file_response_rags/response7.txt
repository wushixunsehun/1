{
    "query": " Changelogs 有哪些用途？如何启用或关闭？",
    "summaries": [
        "Lustre 文件系统中的 Changelogs 用于记录文件系统操作。用户可通过 lctl 和 lfs 命令注册、注销和清除 Changelog 用户。注销操作会清除该用户的记录。Changelog 记录包含操作类型、时间戳、用户信息等。通过 lfs changelog 可以显示记录，而设置 changelog_mask 可控制记录的操作类型。Changelogs 还可用于审计，以跟踪和评估系统操作。",
        "信息技术审计用于评估机构保护信息资产和合理分发信息的能力。Lustre 文件系统通过 Changelogs 提供审计功能，可记录文件访问事件，如 OPEN、ATIME、GETXATTR 和 DENIED OPEN 等。启用这些记录类型需设置参数，并可通过 nodemap 控制哪些客户端触发审计日志。Changelogs 包含文件标识符、UID/GID、时间戳等信息，便于追踪访问行为。此外，Lustre Jobstats 功能收集用户进程的文件操作统计，并与作业调度程序配合，为每个作业提供唯一标识符。",
        "本文档介绍了Lustre文件系统的配置和管理，包括如何为存储目标指定多个服务节点，使用MMP防止数据损坏，以及在客户端挂载时传递MGS信息。还详细描述了Changelogs功能，用于记录文件系统元数据变更事件，如文件创建、删除、重命名等，并提供了相关命令如lctl changelog register、lfs changelog、lfs changelog clear等，用于管理和查看日志记录。"
    ],
    "contents": [
        "监控配置12.1. Lustre ChangelogsChangelogs 〈更新日志) 功能负责记录文件系统名称空间或文件元数据变更事件。请如文件创建，删除，重命名，属性变更等，这些修改将与目标文件标识符 (FID). 42目录文件标识符、目标名称、时间戳及用户信息一起被记录下来。这些记录可用于多种Faia: - 捕获最近的更改，存入归档系统。- 利用 Changelogs 条目完成文件系统镜像的变更精确复制。- 设置监测脚本，作用于茶些事件或目录。- 维护一个粗略的审计跟踪 OC件/目录随时间戳变化，不合用户信息)。107\nLustre 文件系统操作手册Hi这ayChangelogs 的记录类型有:108\nLustre 文件系统操作手册详这ay值MARKCREATMKDIRHLINKSLINKMKNODUNLNKRMDIRRNMFMRNMTOOPEN *CLOSELYOUTTRUNCSATTRXATTRHSMMTIMECTIMEATIME *MIGRTFLRWRESYNCGXATR *NOPEN *说明内部记录保存毅规文件创建目录创建硬链接软链接其他文件创建PEALE AS BR目录移除重命名，目标名称打开KIALayout 变更POPE SE属性变更附加属性变更HSM 相关事件MTIME 变更CTIME 变更ATIME 变更文件迁移事件文件级别副本: 文件初始写入文件级别副本: 文件重新同步扩展属性访问 〈getxattr)被拒绝的文件打开其中市 号的类型在默认情况下不会被记录。109\n—Lustre 文件系统操作手册 译者:这ayLustre 还提供了从文件标识符 (FID) 到文件路径，以及从文件路径到文件标识符的操作，以方便将目标文件和父目录的文件标识符上映射到文件系统命名空间。12.1.1 Changelogs 相关命令以下是一些与 Changelogs 相关的命令:12.1.1.1 lctl changelog register 由于 Changelog 记录需要在 MDT 上占用一些空间，系统管理员必须注册 Changelogs 用户。一旦 Changlog 用户注册完成，Changelogs功能则被打开。注册用户需指定哪些记录已经\" 处理完成\"，系统则将清除已处理完成的记录，直到遇到那些未被所有用户处理完成的记录。要注册新的日志用户，请运行:mds# lctl --device fsname-MDTnumber changelog registerHEH EW PA CA AY Changelogs 条目不会被清除〈请参阅 全 changelog_clear相关信息)。12.1.1.21fs changelog 在MDT 上显示元数据变更 (changelog 记录) ，",
        ":0x50:0xb] mdd_obd-lustre-MDT0000-0注意MARK 记录表明了 Changelog 记录状态变化。112\n——ULDNn—ULDNn—ULDLustre 文件系统操作手册 译者:这ay”显示 Changelog 索引及注册用户显示某个设备 (lustre-MDR0000) 上的当前最大 Changelog 索引及已注册的 Changelog用户:mds# lctl get param madqdq.1ustrerMDT0000.chnangelog Usersmdd.lustre-MDTO000.changelog users=current index: 8ID index (idle seconds)cl2 8 (180)。 显示 Changelog #44,在某个设备上 (lustre-MDRO000) 显示当前 Changelog #549 :mds# lctl get Param mdd.lustre-MDTO0000.changelog maskmdd.lustre-MDTO000.changelog_mask=MARK CREAT MKDIR HLINK SLINK MKNOD UNLNK RMDIR RENME RNMTO CLOSE LYOUT \\TRUNC SATTR XATTR HSM MTIME CTIME MIGRT。 设置 Changelog #44,在某个设备上 (lustre-MDRO0000) 设置 Changelog #805:mds# lctl set param mdd.lustre-MDT0000.changelog_mask=HLINKmdd.lustre-MDTO000.changelog_mask=-HLINK$ lis changelog clear lustre-MDTO000 cll 0S mkdir /mnt/lustre/mydir/fooS cp /etc/hosts /mnt/lustre/mydir/foo/fileS In /mnt/lustre/mydir/foo/file /mnt/lustre/mydir/myhardlinkATMS HE AY A RANA TE Changelog 中显示:S lfs changelog lustre-MDTO0009 O3HLINK 16:06:35.291636498 2018.01.09 0x0 t=[0x200000402: 0x4:0x0] ef=Oxf \\u=500:500 nid=10.128.11.159@tcp p=[0x200000007: 0x3:0x0] myhardLlink12.1.3 Changelogs 审计Lustre Changelogs 的一个特殊用例是审计。根据其在维基百科上的定义，信息技术审计被用来评估机构的信息资产保护及合理分发信息至授权机构的能力。基本上，饭根113\nLustre 文件系统操作手册 译者:这aXTe 4 Wa oh NS MT A OC TET",
        "信息技术审计被用来评估机构的信息资产保护及合理分发信息至授权机构的能力。基本上，饭根113\nLustre 文件系统操作手册 译者:这aXTe 4 Wa oh NS MT A OC TET Pll, TR PR a TI] A RR SGMh oBATE AY LA ee eS ED, (ALT PRY tat i BS SES VY HED 3Lustre Changelogs 提供了很好的审计机制，他是一个集中化的工具，易于交互。Changelogs 包含了用于审计的所有必要信息:。文件标识符 (FEIDs) 和目标名称可用于识别活动对象。。UID/GID FI NID 信息可用于识别活动主体。。 时间戳可用于读取活动时间。12.1.3.1 启用审计功能如果需要一个功能齐全的基于 Changelogs 的审计工具，必须司用一些额外的Changelog 记录类型 ，以便能够记录诸如 OPEN, ATIME, GETXATTR 和DENIED OPEN等事件。请注意，司用这些记录类型可能会对性能造成一些影响。比如从文件系统的角度来看，进行读操作时，记录 OPEN 和 GETXATTR 事件将生成 Changelog 记录写入。从审计角度来看，能够记录 OPEN 或 DENIED OPEN 等事件很重要。例如，如采使用 Lustre 文件系统在致力于生命科学的系统上存储医疗记录 ，则数据隐私至关重要。管理员可能需要知道某个病历有哪些医生访问或尝试访问，何时进行的访问; 以及某个医生访问了哪些医疗记录。要局用所有更改日志条目类型，请执行:—mds# lctl set param mdd.lustre-MDT0000.changelog_mask=ALL2 mdd.seb-MDTO000.changelog_mask=ALL一旦所有必需的记录类型都被启用了，只需注册一个 Changelogs 用户，审计工具即可运行。注意，通过nodemap 条目上的audit mode 标志，可以控制哪些 Lustre 客户端季氮可以触发文件系统访问事件在 Changelogs 生产记录。为防止某些节点 〈如备份，HSM 代BT) 使审计日志溢出，我们在 per-nodemap 基础上茶用审计。当 nodemap 条目中的audit mode 标志为1，且 Changelogs 已被激活",
        "，格式为x=<xattz name>.。SETXATTRSETXATTR changelog 条目格式如下:1 4 15XATTR 09:41:36.157333594 2018.01.10 0x0 t=[0x200000402:0x1:0x0] \\2 ef=0xf u=500:500 nicd=10.128.11.159@tcp x=user.nameO它包含了被更改的附加属性名，格式为x=<xattz name>.。DENIED OPENDENIED OPEN changelog 条目格式如下:1 4 24NOPEN 15:45:44.947406626 2017.08.31 0x2 t=[0x200000402:0x1:0x0] \\2 ef=0xf v=500:500 nid=10.128.11.158@tcp m=-w-GORA A Ay WL OPEN 2 FA fH Ia] HY fa ko A WE @ changelog jit i, DE-NIED OPEN 条目受速率限制: 即每个时间间隔每个用户每个文件不得超过一个条目，此时间间隔《〈以秒为单位，软认值为60 秒) 可通过mdd.<mdtname>.changelog deniednextx=<xattr name>设置。115\nLustre 文件系统操作手册 译者:这aymds# lctl set param mdd.lustre-MDT0000.changelog_deniednext=120mdd.seb-MDTO000.changelog_deniednext=120mds# lctl get param mdd.lustreMDT0000.changelog_deniednextmdd.seb-MDTO000.changelog_deniednext=12012.2. Lustre JobstatsLustre jobstats 功能为运行在 Lustre 客户端上的用户进程收集文件系统操作统计信妃，并使用作业调度程序为每个作业提供唯一的作业标识符 (JobID) ，再通过服务右输出。已知的能够与 jobstats 合作的作业调度程序包括: SLURM, SGE, LSF, Loadleveler,PBS, LAA Maui /MOAB。Lustre jobstats 功能收集在 Lustre 和客户端上运行的用户进程的文件系统操作统计，并由于 jobstats 是以不依赖于调度程序的方式实现的，因此饭能够与其他调度程序一起工作，也能在不使用作籽调度融的环境中，通过在 jobid_name 中存储自定义格式字符串来使用。12.2.1 Jobstats 如何工作客户端上的",
        "EW PA CA AY Changelogs 条目不会被清除〈请参阅 全 changelog_clear相关信息)。12.1.1.21fs changelog 在MDT 上显示元数据变更 (changelog 记录) ，请运行:lfs changelog fsname-MDTnumber [startrec [endrec] ]可选择是否指定开始和结束记录。以下是 changelog 记录示例:1 O2MKDIR 15:15:21.977666834 2018.01.09 0x0 t=[0x200000402: 0x1: 0x0]jJamkdir.500 ef=Oxf \\u=500:500 nic=10.128.11.159tcp p=[0x200000007: 0x1:0x0] pics2 OICREAT 15:15:36.687592024 2018.01.09 0x0 t=[0x200000402: 0x2: 0x0]j=cp.500 ef=Oxf \\u=500:500 nic=10.128.11.159@tcp p=[0x200000402: 0x1:0x0] chloe.jpg3 O6UNLNK 15:15:41.305116815 2018.01.09 Ox1l t=[0x200000402: 0x2: 0x0]j=rm.500 ef=Oxf \\u=500:500 nic=10.128.11.159@tcp p=[0x200000402: 0x1:0x0] chloe.jpg4 O7RMDIR 15:15:46.468790091 2018.01.09 0x1 t=[0x200000402: 0x1: 0x0]j=rmdir.500 ef=Oxf \\u=500:500 nic=10.128.11.159tcp p=[0x200000007: 0x1:0x0] pics12.1.1.31fs changelog clear 为某个特定用户清除老的 changelog 记录 (该用户不再需要的记录) ，请运行:lfs changelog clear mdt_ name userid endrec110\nLustre 文件系统操作手册 译者:这aychangelog clear命令说明该用户对 endrec 之前的 Changelog 记录已经不再感兴趣，这也使得 MDT 能够释放一部分磁盘空间。当 endrec 值为0 时，表明清除到当前最后一条记录。要运行 changelog clear, changelog 用户必须已经通过 lctl 命令在MDT 节Fa _ETEM当所有 changelog 用户处理完成了某个节点之前的记录时，记录被完全删除。12.1.1.4 Lect1 changelog deregister 注销 changelog 用户 ，",
        "lctl 命令在MDT 节Fa _ETEM当所有 changelog 用户处理完成了某个节点之前的记录时，记录被完全删除。12.1.1.4 Lect1 changelog deregister 注销 changelog 用户 ，请运行:lctl --device mdt_ device changelog deregister useridchangelog deregister cll 在完成注销操作时，相当于快速执行了 lfs changelog clearcll 0 命令。12.1.2 Changelogs 命令示例以下是一些不同的 Changelogs 命令的示例。 注册 Changelog 用户为某个设备 (lustre-MDT0000) 注册一个新的 Changelog HF:mds# lJctl --device lustre-MDT0000 changelog registerlustre-MDTO000: Registered changelog userid ‘'cll'。 显示 Changelog 记录在MDT 上显示 Changelog 记录 :S lfs changelog lustre-MDTO0001 O2MKDIR 15:15:21.977666834 2018.01.09 0x0 t=[0x200000402: 0x1:0x0] ef=Oxf \\u=500:500 nid=10.128.11.159@tcp p=[0x200000007: 0x1:0x0] pics2 O1CREAT 15:15:36.687592024 2018.01.09 0x0 t=[0x200000402: 0x2:0x0] ef=Oxf \\u=500:500 nid=10.128.11.159@tcp p=[0x200000402: 0x1:0x0] chloe.jpg3 O6UNLNK 15:15:41.305116815 2018.01.09 0x1 t=[0x200000402: 0x2:0x0] ef=Oxf \\u=500:500 nid=10.128.11.159@tcp p=[0x200000402: 0x1:0x0] chloe.jpg4 O7RMDIR 15:15:46.468790091 2018.01.09 0x1 t=[0x200000402: 0x1:0x0] ef=Oxf \\u=500:500 nid=10.128.11.159@tcp p=[0x200000007: 0x1:0x0] picsChangelog 记录包含了如下信息:LeCHoperation type (numerical/text)timestampdatestamp111\nLustre 文件系统操作手册%my这ay5 flags6 t=target FID7 ef-extended_flags8 u=uid:gid9 nid=client NID10 p=parent FID11 target name显示格式为:—rec# operation type",
        "〈如备份，HSM 代BT) 使审计日志溢出，我们在 per-nodemap 基础上茶用审计。当 nodemap 条目中的audit mode 标志为1，且 Changelogs 已被激活时，与此 nodemap 有关的客户端将能够完成文件系统访问事件的 Changelogs 记录。当设置为 0 时,无论 Changelogs 是否激活，件都不会记录到 Changelogs 中。默认情况下，在新创建的nodemap 条目中，audit mode标志被设置为 1。同时，它在' 默认modemap 中也被设置为 1。为防止与 nodemap A XIN AA4E He Changelogs 条目，请执行以下操作:TWalin!1 mgs# lctl nodemap modify --name nml --property audit mode --value 0114\nLustre 文件系统操作于册 译者:这ay12.1.3.2 审计功能示例。 OPENOPEN changelog 条目的格式如下:1 7 100PEN 13:38:51.510728296 2017.07.25 0x242 t=[0x200000401:0x2:0x0] \\2 ef=0x7 v=500:500 nid=10.128.11.159@tcp m=-w-它包含了有关打开模式的信息，格式为m = rwx.在茶种打开模式下，针对每个UID /GID ，只要该文件没有被关闭，OPEN 条目只记录一次。这样的话，即使有一个 MPI 作业从不同的线程打开同一文件几和干次，changelog会溢出。它在不影啊审计信息的情况下显着降低了 ChangeLog 负载。同样，对于CLOSE 条目，也只记录每个UID /GID 的最后一条 CLOSE.。 GETXATTRGETXATTR changelog 条目的格式如下:1 8 23GXATR 09:22:55.886793012 2017.07.27 0x0 t=[0x200000402:0x1:0x0] \\2 ef=0xf u=500:500 nicd=10.128.11.159@tcp x=user.nameb0它包含了被评估的附加属性名，格式为x=<xattz name>.。SETXATTRSETXATTR changelog 条目格式如下:1 4 15XATTR 09:41:36.157333594 2018.01.10 0x0 t=[0x200000402:0x1:0x0] \\2",
        "fsname testfs --mgsnode=192.168.10.1@o03ib \\--index=0 —-servicenode=192.168.10.7@o2ib \\-—-servicenode=192.168.10.8@o2ib \\/dev/sdb106\nLustre 文件系统操作手册 译者: 李硕可为目标指定两个以上的漠在服务节点。可在任何指定的服务节点上载入目标。在存储目标上配置 HA 时，Lustre 软件会司用该存储目标上的重复挂载保护(Multiple Mount Protection, MMP). MMP 可防止多个节点同时挂载，从而造成目标上的数据损坏。如果 MGT 在格式化时被指定了多个服务节扣，那么这个信息必须通过文件系统的mount 命令传递给 Lustre 各户端。在下面的示例中，我们在客户端上执行的 mount 命令，指定了两个可为 MGT 提供服务的 MGSs “3 A{HY NIDs:1 mount -t lustre 10.10.120.1@tcp1:10.10.120.2@tcpl:/testfs /lustre/testfs当客户端挂载文件系统时，MGS 回客户端提供文件系统的配置信息 (MDT 和 OST的相关信息，每个目标关联的所有服务和氮的NID，以及当前载入目标的服务节点)。随后，当客户端发起目标上的数据访问时，它会笠试每个指定的服务节点的NID ，直到成功连接到目标。在 Lustre 2.0 之前, mkfs.lLustre的-=-failnodqe选项用于为目标的主服务器指定故障切换服务节氮。当使用--failnoqe选项时，存在一些限制:。 目标必须首先在主服务节点上载入，而不是--failnode选项所指定的故障切换节点。。 如果使用tunefs.Lustre 的-=-wziteconf选项柳除并重新生成文件系统的配置日志，则目标的初次排载不能在--failnode指定的故障切换节点上执行。。如果使用--failnoqe选项 添加故障切换服务器到存储目标上，那么在--failnode选项生效前，儿须将目标重新装载到主节点上。第十二章 Lustre 文件系统监控配置12.1. Lustre ChangelogsChangelogs 〈更新日志) 功能负责记录文件系统名称空间或文件元数据变更事件。请如文件创建，删除，重命名，属性变更等，这些修改将与目标文件标识符 (FID)",
        "my这ay5 flags6 t=target FID7 ef-extended_flags8 u=uid:gid9 nid=client NID10 p=parent FID11 target name显示格式为:—rec# operation type (numerical/text) timestamp datestamp flags t=target FID \\2 ef=extended_flags u-uid:gid nid-client NID p=parent_FID target name如:2 O1CREAT 15:15:36.687592024 2018.01.09 0x0 t=[0x200000402: 0x2:0x0] ef=Oxf \\—2 u=500:500 nic=10.128.11.159%@tcp p=[0x200000402:0x1:0x0] chloe.jpg。 清除 Changelog 记录通知设备某个特定用户 (cll) 已经不需要相关记录 (3 及3 之前的):$ lfs changelog clear lustre-MDT0000 cll 3确认 changelog clear 操作成功，运行 Ifs changelog。我们看到只显示了 id-3 以后的SA:S lfs changelog lustre-MDTO000—2 4 O7RMDIR 15:15:46.468790091 2018.01.09 0x1 t=[0x200000402: 0x1:0x0] ef=Oxf \\ULDu=500:500 nid=10.128.11.159%tcp p=[0x200000007:0x1:0x0] pics。 注销 Changelog 4在革个设备上 (lustre-MDRO000) 注销革个 Changelog 用户 (cll):1 mds# lctl --device lustre-MDT0000 changelog deregister cll2 lustre-MDTOO00: Deregistered changelog user 'cll'注销操作清除了该用户所有 Changelog 记录。1 $ 1Lfs changelog Lustre-MDT00002 5 OOMARK 15:56:39.603643887 2018.01.09 0x0 t=[0x20001: 0x0: 0x0] ef=Oxf \\3 u=500:500 nid=0@<0:0> p=[0:0x50:0xb] mdd_obd-lustre-MDT0000-0注意MARK 记录表明了 Changelog 记录状态变化。112\n——ULDNn—ULDNn—ULDLustre 文件系统操作手册 译者:这ay”显示 Changelog"
    ]
}