{
    "query": "值班员发现某ION节点失去连接后，第一步应检查哪些内容？",
    "summaries": [
        "登录节点故障包括失去连接/宕机和负载过高。对于宕机，可通过堡垒机或监控平台确认节点状态，并通过运维平台重启。对于负载过高，可按CPU或内存查看用户进程，清理高占用进程或用户全部进程以降低负载。",
        "链路断开时需确定端口位置，区分SWM-NRM、SWM-SWM或SWM-IO类型，使用脚本训练端口或拔插光纤。通道数减少影响带宽但不影响通信，可暂缓处理。握手变化或重传次数过多需关注，但一般不紧急处理。根据报警级别采取相应措施，如绕路由、重启服务器或联系二线处理。",
        "文本主要描述了处理网络故障的步骤和方法。首先检查是否能通过ssh登录，若无法进入系统，需检查IB网卡指示灯状态，必要时更换网卡。若系统正常，则参考特定章节处理ION链路。同时，观察高速网卡指示灯，通过交换网线判断故障原因。对于MDs失去连接的情况，需挂起作业、重启并检查存储分区链接状态。此外，还涉及网络报警的判断、板卡编号转换、报警PU与芯片端口转换、使用脚本确定链路位置及查看网络链路状态等操作。"
    ],
    "contents": [
        "ost127\nost127\n\n—\n\njobid\n\n1828258\n1818914\n1827402\n\nsftp-server.20654\n\nnode.20912\n1768786\nbash20461\nsftp-server.20528,\n1796896\n1825828\n\n读次数\n\njobid\n\n1818914\n1827772\n1827855\n1827875,\n1827858\n1827871\n1827872\n1827751\n1825099\n1827402\n\n1143\n7.89\n3.73\n245\n137\n4.19\nO71\n0.69\n\n03\n\n1237\n873\n615\n591\n5.33\n5.28\n4.01\n0.94\n\n06\n可以看到排序靠前的jobid。\n3.4 登陆节点故障\n3.4.1 登录节点失去连接/宕机\n监控平台报警如下：\nth-hpct-Ino\n\n失去连接\n\nTH-HPC\n\n登录节点\n\n硬件\n\n。严重\n①首先判断登录节点是否真的宕机，可以通过堡垒机ssh到登陆节点查看状态，也可以通过监控平台的节点操作里查看节点状态。\nTH-HPq\n其他操作 节点操作\n\n下ec 节点编号: th-hpc1-In0\n日 @ TH-HPC\n四 HPC1-127序号: 2523所属集群 TH-HPC硬盘大小: 无硬盘\n日 login节点名称: th-hpc1-In0所履分区: _null硬盘类型. 无硬盘\n\n@ th-hpct-Inoao\n\n:登录节点存储位置: 老机房-TH-HPC-HPC1-127-12.0\n②确认登录节点宕机后，可以通过运维平台直接重启，如下图：\n统一监控运维平台\n\nTH-HPC\n\nTH-HPC4PDTH-HPC\na fre] @\n剧本编排日 局 存储分区操作\n加THL5登陆节点部署客户端.， MDS节点部署客户.， 0ST节点部署客户.计算节点部署客户端.\n剧本执行四THL6\n局THL7el\n执行审计Otis查询传感器日志远程协助®\n© 资源操作\n局 用户操作\n© 作业操作\n© 服务操作\n号 数据拷贝\n号 应急操作\n2 批量操作\n®\n您确定要执行电源管理操作吗?\n3.4.2 负载过高\n（1）选择按CPU或内存查看导致系统负载过高的用户进程。\n统一监控运维平台= 运维管理axa @\n\n定制大屏机房运维总览剧本执行\n\nTH",
        "报警对应的编号查找对应关系。将板卡编号转换成脚本的格式，将PU光口转换成芯片号+端口号。可以参考上边NRM对应关系，也可以参考以下表格或者服务器中的文件/home/test641/smu/nrm_port_train/nrm-pu-port.list。\n例子：报警项S05A01PU08 对应脚本中的输入为2 6 S05C0SWM1\n5.2.1.4 根据报警确定位置\n脚本：swm_opposite_port.sh\n目录：mn31：/home/test641/smu/swm_port_train/\n./swm_opposite_port.sh+芯片号+端口号+板卡号 可以查看此端口的对端。主要查看该端口对端，来确定该链路是swm-nrm、swm-swm、swm-io服务器。\n例如：\n[root@nn31%TH3 swm_port_train]# ./swm_opposite_port.sh 2 6 S95C9SWM1\n\noptical_port\n3 9 POO9CO2NRM1 (307.0)SWM-NRM\n\n[root@nn31%TH3 swm_port_train]# ./swm_opposite_port.sh 2 6 IONCOSWML\noptical_port\n\nPT6 S020SWM-SWM\n\n2 16 S@2COSWM3 (4366.16)\n[root@nn31%TH3 swm_port_train]# ./swm_opposite _port.sh 3 6 IONC9SWM8\n\noptical_portSWM-io服务器\n\nLink to Service: ions’\n5.2.1.5 查看板卡的网络链路\n查询NRM：/home/test641/smu/nrm_port_train/nrm_train_read.sh\n[root@mn31%TH3 nrm_port_train]# ./nrm_train_read.sh P911CO1NRM1\nse PO11COINRMI FH\nback=====\n\n----chip 3----\n3-31-P18:14 0\nPU18: 3 32 S@4C2SWM1 (4999.32)\n查询SWM：/home/test641/smu/swm_port_train/swm_train_read.sh\n[root@nn31%TH3 swm_port_train]# ./swm_train_read.sh S94C2SwWM1\n- S94C2SwM1-9 =\n- Se4C2SWM1-1 -\n\nP@",
        "的板卡掉电，先用绕路由脚本把该板卡绕过去，然后可查询掉电原因，在部门群里通知。如果是ION/IOS板卡掉电，立即联系二线确认影响范围、联系科大更换对应板卡。\n机柜掉电：先联系运维查看供电情况，不清楚影响情况联系二线。\nnetwork故障报警：如果节点不多，值班人员先drain起来即可；如果节点很多，且10分钟仍没有恢复，需要联系二线确认一下。\n5.2.3 链路问题\n5.2.3.1 链路断开\n说明：链路断开先确定位置以及报警的两个端口，即确认是SWM-NRM、SWM-SWM或者是SWM-IO服务器。一般来讲，SxxxxxPUxx链路断开是SWM-NRM；同时SxxxxxPUxx和IOxxxxPUxx链路断开或者IOxxxxPUxx和IOxxxxPUxx断开，是SWM-SWM；IOxxxxPUxx断开是SWM-IO。如果是SWM-IO参考5.2.2服务器链路。\n报警项：SxxxxxPUXX链路连接断开\nS16B02PU13链路断开链接\n\nS16B02PU12链路断开链接\n\nS16A02PU16链路断开链接\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\n管理节点\n\n管理节点\n\n管理节点\n\n硬件\n\n硬件\n\n硬件\n\nPe\n\n° PH\n\n° PH\n处理方法：\n链路断开（握手失败）可以先尝试使用脚本进行端口训练。\n根据报警的PU端口号，对照下图中的芯片+端口号，然后使用脚本进行训练。\n|\n\nCOCORCOSS\n\n| |\n\n2 OO\n\nCOGOTOGOS\n\nCOCORCOOS\n\n2 3Ee\n\nLs]\n\nNI\n\n‘3aEe!\n\nNalBs\n\n25 | 13 | 35 | 36\n[ORR] OCH] TAY\non | os | a5\n\n30H |\n7\npry\n\n[Rer ae SCH] IC\n\nalgloele|\n\nORR] OO] SE\n\n片\n\nR50_0\n\n站\n‘1G [elelslals ss]\n\nR50[2]芯\n\nLas\n\nNT\nKNee\nNE ae\nNd cele\nBal ale\nKN aa 国\n=ma\nsae FF\nia\naa1\nHL 只\nHi ©\nHa\n|\n| RS\nKal\n| Bl\n|",
        "可以ssh进去。\n2．若没有系统，或开机卡住，观察ib网卡（插一根绿线的）是否有绿灯闪烁或常量。若不亮，更换ib网卡。\n3.若进系统正常，参考5.2.2，处理ion链路。\n4.观察ion观察高速网卡（插两根绿线或橙线的）两个网口，是否有绿灯闪烁或常量，正常未两个网卡灯常亮。可交换两根高速网线再插入，判断是否为高速网卡故障：若交换后网口指示灯无变化，更换高速网卡；若交换接口后指示灯状态有变化，联系科大值班人员更换高速网线。\n5.1.6 mds失去连接\n1)挂起对应分区作业。\n剧本编排\n\n剧本执行\n\n其他操作 节点操作\nTH-HPC4\nTH-HPC\nTH-eX\n© TH-3F\nBO 存储分区操作\n© thfst\n\nTH-eX = TH-3F\n\n全 TH-3F > thfs1\n\n分区作业恢复AR EE\n2)重启\nTHeX = TH-3F\n\n其他操作 节点操作一\n\n总览TH-HPC4DPTH-3F\n\n:TH-HPC\n\n剧本编排>TH-eX\n\n1903网络报警ION RABE...SRT RESP in.MDS RBBSP...OST RABEEP...\nRIMSDBRS ME\nO 资源操作\n\n0 用户操作\n\nOf 作业操作\n\n© 服务操作\n\nO 数据拷贝\n\n局 应急操作\n\n=)\n\n查记ipmi日志AAS\n您确定要执行电源管理操作吗?\n\n* 节点名 ”mds0\n\n+动作 | 重启\n3）等待报警消失。查询存储分区的链接数是否正常（healthy即正常）。\n4）恢复作业。\n剧本编排\n\n剧本执行\n\n其他操作 节点操作\nTH-HPC4\nTH-HPC\nTH-eX\n© TH-3F\nBO 存储分区操作\n© thfst\n\nTH-eX = TH-3F\n\n全 TH-3F > thfs1\n\n分区作业恢复AR EE\n5.2 网络故障\n出现网络报警，应首先判断影响范围，是链路断开、板卡掉电、整个机柜掉电、连接高速网的服务器死机或重启。\n5.2.1网络脚本输入说明",
        "吗?\n3.4.2 负载过高\n（1）选择按CPU或内存查看导致系统负载过高的用户进程。\n统一监控运维平台= 运维管理axa @\n\n定制大屏机房运维总览剧本执行\n\nTH-HPC\n其他操作\n\nth-hpct-IndQ\n\n5cq 节点编号: th-hpc1-Ind\n\n日| s TH-HPC\nFRE: 2523所属集群 TH-HPC\n\n剧本编排~加 HPC1-127\n日 login节点名称: th-hpc1-In0所属分区:_null\na节点类型: 登录节点存储位置: 老机房-TH-HPC-HPC1-\n127-12.0\n执行审计\n查询日志查询内存清除进程清除用户进程\nth-hpc1-In0:cpu进程排序 X\n\n天对执行\n命令输出:\n\nPLAY [a] ws本洒洒洒洒末末洒洒宁洒洒末末\n\nchanged: [121.16.3.1]\n\nSPU/内存的使用排序\n\nok: [121.16.3.1] =>\nesRBFES, EEZIDmt进程命令\nVSZ RSS TTYSTAT STARTTame [command™,]\nangyq 5735@.2 308900 148640 pts/101 Rt 09:04 10:28 ncl 16.ncl”,\nroot33364 12.6 0.0 124128 6408 ?S69:15 “6:63 /bin/sh /usr/local/bin/rkhunter -c -\ninxubo 21825 5.@ @.@ 125488 3844 pts/128 Ss+ 89:15 ”9:68 -bash\"，\n“wangyq 40400 4.9 0.2 308896 148628 pts/101 T 09:02 0:37 ncl 16.ncl\",\n\n\"nslcd2398 3.2 ©.0 442336 1432 ?Ssl 4月16 1429:26 /usr/sbin/nslcd\",\n\n\"root888 2.1 0.0 95640 38540 ?Ss 4月16 958:11 /usr/lib/systemd/systemd-journald\",\n\"linxubo 22342 2.0 @.@ 59000 2240 ?Ss 09:15 @:0@ /usr/libexec/openssh/",
        ":11 /usr/lib/systemd/systemd-journald\",\n\"linxubo 22342 2.0 @.@ 59000 2240 ?Ss 09:15 @:0@ /usr/libexec/openssh/sftp-server\",\n\"root2264 1.4 @.1 5182264 106456 ?SLsl 4月16 644:38 /opt/thsre/exporters/telegraf/telegr\n“root21684 1.0 0.0 159956 5688 ?Ss 9:15 0:0 sshd: linxubo [priv]\",\n\n\"linxubo 22501 1.0 6.9 119748 2028 ?Ss 69:15 @:0@ bash -c while true; do sleep 1;head\n图：按CPU使用率查看用户进程\n（2）清理用户的某个进程。通过第一步得到使用率高的进程ID。\n统一监控运维平台运维管理 、\n\nSAR 。 机房 运维总览\nTH-HPC\n其他操作 节点操作\nth-hpct-IndQ\non?\n日 @ THHPC\n剧本编排日 HPC1-127\nlogin\n剧本执行© th-hpct-Ind\n\n节点编号: th-hpc1-In0\n\n序号: 2523\n节点名称: th-hpc1-In0\n\n节点类型: 登录节点\n\n查询内存\n\n所属集群 TH-HPC\n\n所属分区:_null\n\n存储位置: 老机房-TH-HPC-HPC1-\n127-12.0\n\nvo 清除单个进程\n\n清除用户进程\n\n硬盘大小: 无硬盘\n\n节点状态: 连接成功 |\n\ncpu进程排序\n统一监控运维平台\n\n定制大屏me\n\n运维总览剧本执行\n\n其他操作 。 节点操作\n\nth-hpc1-In0\n\n日 @ THHPC\n©) HPC1-127\n\nlogin\n\n© th-hpct-Ind\n\n存储位置: 老机房-TH-HPC-HPC1-\n127-12.0\n\n查询日志\n\n查询内存SHE=a\nAIRS\n\n硬盘大小: 无硬盘\n硬盘类型; 无硬盘\n\n节点状态: sea\n\ncpu进程排序\n（3）清除用户全部进程。通过第一步得到使用率高的用户名",
        "分区作业恢复AR EE\n5.2 网络故障\n出现网络报警，应首先判断影响范围，是链路断开、板卡掉电、整个机柜掉电、连接高速网的服务器死机或重启。\n5.2.1网络脚本输入说明\n5.2.1.1 针对板卡编号\n不同脚本对板卡的编号不一样，有的是用ABCD表示4个框，有的用C0、C1、C2、C3表示，有的用C00、C01、C02、C03表示。可以脚本先回车看看示例。\n5.2.1.2 关于cmu\n根据yhst+报警板卡 可以查询到对应的cmu。\n[root@nn31%TH3 ~]#| yhst_S14C3SWM2\n\nsmu_transfer_cmd| r3.pi5d.m |yhst\n\n|\n| SwM69 SWMO1 SWM@2 SWMO3 SWMO4 SWMO5 SWMO6 SWMO7 SWMO8 SWMO9 SWM10 SWM11 SWM@12 SWM13 SWM14 SWM15 |\n|1111111111111111|\n\nNetWork ERROR\n如图中 yhst S14C3SWM2查询出cmu编号r3.p15d.m。\nr3. p15d. m\n\nf4NN\n\nHS 机柜号 框号 EM\n\n| 0-2:计算柜 00-19 “|A框:a |主:m\n\n= 3 :通信柜_| BHE:bMes\n| 4-6: 计算柜C框:c\n\nLD框:d\ncmu编号也是板卡的物理位置。如S14C3SWM2对应的物理位置是R3排P15柜D框SWM2.\n5.2.1.3 报警PU和芯片端口转换\nNRM（SWM一样）各端口对应：\nit\n\ncoee GOGO\n\n| | | 1\n\nPOO? 9\n\n]\n\nit\n网络相关脚本一般的输入是板卡+芯片+芯片端口，报警一般是板卡+PU号，使用脚本的时候需要进行转换。\nS14A02PU13链路断开链接\n\nS13D02PU16链路断开链接\n\nS09B02PU12链路断开链接\nS05AO1PU08\n柜框板号 光口\n2 6 SOSCOSWM1\n上图是报警对应的编号查找对应关系。将板卡编号转换成脚本的格式，将PU光口转换成芯片号+端口号。可以参考上边NRM对应关系，也可以参考以下表格或者服务器中的文件/home/test641/smu/nrm",
        "Nd cele\nBal ale\nKN aa 国\n=ma\nsae FF\nia\naa1\nHL 只\nHi ©\nHa\n|\n| RS\nKal\n| Bl\n| selk\n-一全\n\nLaz} a2 | 10 | 22 | 20 | 22 | 23\n./lanebist_train_opposite_port.sh+芯片号+端口号+板卡号 可以同时训练此端口和对端。\n[root@mn31%TH3 ~]# cd /home/test641/smu/nrm_port_train/\n[root@mn31%TH3 nrm_port_train]# ./lanebist_train_opposite_port.sh 2 6 S05C0SWM1\n[root@nn31%TH3 nrm_port_train]# ./lanebist_train_opposite_port.sh 3 6 P699C92NRM1\n\nlanebist train PCB P699C92NRM1 3:0----2:6 S95C9SWM1\n0x01ff000511b8该行倒数3、4位是e9表示握手成功 (MISES) , eM ERIKS.\n\n6x000000000032014T) 该行最后一位是f表示通道数正常 (网络带席正常) ，非债示带遍小，但不影响网络通信\n如果上述操作处理不好，可以根据端口号去机房拔插一下两端的光纤线。参考5.2.1.4使用脚本swm_opposite_port.sh查询对端，并将芯片+端口转换成PU的格式（参考5.2.1.3），在机柜上寻找对应的标签。以上面的例子来说：\n3 0 P009C02NRM1 对应P009C02NRM1PU20\n2 6 S05C0SWM1 对应 S05C0SWM1PU08\n在机房分别拔插这两个端口。要把两端的线都拔掉，再依次插上。再重复一次（1）中的操作。\n如果拔插还是不行，联系科大641处理。\n5.2.3.2 链路通道数减少\n报警项（黄色警告）：xx通道数减少\nS02A02PU22,通道数减少\n\nTH-3F\n\n管理节点\n\n硬件\n与5.2.3.1处理方法一样，但是一般不着急处理，通道数减少只影响带宽，并不影响链路的通断。\n5.2.3.3 链路握手变化/重传次数过多\n报警项（黄色警告）：xx链路端口握手变化/xx链路端口重传次数",
        "_read.sh\n[root@nn31%TH3 swm_port_train]# ./swm_train_read.sh S94C2SwWM1\n- S94C2SwM1-9 =\n- Se4C2SWM1-1 -\n\nP@11CO1NRM1\nP@13COONRM1\nP@13CO1NRM1\nP@13CO2NRM1\nP@13CO3NRM1\nP@14COONRM1\nP@14CO1NRM1\nP@14CO2NRM1\nP@14CO3NRM1\n<=port no used.\n\nf\nf\nf\nf\nf\nf\nf\nf\nf\n0\n以上“14 0”、“14 f”表示链路断开。\n5.2.2 网络报警一些说明\n0平面普通通信机柜（S00-S07）单条链路断开报警，报警级别是警告，值班人员无需立即处理，可以尝试训练链路或拔插光纤。累计4条以上警告会触发红报警，值班人员需要注意。\n1平面普通通信机柜（S09-S16）单条链路断开报警，报警级别是严重，需要立即处理，可以尝试训练链路或拔插光纤，拔插无效可以通过路由容错（绕路由）脚本（参考5.2.9）将该框先绕过去。\nION/IOS通信机柜链路报警，单条链路或多条链路断开，确认是通信机柜互联还是连接服务器的端口。如果是通信机柜互联，一般需要立即处理，需要确认是否有板卡掉电，若无掉电，需要训练链路或拔插光纤；若是服务器端口，需要确认对应服务器是否死机，若服务器死机则重启服务器，若未死机只有高速网有问题，则查找服务器的光纤端口，进行拔插。\nNRM掉电：影响本框作业，判断板卡位置，S00-S07每框有一条链路断开即为0平面nrm掉电，可以按照手册处理，此时节点通信还在，只要不是读写高的作业都能拯救，如果恢复不成功，需要报告二线处理；如果报警是S09-S16每框一条链路，那么是1平面nrm掉电，对应框的作业已经掉了，可以尝试按照手册处理，第二天再报告二线即可。\nSwm掉电：查询掉电板卡位置，如果是S00~S07、S09~S16机柜的板卡掉电，先用绕路由脚本把该板卡绕过去，然后可查询掉电原因，在部门群里通知。如果是ION/IOS板卡掉电，立即联系二线确认影响范围、联系科大更换对应板卡。\n机柜掉电："
    ]
}