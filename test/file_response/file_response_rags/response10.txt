{
    "query": "如何向 Lustre 系统新增一个 OST？操作步骤包括哪些关键命令？",
    "summaries": [
        "Lustre 文件系统操作手册摘要：当 OST 损坏时，可使用 `mkfs.lustre` 命令替换故障 OST，并通过 `--replace` 选项恢复配置。若配置文件不可用，可从其他 OST 复制 `mountdata` 文件。挂载新 OST 后，需恢复配置并重新激活。若 OST 不可用，需在 MGS 中更新状态。可通过 `lctl` 命令获取 OST 节点信息，更改故障节点地址或分离 MGS/MDT。操作需注意备份与配置恢复，确保文件系统正常运行。",
        "Lustre 文件系统操作手册摘要：介绍了如何创建和挂载 Lustre 文件系统，包括使用 mkfs.lustre 命令创建 MGS、MDT 和 OST，以及通过 mount.lustre 挂载文件系统。详细说明了挂载选项，如 mgsname、block_device、安全设置、flock 选项、statfs 行为等，帮助用户优化和管理 Lustre 文件系统。",
        "文本主要介绍了Lustre文件系统中添加和管理MDT（元数据目标）及OST（对象存储目标）的操作步骤。包括在下一个可用索引处添加新的MDT设备、挂载MDT、创建文件或目录并指定其所在的MDT，以及添加新OST、平衡OST空间使用和移除或恢复MDT/OST的方法。同时提到将OST或MDT设置为不活跃状态的场景和影响，以及如何永久停用MDT。"
    ],
    "contents": [
        "Lustre 文件系统操作手册这ay选项block_ device44.15.3. 选项选项mgsname=mgsnode [:mgsnode ]mgsnode=mgsnid[,mgsnid]mgssec=flavor说明在物理磁盘 block_device 上局动由mkfs. lustre (8) 命令定义的目标服务。指定block device，可使用1 label 来查找具有该标签 (如testfs-MDT0000) 的第一个块设备，或通过U uuid 选项使用UUID。如果在同一节点上存在目标文件系统的设备级备份，请格外小心。这是因为如果目标文件系统没有使用tune2fs (8)或类似命令进行更改，会产生重复的标签和 UUID 。挂载在 mountpoint 上的目标服务文件系统仅对qf (1) 操作有用，并会出现在/Proc/Vmounts中，表明该设备正在使用中。说明mgsname 是以冒号分隔的 mgsnode 名称列表，可运行 MGS 服务。如果 MGS 服务配置为 HA 故障切换模式且可能在任何一个节点上运行，则可指定多个 mgsnode 值。如果 mgsnode 有不同的LNet 接口，则每个mgsnode 通过逗号分隔的 NID 列表进行指定指定连接 MGS 的初始网络 RPC 的加密特性。砷安全的特性有: nul1，Plain和gssnul1，分别表示用于测试目的的蔡用、无加密功能或非完整性功能。Kerberos 特性有: krb5n,krb5a，krb5i和krb5p。共享密钥的风格有: skn，ska，ski和skpi。客户端到服577\nLustre 文件系统操作手册这ay选项 说明务髓连接的安全特性在客户端从 MGS 获取的文件系统配置中指定。skpath=file|directory 为此 mount 命令加载的密钥文件的文件路径或目exclude=ostlist录路径。密钥将被插入到内核的KEY SPEC SESSION KEYRING密钥环中，并附价有包含1ustre :字样及后缀的说明。该后绥取诀于 mount 命令的会话是用于 MGS，MDT/OST 还是客户问。司动客户端或MDT，指定不符试连接的已知的非活动 OST 列表〈由冒号分隔)。除了标准的 mount(8) 选项外，Lustre 还能读懂以下特定于客户端的选项:选项always pingflocklocalflock说明即使服务",
        "lctl dl 碍看所有 OST 的列表。以下示例为添加一个新的OST 至 testis 文件系统，索引为 12:oss# mkfs.lustre --fsname=testfs --mgsnode=mdsl6@tcp0 --ost--index=12 /dev/sda oss# mkdir -p /mnt/testfs/ost1l2 oss# mount-t lustre /dev/sda /mnt/testfs/ost122. 平衡 OST 空间使用。当新的空白 OST 庆加到相对拥挤的文件系统时，可能导致该文件系统的不平衡。但由于正在创建的新文件将优移放置在新的空白 OST EAB ATA OST 上，以目动平衡文件系统的使用量，如采这是一个暂存的或定期进行文件修胡的文件系统，则可能不需要进一步的操作来平衡 OST 空间使用率。当旧文件被删除时，原 OST 上的相应空间被释放。可使用Lfs_migrate 有选择性地重新平衡扩展前就存在的卓文件，从而使得所有OST 上的文件数据被重新分配。例如，重新平衡 /mnt/lLustre/dir目录下的所有文件，请输入:ClLient# lfs migrate /mnt/lustre/dir将0ST0004 上 /test文件系统中所有大于 AGB 的文件迁移至其他 OSTs，请输入:Client上# lfs find /test --ost test-OST0004 -size +4G |lfs migrate -y143\nLustre 文件系统操作手册 译者: Pa14.9. 移除及恢复 MDT和OST可从 Lustre 文件系统中将 OST 和 DNE MDT 移除并恢复。将 OST 设置为不活跃状态意味着它将暂时或永久地被标记为不可用。将 MDS 上将 OST 设置为不活跃状态，意A CA RSS TE MDS 上分配新对象或执行 OST 恢复; 而在客户端上将 OST 设置为非活动状态则意味着: 在无法联系上 OST 的情况下，它不会等待 OST 恢复，而是fe OST 文件被访问时立即将 IO 错误返回给应用。在特定的情况下或运行特定的命令，OST 可能会永久地在文件系统中停用。",
        "get param osc.*.ost_conn_uuidosc. testfs-OSTO0000-osc-£1579000.0st_conn_uuid=192.168.20.1@tcposc. testfs-OST0001-osc-£1579000.0st_conn_uuid=192.168.20.1@tcposc. testfs-OST0002-osc-f£1579000.0st_conn_uuid=192.168.20.1@tcposc. testfs-OST0003-osc-£1579000.0st_conn_uuid=192.168.20.1@tcposc. testfs-OST0004-osc-f£1579000.0st_conn_uuid=192.168.20.1@tcp14.12. 更改故障节点地址更改故隐菠氮的地址《如使用节氮广共换季氮Y) ，在 OSS/OST 分区上运行“取决于定义NID 时使用的选项):oss# tunefs.lustre --erase-params --servicenode=NID /qev/ost device或oss# tunefs.lustre --erase-params --failnode=NID /dev/ost_device14.13. 分离组合的 MGS/MDT以下操作在服务硕和客户端开机状态下进行，并假设 MGS “Tr -G MDS “i RAAT El1. 暂停 MDS 服务。印载 MDT.umount -f /dev/mdt device2. 创建 MGS.mds# mkfs.lustre --mgs --device-size=size /dev/mgs device3. 从 MDT 磁盘拷贝配置信息至新的 MGS 磁盘。mds# mount -t ldiskfs -o ro /dev/mdt device /mdt_mount pointmds# mount -t ldiskfs -o rw /dev/mgs device /mgs mount pointmds# cp -r /mdt_ mount point/CONFIGS/ filesystem name-* /mgs mount point/CON-FIGS/. ~*’mds# umount /mgs mount pointmds# umount /mdt_ mount point149\nLustre 文件系统操作手册这ayJaz MGS.mgs# mount -t lustre /dev/mgs device /mgs _ mount point碍看其是否获知所有文件系统。mgs:/root# lctl get param mgs.MGS.filesystems5. KK",
        "/tmp/mountdata oss0:/tmp/mountdata3 oss0# dd if=/tmp/mountdata of=/mnt/ost/CONFIGS/mountdata bs=4 count=1seek=5 skip=5 conv=notrunc5. $k OST 文件系统。oss# umount /mnt/ost14.9.6. 重新激活 OST如果 OST 永久不可用，须在 MGS 配置中重新激活它。—mgs# lctl conf param ost_name.osc.active=1如果 OST 暂时不可用，须在 MGS 和客户端上重新激活它。—mds# lctl set param osp.fsname-OSTnumber-* .-active=1Nclient# lctl set param osc.fsname-OSTnumber-* .-active=114.10. 终止恢复可使用 lctl 工具或通过abort recov选项 (mount -o abort recov) 终止恢复。启动一个目标，请运行:—mds# mount -t lustre -L mdt_ name -oO abort recov /mount point注意恢复过程将被阻塞，直到所有 OST 都可用时。14.11. 确定服务 OST 的机器在管理 Lustre 文件系统的过程中，您可能需要确定哪台机器正在为特定的 OST 提供服务。这不像识别机器 IP 地址那么简单，卫 只是 Lustre 软件使用的几种网络协议之一，因此 LNet 使用NID 而不是卫 地址作为节点标识符。要识别服务 OST HN HLar NID,请在客户端上运行以下命令之一〈不必是 root FA):—client$ lctl get param osc.fsname-OSTnumber* .ost_conn_uuid148\n————Lustre 文件系统操作手册 译者:这ayclient$ lctl get param osc. *-OST0000* .ost_conn_uuidosc. testfs-OSTO0000-osc-£1579000.0st_conn_uuid=192.168.20.1@tcpclient$ lctl get param osc.*.ost_conn_uuidosc. testfs-OSTO0000-osc-£1579000.0st_conn_uuid=192.168.20.1@tcposc. testfs-OST0001-osc-£1579000.0st_conn_uuid",
        "，它不会等待 OST 恢复，而是fe OST 文件被访问时立即将 IO 错误返回给应用。在特定的情况下或运行特定的命令，OST 可能会永久地在文件系统中停用。注意永久停用的MDT 或 OST 仍会出现在文件系统配置中，直到使用 writeconf 重新生成配置或新 MDT 或 OST 在同一索引位置蔡代原设备并永久激活。1fs df不会列出已俘用的 OST.在以下情况中，您可能希望在 MDS 上和暂时地停用 OST 以防止新文件写入:。 硬盘驱动器出现故障并正在进行RAID 重新则步或重建。(OST 在此时也可能被RAID ABIL degraded ，以避免在慢速 OST 上分配新文件，从而降低性能。。OST 接近其空间容量。(尽管 MDS 在这种情况下会尽可能和尝试避免在过度拥挤的OST 上分配新文件。)。MDTOST 存储或 MDS/OSS 布点故障并持续 〈或永久) 不可用，但文件系统在修复前仍须继续工作。(Lustre 2.4 中引入)14.9.1. 在文件系统中移除 MDT如果 MDT 永久不可用, 可使用1fs rm_entry {directory} 删除该MDT WE录条目，由于 MDT 处于不活跃状态，使用 xmqit 将导致 IO 错误。请注意，如果 MDT可用，则应使用标准的 rm -z 命令来删除远程目录。该删除操作完成后，管理员应使用以下命令将 MDT 标记为永久停用状态:letl conf param {MDT name}.mdc.active=0用户可使用 1fs 工具确认含有远程子目录的 MDT, un:1 client$ lfs getstripe --mdt-index /mnt/lustre/remote_ qirl213 client$ mkdir /mnt/lustre/local_dir04 client$ lfs getstripe --mdt-index /mnt/lustre/local_ dir0d50lfs getstripe --mdt-indqex命令返回服务于当前给定目录的MDT 3<4]144\nLustre 文件系统操作手册 译者: Pa14.9.2. 不活跃的MDT位于不活跃 MDT 上的文件",
        "Lustre 文件系统配置(如果可用)。存储在 OST 上的所有对象都将永久丢失，使用 OST 的文件应该从备份中删除和 或) 恢复。Lustre 2.5 及更高版本中，可在不恢复配置文件的情况下替换 OST 至原索引处。请在格式化时使用 --z*eplace 选项:oss# mkfs.lustre --ost --reformat --replace --index=old_ost index \\other options /dev/new_ ost devMDS 和 OSS fart Ras\" OST HY LAST ID 值。当 OST 文件系统完全无法访问时，OST 配置文件未备份时，即使 OST 文件系统完全无法访问，仍可在相同索引处用新的 OST 蔡换故障 OST.1. 更早的版本中的 OST 文件系统格式化和配置恢复 〈不使用 --*eplace 选项) 。oss# mkfs.lustre --ost --reformat --index-old_ost_ index \\other options /dev/new ost dev2. 挂载 OST 文件系统。oss# mkdir /mnt/ostoss# mount -t ldiskfs /dev/new_ost dev /mnt/ost3. 恢复 OST 配置文件《如有果可用)。oss# tar xvf ost _name.tar -C /mnt/ost147\nLustre 文件系统操作手册 译者:这ay4. Hipr el a OST 配置文件〈如采恢复不可用)。当使用默认参数 〈一般情况下适用于所有文件系统) 第一次挂载 OST AY,last revd 文件将会被重建。CONEIGS/mountdata 文件由mkfs.1Lustre 在格式化时创建，并含有标志设置以癌 MGS 发出注册请求。可从另一个工作中的 OST 复制标志。1 ossl# debugfs -c -R \"dump CONFIGS/mountdata /tmp\" /dev/other _osdev2 ossl# scp /tmp/mountdata oss0:/tmp/mountdata3 oss0# dd if=/tmp/mountdata of=/mnt/ost/CONFIGS/mountdata bs=4 count=1seek=5 skip=5",
        "144f-9359-b063-8477566eb84e 537 UP mdc test£s-MDTO0001-mdc-fff£88004edE£3c004c8be054-144f-9359-b063-8477566eb84e 538 UP mdc testf£s-MDTO002-mdc-fff££88004edE£3c004c8be054-144f-9359-b063-8477566eb84e 539 UP mdc test£s-MDTO003-mdc-fff£88004edE3c004c8be054-144f-9359-b063-8477566eb84e 52. 在下一个可用的索引处添加新的块设备作为 MDT。在下面的例子中，下一个可用索引为 4。mds# mkfs.lustre --reformat --fsname=testfs --mdt--mgsnode=mgsnode --index 4 /dev/mdt4 device142\nLustre 文件系统操作手册 译者:这ay3. 挂载 MDT.mds# mount -t lustre /dev/mdt4 blockdevice /mnt/mdt44. 在新的 MDT 上创建新的文件或目录，须通过 1fs mkdir 命令将它们附加在命名空间的一个或多个子目录上。除非妃外指定，否则通过 lis mkdiz创建的所有从属的文件和目录也将在同一个 MDT 上被创建。client# lfs mkdir -i 3 /mnt/testfs/new dir on mdt3client# lfs mkdir -i 4 /mnt/testfs/new dir on mdt4client# lfs mkdir -c 4 /mnt/testfs/new directory striped across 4 mdts14.8. 在 Lustre 文件系统中添加新的OST可在 Lustre 文件系统中将新的 OST 添加人至现有的 OSS A A BIGATHY OSS LE. Wy维持客户端在多个 OSS 布点上的 IO 负载均衡，实现最大的总体性能，建议不要为每个OSS 下点配置不同数量的 OST.1. 当文件系统第一次进行格式化时，使用mkfs .1ustte 命令湛加新的 OST。每个新的 OST 必须有一个唯一的索引，可使用 lctl dl 碍看所有 OST 的列表。以下示例为添加一个新的OST 至 testis 文件系统，索引为 12:oss# mkfs.lustre --fsname=testfs --mgsnode=mdsl6",
        "指定不符试连接的已知的非活动 OST 列表〈由冒号分隔)。除了标准的 mount(8) 选项外，Lustre 还能读懂以下特定于客户端的选项:选项always pingflocklocalflock说明即使服务从PtIzpPc模块配置了suppress_pings选项，客户端也会在空闲时定期 ping 服务器。这使得客户端即使不是外部客户端运行状况监视机制的一部分也能够可靠地使用文件系统。(在Lustre 2.9 中引入)使用flock (2) 系统调用在参与的应用程序之间启用文件锁定文持，以便文件锁定在所有使用此挂载选项的客户端节点上保持一致。这将在应用程序需要路多个客户端节点进行一致的用户空间文件锁定时非常有用，但为了保持此一致性同时也增加了通信开局用客户端本地flock(2)支持，仅使用客户端本地的文件锁定。这比使用全局flLock选项更快，并且可以用于依赖于flock (2)但仅在单个节点上运行的应用程序。它通过仅使用 Linux 内核锁实现了最小开销。xm378\nayLustre 文件系统操作手册 译者: 李选项 说明noflock 完全禁用flock (2) ，为默认选项。调用flock (2) 的应用程序会出现ENOSYS错误。管理员可以根据需要选择1ocalf1lock或flock挂载选项。可使用不同的选项挂载客户端，但只有那些使用flock挂载的客户端才能相互保持一致性。lazystatfs 在某些 OST 或 MDT 无啊应或已在配置中暂时或永久禁用时仍允许返回statfs(2) (pedt (1)和1Lfs-dqf(1)使用)，从而避免所有目标都可用前的阻塞。这是目 Lustre 2.9.0 以来的默认行为。nolazystatfs 使statfs (2) BAIE, BAA OST 和MDT 都可用后再返回空间使用情况。user xattr 人允许user .*命名空间中的普通用户获取/设置扩展属性。有关更多详细信息，请参见attt (5) 于册页。nouser xattr 禁用usez .*命名空间中的普通用户使用扩展属性。root 和系统进程仍可以使用扩展属性。verbose 启用额外的 mount/umount 控制台消息。noverbose AS FA AY SAY) mount/umount 控制台消息。user fid2path",
        "打印简明信息。重新格式化已有的 Lustre fea.用于优化 MDT 的 inode 大小。打印更多信息。575\nLustre 文件系统操作手册这ay44.14.3. 示例在文件系统 testfs 的节点cfs21上创建组合的MGS 和 MDT:1 mkfs.lustre --fsname-testfs --mdt --mgs /dev/sdal在文件系统 testis 的任一节点上创建一个OST (使用以上 MGS) :1 mkfs.lustre --fsname-testfs --mgsnode=cfs21@tcp0 --ost --index=0 /dev/sdb在节点cfs22上创建独立的 MGS:1 mkfs.lustre --mgs /dev/sdal在文件系统 myfsl WET EGET MDT 〈使用以上 MGS):1 mkfs.lustre --fsname=myfs1 --mdt --mgsnode=cfs22@tcp0 /dev/sda2也可参见\"本章滴 14. mkfs.lustre\", \"15. mount.lustre\".44.15. mount.lustremount.lustre 实用程序可用于局动 Lustre 客户端或目标服务。44.15.1. 梗概1 mount -t lustre [-o options] device mountpoint44.15.2. 说明使用 mount.lustre 实用程序司动 Lustre 客户端或目标服务，不应直接调用。它是通过 mount(8) 调用的辅助程序。使用 umount 命令停止 Lustre 客户端和目标。device 选项有两种形式，有具体取决于客户端或目标服务是否已启动:选项 说明mgsname:/fsname[/subdir] 通过联系 mgsname 上的 Lustre ManagementService，在目录 mountpoint 中的客户端上挂载名为 fname 的 Lustre 文件系统〈如果指定了subdir ，则从文件系统的子目录 subdir 启动) 。mgsname 的格式定义如下。可在fstab (5) 中列出客户端文件系统，以便在司动时自动挂载。客户端文件系统即可像其他本地文件系统一样使用，并提供完整的 POSIX 标准兼容接口。576\nLustre 文件系统操作手册这ay选项block_ device44.15.3. 选项选项mgsname=mgsnode [:mgsnode ]mgsnode=mgsnid[,mgsnid]mgssec=flavor说明在物理磁盘 block_device 上局动由mkfs"
    ]
}