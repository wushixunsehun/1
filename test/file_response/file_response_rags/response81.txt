{
    "query": " MDT 与 OST 有什么区别？二者如何协作完成 I/O 操作？",
    "summaries": [
        "文本主要介绍了Lustre文件系统中添加和管理MDT（元数据目标）及OST（对象存储目标）的操作步骤。包括在下一个可用索引处添加新的MDT设备、挂载MDT、创建文件或目录并指定其所在的MDT，以及添加新OST、平衡OST空间使用和移除或恢复MDT/OST的方法。同时提到将OST或MDT设置为不活跃状态的场景和影响，以及如何永久停用MDT。",
        "dir0d50lfs getstripe --mdt-indqex命令用于查看当前目录所服务的MDT。不活跃的MDT上的文件在重新激活前不可用，访问时会返回EIO错误。移除OST时需先停用，防止文件创建，并迁移数据或从备份恢复。停用OST可通过设置参数实现，分为临时和永久两种方式。若OST可访问，需迁移数据；不可访问则删除文件并恢复备份。备份OST配置文件应在OST正常工作时进行，恢复时需格式化新OST并恢复配置。",
        "MDS 可有效利用多 CPU 核，建议至少使用 4 个核，客户端多时应增加核数。Lustre 客户端可运行在不同字节序架构上，但需注意 PAGE_SIZE 匹配。MGT 存储需求小，需可靠存储，推荐 RAID1。MDS 存储适合低查找时间的 SSD 或 SAS，推荐 RAID1 配置。多个 MDT 时需合理分配负载，MDT0000 为根目录，不可用将导致文件系统失效。DNE 特性可将目录分散到多个 MDT 上，提升性能。OST 存储采用流 IO 模式，OSS 可管理多个 OST，容量为所有 OST 总和。OST 配置需考虑带宽平衡，RAID-6 可提高可靠性。MDT 和 OST 空间需求独立，创建文件会消耗 inode 和对象，格式化时需预估容量并预留空间。"
    ],
    "contents": [
        "删除，或者因 OST 在操作中不稳定或处于只读状态而这人么做，那么就没什么问题。和否则，删除文件之后，OST 上的空闲空间和对象不会减少，对象也会被销毁，直到 MDS 重新连接到 OST。例如，在文件系统 testis, % OSTO000 设置为不活跃状态:mds# lctl set param osp.testfts-OST0000-osc-MDT* .active=0在MDS 上将 OST 设置为不和活跃状态不会影响客户器对当前对象进行读取/写入。注意如有果从正在工作的 OST 中迁移文件，请不要停用客户端上的 OST。这会导致访问位于该 OST 上文件时产生 IO 错误，从而使 OST 迁移文件失败。如果 OST 在工作中，请不要使用 lctl conf_param 将其设置为不活跃状态，为这会使其在 MDS 和所有客户端上的文件系统配置中立刻并永久停用。2. 查找所有合驻留在不活跃 OST 上对象的文件。如采该 OST 可访问，则需要将来目该 OST 的数据迁移到其他 OST 上，不然将需要从备份恢复数据。145\nLustre 文件系统操作手册 译者:As大a. 如采该 OST 在线或可访问，碍找所有合驻留其上对象的文件并将其数据复制到文件系统的其他 OST 上:client# lfs find --ost ost name /mount/point | lfs migrate~y注意如果多个 OST Fela] AY EI, Lis find 命令可带多个--ost参数，返回所有位于指定 OST 上的文件。b. 如果该 OST 不可访问，则删除在该 OST 上的所有文件并从备份恢复数据:client# lfs find --ost ost_uuidq -print0 /mount/point | tee/tmp/files to restore | xargs -0 -n 1 unlink需要从备份恢复的文件列表存储在 /tmp/files to restore,3. 将 OST 设置为不活跃状态。a. 如果预计在短时间 OLA)",
        "则有 50% 的概率使剩余的镜像失效。如果系统中存在多个 MDT，应根据预期情况为每个MDT 指定使用和负载。警告 MDT0000 含有 Lustre 文件系统的根上目录。如因任何原因无法使用MDT0000，则无法使用文件系统。注意使用DNE 特性，可以通过1fs mkdir -i mqt_index命令，将文件系统根目录下的子目录，或任意更低级别的子目录，从 MDT0000 下分离出来，存储在附加的MDT 上。如果服务于某子目录的 MDT 不可用，那么该 MDT 上的所有子目录及其下所有目录都将不可访问。通前，DNE 适用于将顶级目录分给不同的用户或项目，从而将他们分到不同的MDT 上。DNE 也适用于将其他大型文件工作集分布到多个 MDT 上。(在 Lustre 2.8 中引入) 从 2.8 版本开始，DNE 条带目录特性 (stripe_count 一般是文件系统中 MDT 的数量) 变得可用。可通过 1]名 mkdir -c stripe_count 命令，将单个大型文48\nLustre 文件系统操作手册 译者:As大件目录分散在多个 MDT 上。条闪化目录通前不会用在文件系统中的所有目录上，因为相较于非条带目录，它将产生额外开销。但是对于大型的目录 (超过 SOk 的条目) ，同时大量和输出文件，条帝化目录则会显出优势。5.1.2 OST 存储硬件OSS 存储的数据访问模式是流 IO 模式，它依赖于正在使用的应用程序的访问模式。每个 OSS 都可以管理多个对象存储目标 (0ST)，每个卷对应一个 0ST，以在服务天和目标之间实现 IO 流量负载平衡。为使网络带宽和附加存储带宽之间保持平衡，应合理配置 0SS，以防止 IO Ha. MRR A aE AY AN Ta], OSS 通彰服务于2到8 个目标，每个目标通常在 24-48TB 之间，但最高可达 256TB。Lustre 文件系统容量是存储目标容量总和。例如，64 + OSS, AEP OSS 含两个8TB 的OST，则可提供一个容量接近 1",
        "lctl dl 碍看所有 OST 的列表。以下示例为添加一个新的OST 至 testis 文件系统，索引为 12:oss# mkfs.lustre --fsname=testfs --mgsnode=mdsl6@tcp0 --ost--index=12 /dev/sda oss# mkdir -p /mnt/testfs/ost1l2 oss# mount-t lustre /dev/sda /mnt/testfs/ost122. 平衡 OST 空间使用。当新的空白 OST 庆加到相对拥挤的文件系统时，可能导致该文件系统的不平衡。但由于正在创建的新文件将优移放置在新的空白 OST EAB ATA OST 上，以目动平衡文件系统的使用量，如采这是一个暂存的或定期进行文件修胡的文件系统，则可能不需要进一步的操作来平衡 OST 空间使用率。当旧文件被删除时，原 OST 上的相应空间被释放。可使用Lfs_migrate 有选择性地重新平衡扩展前就存在的卓文件，从而使得所有OST 上的文件数据被重新分配。例如，重新平衡 /mnt/lLustre/dir目录下的所有文件，请输入:ClLient# lfs migrate /mnt/lustre/dir将0ST0004 上 /test文件系统中所有大于 AGB 的文件迁移至其他 OSTs，请输入:Client上# lfs find /test --ost test-OST0004 -size +4G |lfs migrate -y143\nLustre 文件系统操作手册 译者: Pa14.9. 移除及恢复 MDT和OST可从 Lustre 文件系统中将 OST 和 DNE MDT 移除并恢复。将 OST 设置为不活跃状态意味着它将暂时或永久地被标记为不可用。将 MDS 上将 OST 设置为不活跃状态，意A CA RSS TE MDS 上分配新对象或执行 OST 恢复; 而在客户端上将 OST 设置为非活动状态则意味着: 在无法联系上 OST 的情况下，它不会等待 OST 恢复，而是fe OST 文件被访问时立即将 IO 错误返回给应用。在特定的情况下或运行特定的命令，OST 可能会永久地在文件系统中停用。",
        "-n 1 unlink需要从备份恢复的文件列表存储在 /tmp/files to restore,3. 将 OST 设置为不活跃状态。a. 如果预计在短时间 OLA) 内有可替代的OST，可使用以下方式临时停用 OST:client# lctl set param osc.fsname-OSTnumber-*x .actiVe=0注意该设置为暂时的，当客户端重新挂载或重司时将被重置。该命令需要在所有客户端上运行。b. 如果预计近期内无可替代的 OST，在 MDS 上运行以下命令以在所有客户端 MDS上永久停用 OST:mgs# lctl conf param ost _name.osc.active=0注意停用的 OST 仍会在文件系统配置中显示。蔡代的 OST 可使用mkfs.1Lustre--replace 进行创建。14.9.4. 备份 OST 配置文件如果 OST 设备仍可访问，则 OST 上的 Lustre 配置文件应及时备份并保存以供将来使用，从而避免更换 OST 恢复服务时出现问题。这些文件很少发生变化，所以它们应在 OST 正抽工作且可访问的情况下进行备份。如果停用的 OST 仍可成功挂载〈即未因严重损坏而永久失效或无法挂载) ，则应努力保留这些文件。1. 挂载 OST 文件系统。140\n1212Lustre 文件系统操作手册%my这ayoss# mkdir -p /mnt/ostoss# mount -t ldiskfs /dev/ost device /mnt/ost2. 备份 OST 配置文件。oss# tar cvf ost name.tar -C /mnt/ost last _rcvd \\CONFIGS/ O/0/LAST_ID3. HK OST 文件系统。oss# umount /mnt/ost14.9.5. 恢复 OST 配置文件蔡换因损坏或硬件故障而从服务中被删除的 OST，请首先使用mkfs .LIustre将新的OST 格式化,并恢复 Lustre 文件系统配置(如果可用)。存储在 OST 上的所有对象都将永久丢失，使用 OST 的文件应该从备份中删除和 或) 恢复。Lustre 2.5 及更高版本",
        "，它不会等待 OST 恢复，而是fe OST 文件被访问时立即将 IO 错误返回给应用。在特定的情况下或运行特定的命令，OST 可能会永久地在文件系统中停用。注意永久停用的MDT 或 OST 仍会出现在文件系统配置中，直到使用 writeconf 重新生成配置或新 MDT 或 OST 在同一索引位置蔡代原设备并永久激活。1fs df不会列出已俘用的 OST.在以下情况中，您可能希望在 MDS 上和暂时地停用 OST 以防止新文件写入:。 硬盘驱动器出现故障并正在进行RAID 重新则步或重建。(OST 在此时也可能被RAID ABIL degraded ，以避免在慢速 OST 上分配新文件，从而降低性能。。OST 接近其空间容量。(尽管 MDS 在这种情况下会尽可能和尝试避免在过度拥挤的OST 上分配新文件。)。MDTOST 存储或 MDS/OSS 布点故障并持续 〈或永久) 不可用，但文件系统在修复前仍须继续工作。(Lustre 2.4 中引入)14.9.1. 在文件系统中移除 MDT如果 MDT 永久不可用, 可使用1fs rm_entry {directory} 删除该MDT WE录条目，由于 MDT 处于不活跃状态，使用 xmqit 将导致 IO 错误。请注意，如果 MDT可用，则应使用标准的 rm -z 命令来删除远程目录。该删除操作完成后，管理员应使用以下命令将 MDT 标记为永久停用状态:letl conf param {MDT name}.mdc.active=0用户可使用 1fs 工具确认含有远程子目录的 MDT, un:1 client$ lfs getstripe --mdt-index /mnt/lustre/remote_ qirl213 client$ mkdir /mnt/lustre/local_dir04 client$ lfs getstripe --mdt-index /mnt/lustre/local_ dir0d50lfs getstripe --mdt-indqex命令返回服务于当前给定目录的MDT 3<4]144\nLustre 文件系统操作手册 译者: Pa14.9.2. 不活跃的MDT位于不活跃 MDT 上的文件",
        "MDS 可以有效地利用多 CPU 核，建议至少使用四个处理器核。对于有许多客户端的文件系统，建议使用更多核处理器。注意 Lustre 客户端可以运行在不同字节序的架构上，但有一个限制: 客户端上的PAGE _SIZE 内核安必须与服务器的 PAGE_SIZE FE. Bila, AA KG GRA 64kBTL) 的ia64 或PPC 客户端可以使用 x86 服务器 〈4kB 页) 和运行。如果使用 ia64 Bk PPC服务器运行 x86 客户机，则必须使用4kB PAGE SIZE 来编译 ia64 内核 〈服务句页面大小不大于客户端页面大小)。5.1.1 MGT 和 MDT 存储硬件MGT 存储需求很小〈即使在最大 Lustre 文件系统中也少于 100MB) ，MGT 上的数据仅在服务圳或客户端安装的时候被载入访问，所以不需要考虑磁盘性能。但其数据对于文件系统访问非溃重要，所以MGT 应使用可靠的存储，最好配置为镜像 RAID1。MDS 存储通过类似于数据库的访问模式进行访问，大多为少量数据的读写。因此，MDS 存储不需要高吞吐量，而适用低查找时间的存储类型，例如 SSD 驱动器或 NVMe驱动器最适合作为 MDT, high-RPM SAS 也可以接受。为了获得最大的性能，MDT 应该配置为由不同控制锅下的两个磁盘和一个内部日志组成的RAID1。如果需要更大的 MDT，可以创建由一对磁盘组成的多个RAID1 设备，然后使用这些RAID1 设备构建RAID0 阵列。对于 ZFS，可以在MDT 中使用镜像虚拟设备 VDEV。这确保了最大的可靠性，只有很小的几率出现多磁盘故障，即在同一个RAID1 设备中的两个磁盘同时故障。相反地 (构建一对RAID0 设备组成的RAID1) ，即使只有两个磁盘故障，也有 50%的可能性出现可导致整个MDT 数据丢失的情况。第一个故障使整个镜像的一半和失效，第二个故障则有 50% 的概率使剩余的镜像失效。如果系统中存在多个 MDT，应根据预期情况为每个MDT 指定使用和负载。警告 MDT0000 含有 Lustre 文件系统的根上目录。如因任何",
        "144f-9359-b063-8477566eb84e 537 UP mdc test£s-MDTO0001-mdc-fff£88004edE£3c004c8be054-144f-9359-b063-8477566eb84e 538 UP mdc testf£s-MDTO002-mdc-fff££88004edE£3c004c8be054-144f-9359-b063-8477566eb84e 539 UP mdc test£s-MDTO003-mdc-fff£88004edE3c004c8be054-144f-9359-b063-8477566eb84e 52. 在下一个可用的索引处添加新的块设备作为 MDT。在下面的例子中，下一个可用索引为 4。mds# mkfs.lustre --reformat --fsname=testfs --mdt--mgsnode=mgsnode --index 4 /dev/mdt4 device142\nLustre 文件系统操作手册 译者:这ay3. 挂载 MDT.mds# mount -t lustre /dev/mdt4 blockdevice /mnt/mdt44. 在新的 MDT 上创建新的文件或目录，须通过 1fs mkdir 命令将它们附加在命名空间的一个或多个子目录上。除非妃外指定，否则通过 lis mkdiz创建的所有从属的文件和目录也将在同一个 MDT 上被创建。client# lfs mkdir -i 3 /mnt/testfs/new dir on mdt3client# lfs mkdir -i 4 /mnt/testfs/new dir on mdt4client# lfs mkdir -c 4 /mnt/testfs/new directory striped across 4 mdts14.8. 在 Lustre 文件系统中添加新的OST可在 Lustre 文件系统中将新的 OST 添加人至现有的 OSS A A BIGATHY OSS LE. Wy维持客户端在多个 OSS 布点上的 IO 负载均衡，实现最大的总体性能，建议不要为每个OSS 下点配置不同数量的 OST.1. 当文件系统第一次进行格式化时，使用mkfs .1ustte 命令湛加新的 OST。每个新的 OST 必须有一个唯一的索引，可使用 lctl dl 碍看所有 OST 的列表。以下示例为添加一个新的OST 至 testis 文件系统，索引为 12:oss# mkfs.lustre --fsname=testfs --mgsnode=mdsl6",
        "dir0d50lfs getstripe --mdt-indqex命令返回服务于当前给定目录的MDT 3<4]144\nLustre 文件系统操作手册 译者: Pa14.9.2. 不活跃的MDT位于不活跃 MDT 上的文件在该 MDT 被重新激活前不可用。学试访问不活跃 MDT的客户端将收到 EIO 错误。14.9.3. 在文件系统中移除 OST当将 OST 设置为不活跃状态时，客户端和 MDS 都各有一个 OSC 设备用于处理和响应与该 OST 的交互。从文件系统中移除 OST :1. WER OST 仍然可用，并且有文件落在这个 OST 上，而文件必须迁移出这个 OST,那么应在MDS 上和暂时停用在该OST 上的文件创建《如果有多个 MDS “Tr A 4E DNE模式下运行，则应在每个 MDS 执行该操作) 。a. 在 Lustre2.9 或更高版本中，通过在 MDS max create count 设置为0，从而禁止该 OST 的文件创建:mds# lctl set param osp.*osc_ name*.max create count=0这可以确保，一旦文件从 OST PH BR EGER HA, ABZ EXT DAY OST 对象将被被销毁，相应空间将被释放。例如，在文件系统 testfs 中停用 OST0000，在 testfs 文件系统上的每个MDS 上运行:mds# lctl set param osp.testfs-OST0000-osc-MDT*.max create count=0b. 在更老的 Lustre 版本中，将 MDS 节点上的 OST 设置为不活跃状态，请运行:mds# lctl set param osp.osc_name.active=0这将阻止 MDS 尝试与该 OST 进行通信，MDS 也不会连接 OST 以删除位于OST 上的对象。如果 OST 被永久删除，或者因 OST 在操作中不稳定或处于只读状态而这人么做，那么就没什么问题。和否则，删除文件之后，OST 上的空闲空间和对象不会减少，对象也会被销毁",
        "48TB 之间，但最高可达 256TB。Lustre 文件系统容量是存储目标容量总和。例如，64 + OSS, AEP OSS 含两个8TB 的OST，则可提供一个容量接近 1 PB 的文件系统。如果每个OST 使用10个 ITB 的SATA 磁盘 〈在RAID-6 配置中使用 8 个数据磁盘加 2 个校验磁盘) ，每个驱动器可达 50MB/秒的带宽，则每个 OST 则可达 400 MB/秒的磁盘人带宽。如果该系统被用作系统网络(县有类似带宽) 的存储后端，如 InfiniBand 网络，那么每个 0SS 可以提供高达 800MB/秒的端到端 IO 吞吐量。(这里摘述的架构限制很简单，但实际上需要慎重的硬件选择、基准测试和集成才能得到该结果。)5.2. 确定空间需求在想获得的后端文件系统性能特性上，MDT 和 OST 相互独立。MDT 后端文件系统的大小取雇于 Lustre 文件系统中所需的所有 inode 数量，而 OST 总空间大小取决于存储在文件系统上的数据总量。如果 MGS 数据须存储在 MDT 设备上 (同时位于 MGT 和MDT)，则应增加 100MB 到 MDT 的预估容量上。每当在 Lustre 文件系统上创建一个文件时，它就会消耗 MDT 上的一个inode，还有该文件条带所在的所有 OST 上的一个对象。通常，每个文件的条带数目继承于整个系统的黑认条齐数目，但单个文件的条读数可用 Ifs setstripe 选项进行设置。在 Lustre ldiskfs 文件系统中，所有 MDT 的索引节点和 OST 的对象在文件系统第一次格式化时进行分配。在文件系统使用过程中，创建一个文件，与该文件关联的元数据将被存储在预先分配的索引节点中，而不会占用任何用于存储文件数据的空亲空间。已格式化好的 ldiskfs MDT BK OST 上的索引和点总数不能被轻易更改。因此，在格式化时应创建足够多的索引节点，并预见到短期内的使用情况，预留一部分增长空间，以避免添加额外存储的麻烦。默认情况"
    ]
}