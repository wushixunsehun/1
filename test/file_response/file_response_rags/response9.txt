{
    "query": "如何查看 OST 的空间使用情况？命令输出包含哪些关键信息？",
    "summaries": [
        "当OST空间使用不平衡时，可能导致文件系统写入失败。可通过查看OST空间使用情况来识别问题，如OST0002接近满溢。为避免此问题，可在MDS上禁用满溢的OST，防止新对象分配到这些OST。数据可手动或通过删除和创建文件被动平衡。若需迁移数据，可使用lfs_migrate命令。停用的OST在平衡后可重新上线。元数据迁移支持整个目录的迁移，但条带化目录迁移需特定命令。迁移期间文件会获得新FID，可能影响某些应用访问，需注意刷新缓存。",
        "BK OST 上的索引和点总数不能轻易更改，因此在格式化时应预留足够空间以避免后续添加存储的麻烦。默认情况下，ldiskfs 文件系统会预留 5% 空间，且每个 OST 预留 400MB，每个 MDT 预留 4GB 用于日志。ZFS 作为后端文件系统时，空间分配更动态，但仍有约 3% 空间用于元数据。MDT 空间需求取决于文件数量、条带数、ACL 和扩展属性等因素，通常为文件系统容量的 1%-2%。对于 ldiskfs MDT，需根据文件大小计算最小空间，如平均文件大小为 5MB，则需约 400GiB。若文件较小（如 4KB），则需增加空间。OST 空间需求取决于用户使用模式，Lustre 默认估计较保守，可根据实际调整。可通过增加 MDT 或扩展存储空间来提升索引节点总数和性能。",
        "Lustre 文件系统操作手册主要介绍文件条带化、配额管理、对象存储目标（OST）信息查询等功能。用户可通过命令设置文件的条带数量、大小和起始 OST，支持多种单位和选项。同时提供查看文件布局、OST 状态、磁盘使用情况及配额限制的工具。手册还涉及文件属性设置、目录遍历、池管理等操作，适用于管理和优化 Lustre 文件系统的性能与存储结构。"
    ],
    "contents": [
        "实际使用的空间大小与很多因素有关，如每个路径下文件数量、每个文件的条带数、文件是否含 ACL 或用户扩展属性、每个文件的硬链接数。Lustre 文件系统元数据所需的存储通毅是文件系统容量的 1% - 2%，具体取决于文件平均大小。WHR Lustre 2.11 或更高版本使用第 20 章，MDT 上的数据 (DoM) 功能，则 MDT 空间通DAK AAAS IDEN 5% 或更多,这取决于文件系统内小文件的分布和lod.*.dom_stripesize对使用的 MDT 和文件布局的限制。对于基于ZFS HY MDT 文件系统，在MDT Ail OST 上创建的索引和氮的数量是动态的，因此不太需要预先确定索引节氮的数量，但是仍然需要根据总文件系统的大小而考sk MDT 的总空间大小。例如，如果文件平均大小为SMiB ，而您有 100TiB 可用的 OST 空间，那么您可以计算出每个MDT 和OST 的索引节点最小总量: (500 TB * 1000000 MB/TB) / 5 MB/inode= 100M inodes.建议您将 MDT 43 /A) B/E A / AR TEN ft, DOT PEAROR DJ, BT防文件平均大小小于预期。因此，ldiskfs MDT 的最小空间为: 2 KiB/inode x 100 millioninodes x 2 = 400 GiB Idiskfs MDT.注意如果文件大小的中间值非解小，例如4KB，则 MDT 将为每个文件使用与 OST 上相同的空间，每个信息节点的MDT 空间应相应增加，以考虑每个信息节氮的额外数据50\nLustre 文件系统操作手册 译者:As大空间使用情况:如果平均文件大小非毅小，例如只有 4KB ，那么每个文件在MDT 上所占用的空间将会和在 OST 上一样多。因此在这种情况下，强烈建议使用MDT 上的数据。考虑到每个索引布扣的额外数据空间使用情况，每个索引节点上的 MDT 至间也应做出相应的增加:6 KiB/inode x 100 million inodes x 2",
        "/test_3': No space left on device4 98+0 records in5 9740 records outnN1017192448 bytes (1.0 GB) copied, 23.2411 seconds, 43.8 MB/s23.1.2. 在满溢的 OST 上禁用创建功能为避免文件系统空间不足，如果 OST 空间使用不平衡，甚至一个或多个 OSTs 接近满溢而其他 OSTs 有很多空间，则可以在MDS 上有选择性地停用满溢的OSTS 以防止MDS 在这些 OSTs 上分配新的对象。1. 登陆 MDS 服务融并使用1ct1命令茶止在满次的 OSTs 上创建新对象 :—mds# lctl set param osp.fsname-OSTnnnn* .max_create_count=0在文件系统中创建新文件时，将只 ans :的 OST。可以通过将数据迁移到其他OST 来手动平衡空间(将在下一节介绍) ，同时，可以通过删除和创建文件来被动地平衡空间。23.1.3. 在文件系统内迁移数据如果需要将文件数据从当前的 OST 迁移到新的OST，则必须将数据迁移 (复制)新的位置。最简单的方法是使用1fs_migrate命令。至—23.1.4. 将禁用的 OST 重新上线一旦停用的 OST 经过主动或被动数据重新分配后不再严重不平衡，它们应该重新被激活，以便再次分配新文件到这些 OSTs 上。—[mds] # lctl set param osp.testfs-OST0002.max_ create _count=2000023.1.5. 在文件系统内迁移元数据23.1.5.1. 整体 end Lustre 2.8 引入了在 MDTs 之间直接迁移元数据〈目录和索引节FA) 的功能。此迁移只能在整个目录上执行。Lustre 2.12 引入了条豆化目录的功能。例如， 0 目录的内容从当前所在的MDT 迁移到 MDT0000, 以允许删除该 MDT，使用的命令如下:1 S$ cd /testfs2 5 lfs getdirstripe -m ./remotedir which MDT is dir on?3 1283\n—Lustre 文件系统",
        "uster/mds// max atime diff) 时才会更新。Lustre 软件考虑了所有OST 的最新时间。如果asetattz由用户设置，它在 MDS 和OST 上都会更新，并允许atime问后移动。上次文件状态变更发生在 N*24 小时前的文件。上次文件内容变更发生在 N*24 小时前的文件。在特定 OST 上有对和象的文件。特定文件大小的文件。文件大小默认单位为bytes，或者给出后23\" kilo-, Mega-, Giga-, Tera-, Peta-的不同单位。FLASHY block, character. directory. pipe. file. symlink,socket. door 的文件 (在 Solaris 操作系统中使用)。有指定用户数字 ID 的文件。指定用户〈可使用用户数字 ID) 所有的文件。有指定组 ID 的文件。指定组〈可使用组数字 ID) 所有的文件。查找目标树的最多下降 N 级。打印务整文件名，新的一行或NULL 字符跟随其后。列出文件系统的所有 OST。如果指定了挂载 Lustre 文件系统的路径，则仅显示属于此文件系统的 OST.列出与每个 Lustre 挂载点关联的所有 Lustre 文件系统实例。如末未指定路径，则会询问所有 Lustre 挂载点。如果提供了路径列表，则将给出相应的路径实例。如果某路径不是 Lustre 实例，则将返回\"No such device\".516\n这ayLustre 文件系统操作手册 译者:=H+elygetstripe--obd ost_name--quiet--verbose--stripe-count | 列--index--offset--pool--SIZe--directory--recursivesetstripe--stripe-count| 用于stripe_cnt--overstripe-countstripe cnt | tHE.对|每个OST说明列出给定文件名或目录的条带信息。软认返回条带计数、条市大小和侦移量。如果您只需要特定的条市信息，可选择—--stripe-count, --stripe-size, --stripe-index,--Layout或--poo1以及这些选项的各种组合以用于检索特定信息。如采指定了--zaw选项，则打印条带信息时不会将文件系统默认值值荐换为未指定的字",
        "该 MDT，使用的命令如下:1 S$ cd /testfs2 5 lfs getdirstripe -m ./remotedir which MDT is dir on?3 1283\n—Lustre 文件系统操作手册 译者:这ayS touch ./remotedir/file. {1,2,3}.txtcreate test filesS lfs getstripe -m ./remotedir/file.*.txtcheck files are on MDT00011lfs migrate -m 0 ./remotedir migrate testremote to MDT0000lfs getdirstripe -m ./remotedir which MDT is dir on now?lfs getstripe -m ./remotedir/file.*.txtcheck files are on MDT0000Go Oo OC WF OO DY HY FR FR更多依息见man lfs-migrate.注意迁移期间，每个文件都会被分配一个新的标识符 〈FID)。因此，该文件也会将新的inode 编号通知给用户空间应用。即使内容未更改，一些系统工具〈例如备份、归档工FL, NFS, Samba) 可能仍会将迁移文件视为新文件。如果 Lustre 系统通知了新的 FID给NFS，但客户端或服务器仍使用旧的 FID 缓存过时的文件句柄，则在迁移期间和之后，迁移的文件可能变得不可访问。重新局动 NFS 服务将刷新本地文件句柄缓存，但客户端也可能需要重新司动，因为它们可能会缓存了过时的文件句柄。23.1.5.2. 条带化目录迁移 Lustre 2.8 引入了在MDTS 之间迁移元数据 (其中的目录PIAS TD 的功能，但是它不文持条带化目录的迁移，也不文持更改现有目录的条带数。Lustre 2.12 增加了对在迁移时重新分条目录的功能。1fs migrate -m命令只能对整个目录执行，饭会递归地迁移指定的目录及其子条目。例如，要将大型目录/testfs/Largedir的内容从其在MDT0000 上的当前位置迁移到 MDT0001 和MDT0003，请运行以下命令:S lfs migrate -m 1,3 /testfs/largedir元数据迁移会将文件和索引节点直接迁移到其他 MDT",
        "需要此程序，但在某些情况下《〈如创建须占用超过所有 OST 的总可用空间的大文件时) 可能需要此程序。23.1.1. 查看 OST 空间使用情况下面的例子显示了一个不平衡的文件系统。client# lfs df -h—2 UUID bytes Used Available \\3 Uses Mounted on4 testfs-MDTO000 UUID 4.4G 214.5M 3.9G \\5 4% /mnt/testfs [MDT: 0]6 testfs-OST0000 UUID 2.0G 751.3M 1.1G \\7 37% /mnt/testfs[OST:0]8 test fs-OST0001_UUID 2.0G 755.3M 1.16 \\9 37% /mnt/testfs[OST:1]10 testf£fs-OSTO002 UUID 2.0G 1.7G 155.1M \\11 86% /mnt/testfs[OST:2] ****12 test fs-OST0003_UUID 2.0G 751.3M 1.16 \\13 37% /mnt/testfs[OST: 3]14 testfs-OST0004 UUID 2.0G 747.3M 1.1G \\15 37% /mnt/testfs[OST: 4]16 test fs-OST0005 UUID 2.0G 743.3M 1.16 \\17 36% /mnt/testfs[OST: 5]1819 filesystem summary: 11.86 5.4G 5.86 \\20 45% /mnt/testfs在这种情况下，OST0002 几乎已经全满了，任何往文件系统写入更多信息的尝试(即使在所有 OSTs 上平均地分条) 都将失败，如下所示:1 client# lfs setstripe /mnt/testfs 4M 0 -12 client# dd if=/dev/zero of=/mnt/testfs/test_ 3 bs=10M count=100282\nLustre 文件系统操作手册这ay3 dd: writing '/mnt/testfs/test_3': No space left on device4 98+0 records in5 9740 records outnN1017192448 bytes (1.0 GB) copied, 23.2411 seconds, 43.8 MB",
        "-t -Ul-g| -p /mount pointquotachown说明移至下一个 OST 之前在当前 OST 上存储的字刷数。stripe_size为0时，使用文件系统的默认条市大小〈默认为1MB)。可使用k (KB )、m (MB) 或g (GB) 进行指定。(默认stripe _ size为0，默认的start-ost为 -1，注意AEG! 如果把start-ost设置为0 ，则所有新文件创建都发生在 OST 0 上，这一般不是个好主意)文件条弟化开始的 OST 索引【基数为10，从 0 开始)。statrt_ost_indqex值为-1 (默认值) ，人允许 MDS 选择起始索引。这意味着 MDS 会根据需要选择起始 O0ST。我们强烈建议选择此默认值，它允许了 MDS 根据需要实现空间和负载平衡。start ost _indqex的值与MDS 对文件中的剩余条带使用循环算法还是 QoS 加权分配无关。文件条弟化开始的 OST 索引【基数为10，从 0 开始)。FAP aR CAN TUE XL OST 池名称。还使用了stripe_cnt，stripe size flstart ost值。start-ost值必须是池的一部分，和否则将返回错误。删除指定目录上的默认条市化设置。列出文件系统或路径名中的池，或文件系统池中的 OST.显示完整文件系统或特定OBD 上对象的磁盘使用情况和限制。可以指定用户、组名称或usr，组和项目ID 。如果所有用户、组项目ID 都被省略了，则显示当前 UID/GID 的配额。使用-9选项将不会打印其他描述〈包括列标题) ，它使用零来项充宽限期那一列中的空格〈当没有设置宽限期时) 来确保列数一致。使用-v选项将提供更详细 〈每 OBD 统计信息) 的输出。显示用户 〈-u)、组 (-g) BMA (-p) 配额的块和 inode #限时间。在指定文件系统的 OST 上更改文件的所有者和组。518\nLustre 文件系统操作手册%my这ayquotacheck",
        "BK OST 上的索引和点总数不能被轻易更改。因此，在格式化时应创建足够多的索引节点，并预见到短期内的使用情况，预留一部分增长空间，以避免添加额外存储的麻烦。默认情况下，由 Lustre 服务右用作存储用户数据对象和系统数据的 ldiskfs 文件系统会预留 5% 的空间，该空间不能被 Lustre 文件系统使用。此外，Lustre ldiskfs 文件系统在每个OST 上预留 400 MB 空间，每个MDT 上预留 4GB 空间用来放置日志，同时在日49\nLustre 文件系统操作手册 译者:志之外要预留少量空间，放置限额统计数据。这个预留空间不能用于一般存储，因此在保存任何文件对象数据忆前，至少 OST 上的这些空间已被占用。当MDT或OST 使用ZFS 作为后端文件系统时，索引和氮和文件数据的空间分配是动态的，索引和所可投需分配。每个索引节氮人至少需要 4kB 的可用空间〈如有果没有蚀像)，除此忆外，还有目录、内部日志文件、扩展属性、ACL 等其他开销。ZFS 也同样预贸了全部存储空间 3% 左右，用作内部的和元余的元数据，这部分空间不可为 Lustre所用。由于扩展属性和 ACL 的大小高度依赖于内核版本和站氮策略，因此最好高售所需索引节氮数目所对应的的空间大小。任何多余的空间都可用于存储更多的索引节氮。5.2.1 确定 MGT 空间需求MGT 所需空间通前小于 100MB ，该大小是由 MGS 管理在 Lustre 文件系统集群中管理的服务需总数决定的。5.2.2 确定 MDT 空间需求在计算 MDT 大小时，一个需要考虑的重要因素是存储在文件系统中的文件数量，Ii] MDT 上每个索引节点至少需要 2 KIB 的可用空间。由于 MDT aii AY RAID-1+0 镜像，所需的总存储量还须翻倍。请注意，每个 MDT 实际使用的空间大小与很多因素有关，如每个路径下文件数量、每个文件的条带数、文件是否含 ACL 或用户扩展属性、每个文件的硬链接数。Lustre 文件系统元数据所需的存储",
        "上的数据。考虑到每个索引布扣的额外数据空间使用情况，每个索引节点上的 MDT 至间也应做出相应的增加:6 KiB/inode x 100 million inodes x 2 = 1200 GiB ldiskfs MDT如果 MDT WAS RA, MSS AFC Gill BET OC AF TT S38 OST 上的空间无法被使用。这种情况下，1fs df -1和aqf -imp ay LAB HSC HE ASC ary 2 AR S|的数量，以匹配 OST 上可用对象的总数量。请确保在格式化文件系统之前确定文件系统所需 MDT 的合适大小。大存储大小允许，可在文件系统格式化后增加索引和氮数量。对于 ldiskfs MDT 文件系统，对于 ldiskfs MDT 文件系统，如果底层块设备在 LVM逻辑卷上且大小可扩展，则可使用 resize2fs 工具。对于 ZFS, ATYSAIATEY Cea AY)VDEVs 到 MDT 池中，以增加用于索引市氮存储的总空间。和对绰氮将根据空间增加的大小按比例描加。请注意，1fs df -1对于ZFS MDT Al] OST 所报告的总索引节点量和空闲索引节扣量是基于每个索引和点所使用的当前空间平均大小来估计的。当 ZFS 文件系统首次格式化时，相关空闲索引节氮数量估计将会很保守〈低) 。这是由于相对和前规文件，为内部 Lustre 元数据存储所创建的目录占了很高的比率。但该估计值会随着普通用户创建更多文件而提高，而文件平均大小将更好地反映实际的站点使用情况。使用DNE 远程目录特性通过在文件系统中配置附加的MDTs，可增加 Lustre 文件系统索引和氮总数、提升总体元数据性能5.2.3 确定 OST 空间需求对于OST，每个对象所占用的空间取决于运行在系统上的用户或应用程序的使用模式。Lustre 软件默认的对象平均大小估计较为保守 〈10GiB 的 OSTs 上每个对象 64KiB，16TiB 或更大的 OSTs 上每个对象 1MiB)。如果您确信应用程序的文件平均大小与此不同，您可以指定不同的",
        "--stripe-size, --stripe-index,--Layout或--poo1以及这些选项的各种组合以用于检索特定信息。如采指定了--zaw选项，则打印条带信息时不会将文件系统默认值值荐换为未指定的字段。如果未设置条市化 EA，则将分别打印条市计数、大小和偏移量为0、0 和 -1。--mqt-indqex 打印给定目录下 MDT 的索引。列出在特定 OST 上具有对象的文件。列出有关文件的对象 ID 的详细信息。打印附加的条带信息。出条市计数〈使用的 OST 个数)。列出文件系统每个OST 的索引。列出文件条带开始的 OST 索引。列出文件所属的池。列出条带大小〈在移至下一个OST 前写入当前 OST 的数据量)列出指定目录的条目而不是其内容〈与1s -d的方式相同)。递归到所有子目录。使用指定文件布局〈条市模式) 创建新文件。(在使用setstripe之前，目录必须存在，文件不能存在)CEA LEY OST 数。当stripe_cnt为0 时使用文件系统范围的默认条市计数 〈默认值为1)。当stripe_cnt为-1 时，在所有可用 OST 上进行条带化。| G--stripe-count 相同，但允许使用 overstriping，如果stripe_cnt大于 OST 的数量，则每个 OST 会放置一个以上的条 | 于将条融数量与进程数量相匹配，或者对于速度非首快的OST，放置一个条市不能获得好的性能时，Overstriping 是非MAA.517\nLustre 文件系统操作手册这ay=H+ely--size stripe size--stripe-indexstart_ost_index--ost-index--pool poolsetstripe -dpool list{filesystem}[.poolname]|{pathname}quota [-q][-v] [-oobd_uuid| -1mdt_idx| -Iost_idx][-ul|-g|-punameuid|gnamelgid|projid] /mount_pointquota -t -Ul-g| -p /mount pointquotachown说明移至下一个 OST 之前在当前 OST 上存储的字刷数。stripe_size为0时，使用文件系统的默认条市大小〈默认"
    ]
}