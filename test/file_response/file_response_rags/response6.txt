{
    "query": " Lustre 的网络通信组件 LNet 有何作用？",
    "summaries": [
        "Lustre 文件系统通过条带化技术将数据分布到多个 OST 上，提高性能和存储能力。可用带宽由网络带宽和磁盘带宽的最小值决定，文件系统空间为所有 OST 可用空间之和。条带化允许文件跨多个 OST 存储，提升大文件处理能力。Lustre 网络（LNet）支持多种网络类型，实现高可用性和故障切换，确保系统在故障时快速恢复，减少停机时间。",
        "Lustre 的路由表配置通过单独的 .conf 文件实现，便于分发。若设置 config on load=1，LNet 会在 nodqprobe 期间启动，确保模块加载时路由即可工作。使用 lctl ping {nid} 可快速验证 LNet 配置。网络拓扑参数决定节点加入的网络及路由方式。ip2nets 用于定义全局网络及其 IP 地址范围，LNet 根据节点 IP 匹配确定本地网络。语法包括网络类型、接口列表和 IP 范围。networks 参数可替代 ip2nets，显式指定网络。routes 字符串定义转发路由，格式为网络和 NID 列表。",
        "Lustre 是一种分布式文件系统，包含多个组件。MDT（元数据目标）用于存储文件系统的元数据，主 MDT 保存根目录，其他 MDT 可用于子目录。OSS（对象存储服务）为 OST（对象存储目标）提供 I/O 服务，每个 OST 存储文件数据。客户端通过 MDC（元数据客户端）和 OSC（对象存储客户端）访问文件系统。条带化目录可将目录分布到多个 MDT 上，形成统一的命名空间。LNet 是 Lustre 的网络通信基础设施。FID（文件标识符）用于唯一标识文件，支持多 MDT 环境。LFSCK 工具用于检查文件系统一致性。文件数据通过布局 EA 存储在 OST 上，客户端根据布局信息进行读写操作。"
    ],
    "contents": [
        "，<net-spec>将指定要实例化的网络。请注意，我们只采用指定网络匹配的第一个表达式。因此，为简化匹配表达式，我们在特殊条件之后放置通用条件，例如:ip2nets=\"tcp(eth1,eth2) 134.32.1.[4-10/2]; tcp(ethl) *.*.*.*\"—网络 134.32.1.* FAP sk (134.32.1.{4,6,8,10}) APT, Fi AA个接口。349\n—————Lustre 文件系统操作手册这ayip2nets=\"02ib 192.168.0.*; tcp (eth2) 192.168.0.[1,7,4,12]\"上述语句描述了 192.168.0.* 上的 IB SRA. EAS IP 接口，可被用作路由Ait 0请注意，match-all 表达式 (如*.*.*.*) A CH a ae OB Ja fa rE AY A A他<net-match>条目，应讶慎使用。以下是一个更复杂的情况，有如下路由参数 :。 两个TCP 子网。 一个Elan 子网。 设置为路由需的机右，且有 TCP 和 Elan 接口。Elan 上配置有卫，但只用于标记节点。options Inet ip2nets=€atcp 198.129.135.* 192.128.88.98; \\elan 198.128.88.98 198.129.135.3; \\routes='cp 1022@elan # Elan NID of router; \\elan 198.128.88.98@tcp # TCP NID of router '43.2.1.3. networks(\"tep\") 用于替代ip2nets，可用于指定要显式实例化的网络。语法为喜喜分隔的<net-spec>列表〈见上文)。仅当未指定ip2nets和networks时才使用默认值。43.2.1.4. routes (\"\") 这是一个列出转发的路由需网络和NID 的字符串。语法如下 (<w>是一个或多个空白字符):<Foutes> :== <route{ ; <route }<route> :=一[<net>",
        "[|File C data [图 5: Lustre cluster at scale最大文件大小不受单个目标大小的限制。在 Lustre 文件系统中，文件可以跨越多个对象 GRA 2000 个) 进行分割，每个对象可使用多达 16 TiB 的ldiskfs ，多达 256PiB 的ZFS。也就是说，ldiskfs 的最大文件大小为31.23 PB, ZFS 的最大文件大小为8EiB。受AMS OST 上可用空间的限制，Lustre 文件系统可文持最多 2°63 字 (SEB) 的文件。尽管一个文件只能被分割成 2000 个以上的对象，但是 Lustre 文件系统可以有数干个OST。访问单个文件的 IO 佛宽是文件中所有对象的总 IO 市宽，即高达 2000 个服务arHli ot. FEAL 2000 多个 OST 的系统上，客户端通过同时执行多个文件读写来完美利用文件系统总第宽。第二章 Lustre 网络 (LNet)2.1. LNet 简介在使用一个或多个 Lustre 文件系统的集群中，Lustre 文件系统的网络通信基础架构通过 Lustre Networking (LNet) 功能实现。LNet 文持许多希用网络类型 CAI InfiniBand #1] IP 网络) ，并允许同时访问路由链接的多种不同网络。当基础网络安装了恰当的 Lustre 网络驱动程序 (LND) 时，可使用远程直接内存访问 (RDMA) 方式。通过高可用性和可恢复性以及故障转移服务硕功能，实现透明恢复。LND 是一种可插拔驱动程序，可为特定网络类型提供文持。例如，ksocklnd 实现了TCP Socket LND，是文持 TCP 网络的驱动程序。LND 被加载到驱动程序堆栈中，每种网络类型对应一个LND。2.2. LNet 的主要功能LNet 的主要功能包括:40这ay\nLustre 文件系统操作手册 译者:这ay。 远程直接内存访问〈当基础网络安装了恰当的 LND)\"文持冰用网络类型”高可用性和可恢复性\"同时文持多种网络类型© 不同网络间的路由LNet 允许各种不同网络互连间的端到端读/写吞吐量达到或接近峰值带宽速率。eit2.3.Lustre 网络Lustre 网络由运行 Lustre 软件的客户端和",
        "路由表。。 单独的Lustre .conf文件使配置分发更加容易。 如果设置了config on load=1, LNet 将在nodqprobe期间启动，而不会等待Lustre 文件系统司动。这确保了路由需在模块加载时开始工作。1 # letl2 # lctl> net down。 请记得使用lct1 ping {nid} 命令来快速确认您的LNet 配置是否正确。43.2.1. LNet 选项此小节将介绍 LNet 选项。43.2.1.1. 网络拓扑”网络拓扑模块参数用于确定每个节点应加入哪些网络，是否应该在这些网络之间添加路由，以及它非本地网络之间如何通信。以下是各种网络和其支持的软件堆栈的列表:一网络 ”软件堆栈o2ib OFED Version 2548\nLustre 文件系统操作手册 译者: Pa注意Lustre 软件会忽略环回接口 (1o0)，但可使用别名为环回的任何 IP 地址〈默认情DLR). WAKER), Te ATS EMI.43.2.1.2. ip2nets(‘tep\") ip2nets (\") 是一个列出全局可用的网络的字符串，每个网络都有一组 IP 地址范围。LNet 通过将 卫 地址范围与节点的本地 卫 进行匹配来确定此列表中的本地可用网络。此选项的目的是为了能够在不同网络上的各种节点上使用相同的modules .conf文件。该字符串的语法如下:1 <ip2nets> :== <net-matcl> [ <comment ] { <net-sep> <net-match> }2 <net-match> :== [ <w> ] <net-spec <w> <ip-range { <w> <ip-range }3 [ <w |]4 <net-spec® :== <network [ \"(\" <interface-list \")\" ]5 <network> :== <nettype [ <number |]6 <nettype :== \"tcp\" | \"elan\" | \"o2ib\" | ...7 <iface",
        "<network> :== <nettype [ <number |]6 <nettype :== \"tcp\" | \"elan\" | \"o2ib\" | ...7 <iface-list’ :== <interface [ \",\" <iface-list ]8 <ip-range> :== <r-expr> \".\" <r-expr \".\" <r-expr \".\" <r-expr9 <r-expr> :== <number | \"*\" | \"([\" <r-list \"]\"10 <r-list :== <range [ \",\" <r-list ]11 <range> :== <number [ \"-\" <number [ \"/\" <number ] ]12 <comment :== \"#\" { <non-net-sep-chars }13 <net-sep> :== \";\" [| \"\\n\"14 <w> :== <whitespace-chars> { <whitespace-chars> }<net-spec> 包含了足够的信息来标识唯一的网络并加载适当的LND。LND 根据它可以使用的接口来确定 NID 中缺少的\" 网络内地址\" 部分。<iface-1Iist>用于指定网络可以使用的硬件接口。如果此选项被省略，则表示可使用所有接口。不文持<iface-1List>语法的LND 不能为其配置使用的特定接口，则将使用任何可用的接口。此时，一个节点上在任何时候都只能有这些 LND 的单个实例，并且必须省略<iface-1ist>。<net-match>条目将按声明的顺序进行扫描，逐个查看是否有节点的 卫 地址与<ip-zange>表达式之一匹配。如果匹配，<net-spec>将指定要实例化的网络。请注意，我们只采用指定网络匹配的第一个表达式。因此，为简化匹配表达式，我们在特殊条件之后放置通用条件，例如:ip2nets=\"tcp(",
        "的所有使得 Lustre 能件系统类型。FID-in-dirent 功能够识别多个 MDT 上的文件，独立于底层文能向后兼容 1.8 版本的 Idiskfs 磁盘格式。因此，从版本 1.8 FF级到版本 2.x 时，FID-in-dirent 功能不会目动后用。从版本 1.8 升级到版本 2.0 或 2.3 时，可手动启用FID-in-dirent，但这一操作只对新文件生效。LFSCK 文件系统一致性检查工具验证了MDT 和 OST 之间文件对象的一致性。具AUT F :.验证每个文件的 PID-in-dirent,37如其无效或丢失，则重新生成FID-in-dirent。\nLustre 文件系统操作手册 译者: Ba。验证每个 linkEA 条目，如其无效或丢失，则重新生成。linkEA 由文件名和父类FID 组成，它作为扩展属性存储在文件本身中。因此，linkEA 可以用来重建文件的完整路径名。有关文件数据在OST 上的位置的信息将作为扩展属性布局 EA，存储在由FID 标WARY MDT 对象中〈有具体如下图所示)。戎该文件是普通文件〈即不是目录或符号链接) ，则 MDT 对象指向包含文件数据的OST 上的1对NOST 对象。若该MDT 文件指向一个对象，则所有文件数据都存储在该对象中。若该MDT 文件指向多个对象, 则使用RAID0 将文件数据划分为多个对象，将每个对象存储在不同的 OST 上。Layout EA Stored Data Stored on OSTson MDT图 3: Lustre cluster at scale当客户端读写文件时，首先从文件的MDT 对象中获取布局EA ，然后使用这个信息ESCHER EBT I/O, ERS ART RY OSS 贡点进行交互。有具体过程如下图所示。38\nLustre 文件系统操作手册 译者:这ay1 File open requestedLayout EA returnedFID (Object J. Object K,...)Object Kwritten图 4: Lustre cluster at scaleLustre 文件系统的可用带宽如下:网络带宽等于OSS 到目标的总带宽。dena OSE Tet Atty (",
        "J. Object K,...)Object Kwritten图 4: Lustre cluster at scaleLustre 文件系统的可用带宽如下:网络带宽等于OSS 到目标的总带宽。dena OSE Tet Atty (OST) 的磁玛市宽总和，受网络带宽限制。@CIk总带宽等于磁盘带宽和网络带宽的最小值。”可用的文件系统空间等于所有 OST 的可用空间总和。1.3.1. Lustre 文件系统条带化Lustre 文件系统高性能的主要原因之一是能够以循环方式跨多个 OST 将数据条素化。用户可根据需要为每个文件配置条市数量，条市大小和 OST。当单个文件的总市宽超过蛙个 OST 的从宽时，可以使用条市化来提高性能。同时，当单个 OST 没有足够的可用空间来容纳整个文件时，条市化也能发挥它的作用。如图下图所示，条齐化允许将文件中的数据段或\" 块\" 存储在不同的OST 中。在Lustre 文件系统中，通过RAID 0 模式将数据在一定数量的对象上进行条市化。一个文件中处理的对象数称为 stripe_count。每个对象包含文件中的一个数据块，当写入特定对象的数据块超过 stripe_size HY,文件中的下一个数据块将存储在下一个对象上。stripe_count 和 stripe_size 的黑认值由为文件系统设置的，其中，stripe_count 为 1 ，stripe_size 为 1MB。用户可以在每个目录或每个文件上更改这些信。下图中, 文件 C 的 stripe_size 大于文件 A 的 stripe_ size，表明更多的数据被允许存储在文件 C 的单个条帝中。文件A 的 stripe_count 为3，则数据在三个对过上条带化。文件B 和文件 C 的 stripe_count 是 1。OST 上没有为未写入的数据预留空间。39\nFile A data [|File B data [|File C data [图 5: Lustre cluster at scale最大文件大小不受单个目标大小的限制。在 Lustre 文件系统中，文件可以跨越多个对象 GRA 2000 个",
        "多种网络类型© 不同网络间的路由LNet 允许各种不同网络互连间的端到端读/写吞吐量达到或接近峰值带宽速率。eit2.3.Lustre 网络Lustre 网络由运行 Lustre 软件的客户端和服务器组成。它不局限于一个 LNet 子网，只要网络之间可以进行路由，它可以跨越多个网络。类似地，一个单独的网络可以包含多个 LNet 子网。Lustre 网络推栈由两层组成: LNet 代码模块和 LND。LNet 层在 LND 层之上操作，其方式类似于网络层在数据链路层之上操作。LNet 层是无连接的、异步的，不进行传输数据验证。LND 层是面问和连接，通痢进行数据传输验证。LNets 通过唯一的标签进行标识，该标签为对应的 LND 和一个数字组成的字符串，如 tcp0、o2ib0、o2ib1。LNet 上的每个和点至少有一个网络标识符 (NID) ，由网络接口地址和 LNet 标签组成，形式为: *address*@*LNet label*.例如:1 192.168.1.2@tcp0d2 10.13.24.908o2ib1在革些情况下，Lustre 文件系统流量可能需要在多个 LNets 之间传递，这就需要用到 LNet 路由。请注意，LNet 路由不同于网络路由。2.4. 支持的网络类型LNet 代码模块所包含的 LNDs 支持以下网络类型 :。 InfiniBand: OpenFabrics OFED (02ib)° TCP (包括 GigE, 10GigE, IPoIB 等在内的所有 TCP 流量的网络)¢ RapidArray: ra* Quadrics: Elan4]\nLustre 文件系统操作手册这ay第三章 Lustre 文件系统的故障切换3.1. 什么是故障切换在高可用的 CHA) 系统中，通过使用元余硬软件，并利用故障时可目动恢复的软件，来最大限度地减少计划外停机时间。当出现服务需或存储设备丢失、网络或软件故隐时，系统服务将在最小的中断时间后继续运行。通希，可用性通过系统处在可工作状态的时间比例来衡量。可用性通过硬件和 或) 软件的副本来实现。这样，当主服务需发生故障或不可用时，备用服务需将进行切换，以运行应用和相关资源。该故障切换的过程在",
        "MDT。除保存文件系统根目录的主 MDT之外，还可以添加其他 MDS “it, fs MDS “aA AY MDT 来保存文件系统的子目录树。35\nLustre 文件系统操作手册 eke<DCZR At在 Lustre 2.8 中，DNE 还允许文件系统将单个目录的文件分发到多个 MDT “5 fo分布在多个MDT 上的目录称为条带化目录。“对象存储服务希 (OSS): OSS 为一个或多个本地 OST 提供文件 IO 服务和网络请MDF. WAY, OSS 服务于两个到八个 O0ST，每个最多 16TiB ，在专用节点上配置一个MDT，在每个 OSS 蔬氮上配置两个或更多 OST，以及在大量计算节点上配置客户端。> 对象存储目标 (OST): 用户文件数据存储在一个或多个对象中，每个对象位于Lustre 文件系统的单独 OST 中。每个文件的对象数由用户配置，并可根据工作负载情况调试到最优性能。。 Lustre 客户器: Lustre 客户端是运行 Lustre 客户端软件的计算、可视化、棵面节ka, LARA Lustre 文件系统。Lustre 客户端软件为 Linux 虚拟文件系统和 Lustre AR ae GEE PRE PEP iTOE ELT “EL Ps, 〈(MGC) ，一个元数据客户端 (MDC) 和多个对象存储客户端90SC) 。一个客户端软件对应于文件系统中的一个 OST。WAKA (LOV) 通过聚合 OSC 以提供对所有 OST 的透明访问。因此，载入了Lustre文件系统的客户端会看到一个连贯的同步名称空间。多个客户端可以同时写入同一文件的不同部分，而其他客户端可以同时读取文件。罗辑元数据卷 (LMV) 通过聚合 MDC 提供一种与 LOV 文件访问方式类似的对所有 MDT 的透明访问。这人允许了客户端将多个 MDT 上的目录树视为一个单一的连贯名称空间，并将条带化目录合并到客户端形成一个单一目录以便用户和应用程序查看。下表给出了每个 Lustre 文件系统组件的附加存储要求，以及理想的硬件特性。MDSOSSsClien所需附加空间 硬件特性偏好S 1",
        "，并将条带化目录合并到客户端形成一个单一目录以便用户和应用程序查看。下表给出了每个 Lustre 文件系统组件的附加存储要求，以及理想的硬件特性。MDSOSSsClien所需附加空间 硬件特性偏好S 1-2% 的文件系统容量 ”足够大的 CPU 功率, 足够大的内存, 快速磁盘存储。1-128 TB per OST, EAB AZT aE, ARTE OSSs 间均匀分配并与网络1-8 OSTs per OSS 带宽匹配ts 无需本地存储 低延民，高网络放宽1.2.3 Lustre 网络 LNebLustre Networking (LNet) 是一种定制网络 API，提供处理 Lustre 文件系统服务融和客户端的元数据和文件 IO 数据的通信基础设施。30\nLustre 文件系统操作手册 译者: AA1.2.4 Lustre 集群在规模上，一个 Lustre 文件系统集群可以包含数百个 OSS FART TE Pe (如下图所示)。Lustre 集群中可以使用多种类型的网络，功能LustreClientsPOOOO:= InfiniBand network= Ethermet network1.3. LustreManagement Metadataservers (MiSs) servers [(MDSs}J MGT © MDTcba MGS 2 oes MIS 2factive) istandby) = fagtive) (standb vi¢ = failover capability =O55 7Object Storageservers (55s)LustreRouters=图 2: Lustre cluster at scale文件系统存储与 UOOSS 乙间的共享存储局用故队切换Qhject StorageTargets (O STs)Commodity Storage&)Enterprise-Class StorageArrays and SAN FabricLustre 使用文件标识符 (FID) 来替换用于识别文件或对象的 UNIX inode 编号。FID是一个 128 位的标识KF (OID),Lustre 目标中都是唯一的。这4符，其中 ，64 位用于存储唯一的序列号，32 位用于存储对象标识另外 32 位用于存储版本号。序列号在文件系统 COST 和 MDT) 中的所有使得 Lustre 能件系统类型。FID-in-dirent 功能够识别多个 MDT 上的文件，独立于底层文能向后兼容 1.8 版本的 Idiskfs 磁盘格式。因此，从版本 1.8"
    ]
}