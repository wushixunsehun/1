{
    "query": "ZFS 与 ldiskfs 在作为 Lustre 底层文件系统时有何区别？",
    "summaries": [
        "Lustre 是一个高性能、可扩展的分布式文件系统，支持 POSIX 标准，具备高可用性、数据完整性及多种网络协议。它利用 ZFS 实现存储可靠性，支持 RDMA 等高速网络，提供原子操作和数据校验以确保一致性。Lustre 支持细粒度元数据锁定、多 MDT/OST 扩展、配额管理、文件布局控制及灾难恢复工具。其组件包括 MGS、MDS、MDT 和 OSS，支持 NFS/CIFS 导出，并基于开源 GPL 2.0 许可。",
        "Whamcloud 是 DDN 的全资子公司，专注于 Lustre 文件系统的研发，并为 Lustre 社区提供项目管理框架和测试工具。Lustre 是一种高性能的集群存储系统，可在 Linux 上运行，支持 POSIX 标准，适用于大规模高性能计算（HPC）集群。它具有良好的可扩展性，能够聚合存储容量和 I/O 吞吐量，简化存储管理。Lustre 适合处理大规模数据，但在某些特定用户模式下可能不是最佳选择。Lustre 使用改进的 ext4（称为 ldiskfs）或 ZFS 作为底层文件系统，以提高性能和数据完整性。",
        "Lustre 是一种分布式文件系统，包含多个组件。MDT（元数据目标）用于存储文件系统的元数据，主 MDT 保存根目录，其他 MDT 可用于子目录。OSS（对象存储服务）为 OST（对象存储目标）提供 I/O 服务，每个 OST 存储文件数据。客户端通过 MDC（元数据客户端）和 OSC（对象存储客户端）访问文件系统。条带化目录可将目录分布到多个 MDT 上，形成统一的命名空间。LNet 是 Lustre 的网络通信基础设施。FID（文件标识符）用于唯一标识文件，支持多 MDT 环境。LFSCK 工具用于检查文件系统一致性。文件数据通过布局 EA 存储在 OST 上，客户端根据布局信息进行读写操作。"
    ],
    "contents": [
        "可扩展性当前实际范围每个 OSS 文持采用 ldiskfs ，1到32个OST每个OST文持 3已知生产环境使用基于 ldiskfs ,32 个 OST,每个 OSS 连接每个 OST 容量亿对象, 2S6TiB 容量ZFS: 每个OST 支持 5 亿对象，256TiB 容量每个 OSS 文持 ISGB/s 聚合市宽为 10TB/s每个MDS 支持1到4个MDT;基于ldiskfs ，每个MDT 支持 40亿文件，8TiB 容量; 基于 zfs,每个MDT 文持 640 亿文件，64TiB Kit; 支持最多 256 个MDT |创建操作性能 50000 个每秒stat 操作性能 200000 个每秘基于 ldiskfs 最大单文件大小32PiB基于 ZFS 最大单文件大小 263aa最多 512PiB AH,1 万亿文件32为8TiB基于 ldiskfs ，每个 OSS 连接8/4 OST, #4. OST 容量头32TiB基于 ZFS，每个 OSS 连接一个大小为72TiB 的 OST450 个0SS，一共 1000个OST，每个 OST 大小为4TiB192 个 OSS,OST, 4&7. OST 大小为8TiB768 个 OSS,OST，每个 OST 大小为72TiB每个 OSS 支持 10GB/s, 38合带宽为 2.5TBAS每个MDS，30 亿文件，7 个MDS，MDT 总容量 72TiB一共 1344 个一共768 个创建操作性能 15000 个每秒stat 操作性能 50000 个每秒单文件几个 TiB总容量 SSPiB 80 亿文件\nLustre 文件系统操作手册 译者:这aX其他 Lustre 软件性能特征如下:“性能增强的 ext4 文件系统: Lustre 文件系统使用改进版的 ext4 日志文件系统来存储数据和元数据。这个版本被合名为 ldiskgs ，不仅性能有所提升且提供了 Lustre文件系统所需的附加功能。可使用ZFS 作为Lustre fy MDT, OST 和MGS 存储的后备文件系统。这使 Lustre 能够利用 ZFS 的可扩展性和数据完整性特性来实现单个存储目标。“ 符合 POSIX 标准: 完整的POSIX 测试套件以完全相同的方式传递到本地的",
        "李硕“字闻粒度文件和细粒度元数据锁定: 许多客户端可以同时读取和修改相同的文件或目录。Lustre 分布式锁管理种 (LDLM) 确保了文件系统中所有客户端和服务融之间的文件是一致的。其中，MDT 锁管理带负责管理node 权限和路径名锁。个OST 都有其目己的锁管理釉，用于锁定存储在其上的文件条带，其性能与文件系统大小相关。“配额: 用户和组配额可用于 Lustre 文件系统。“容量增长: 通过向群集添加新的 OST 和 MDT，可以不中断地增加 Lustre 文件系统的大小和集群总惠宽。“受控文件布局: 可以在每个文件，每个目录或每个文件系统基础上配置跨 OST 的文件布局。这人允许了在单个文件系统中调整文件 IO 以适应特定的应用程序要求。Lustre 文件系统使用RAID-0 进行条带化并可在 OST 之间调和空间使用大小。。网络数据完整性保护: 从客户端发送到 OSS 的所有数据的校验和可防止数据在传输期间被损坏。”MPII/O: Lustre 架构具有专用的 MPI ADIO 层，优化了并行 VO 以匹配基础文件RRR> NFS 和 CIFS 导出: 可以使用NFS (通过 Linux knfsd 或 Ganesha) 或 CIFS(通过 Samba) 将 Lustre 文件重新导出，使其可以与非 Linux 客户端 〈如Microsoft*Windows 和 *Apple *Mac OS X *) 共享。\"灾难恢复工具: Lustre 文件系统提供在线分布式文件系统检查 〈LFSCK) ，当发生主要文件系统错误的情况下恢复存储组件乙间的一致性。Lustre 文件系统在存在文件系统不一致的情况下也可以运行，而 LFSCK 可以在文件系统正在使用时运行，因此 LFSCK 不需要在文件系统恢复生产之前完成。。 性能监视: Lustre 文件系统提供了多种机制来检查性能和进行调整。。开放源代码: Lustre 软件已获得在 Linux 操作系统上运行的 GPL 2.0 许可证。1.2. Lustre 组件Lustre 软件的安装包括管理服务器 (MGS) 和一个或多个与 Lustre 网络 (LNet)",
        "客户提供专业的高性能存储软件、硬件、技术文持及服务。Whamcloud 公司为独立运营的 DDN 公司全资子公司，长期专注 Lustre 文件系统研发，为 Lustre 社区提供了长期免费的项目管理框架、测试框RE RHE, IJIN Lustre 文件系统贡献了绝大部分的新代码，是 Lustre 文件系统研BEAN SE bs ENCCOFS (China Open File System ，中国开源文件系统，网站: http://www.chinafs.org/)te TARA TIAA, SCH LG Lustre 在内的开放、开源的文件系统和存储技术在中国社区的使用和推广。COFS 以服务中国用户和群体为守则，以实际应用需求为导辐，以开源项目为基础，以相关三 商为依托，组织社区活动，促进用户交流，构建话跃、进取的中国用户社区，从而更好地促进 Lustre 等开源先进技术在中国的推广和应用，进而促使开源项目为中国用户的生产活动提供更好的文持。如果您发现文档存在错漏，或有任何与本文档或 Lustre 相关的建议、意见或疑问，欢迎与我们联系: 72 4r, pkuelelixi@163.com. FRG MARIAH AES fF改进本文档。如果您有意参与其中，请与我们联系。第一章 Lustre 结构探析1.1 Lustre 文件系统是什么Lustre 如构是一种集群存储体系结构，其核心组件就是 Lustre 文件系统。该文件系统可在 Linux 操作系统上运行，并提供了符合 POSIX* 标准的 UNIX 文件系统接口。Lustre 淋构可被用于许多不同种类的集群。它为许多全球最大的高性能计算 (HPC)集群提供动力,包括数以万计的客户端系统，PB 级存储和每秒数百 GB 的吞叶量。许多30\nLustre 文件系统操作手册 译者: PaHPC 站点使用 Lustre 文件系统作为站点范围的全局文件系统，为数十个群集提供服务。Lustre 文件系统具有根据需要扩展容量和性能的能力，削弱了部则多个独立文件系统的必要性〈如每个计算群集部辕一个文件系统) ，从而避免了在计算集群乙间复制数据，简化了存储管理。Lustre 文件系统不仅可将许多服务锅的存储容量进行聚合，也可将其 IO 吞吐量进行聚合并通过和外服务贷",
        "已获得在 Linux 操作系统上运行的 GPL 2.0 许可证。1.2. Lustre 组件Lustre 软件的安装包括管理服务器 (MGS) 和一个或多个与 Lustre 网络 (LNet) 互连的 Lustre 文件系统。Lustre 文件系统组件的基本配置如下图所示:34\nLustre 文件系统操作手册ayManagement Server (MGS) Management Target MGT}Metadata Server (MDS) Metadata Target (MILT }© Sy Co-located MS and MDS share storageLustre clientsEn Ethermet or InfiniBand Network © ®oss 1©. 8Object Storage Servers(OSSs}图 1: Lustre component1.2.1. 管理服务器 (MGS)MGS 存储集群中所有 Lustre 文件系统的配置信息，并将此信息提供给其他 Lustre组件。每个 Lustre target 通过联系 MGS 提供信息，而 Lustre 客户通过联系 MGS 获取信起Ju OMGS 最好有目己的存储空间，以便可以独立管理。但同时，MGS 可以与 MDS 共址并共享存储空间，如上图中所示。1.2.2 Lustre 文件系统组件每个 Lustre 文件系统由以下组件组成:“元数据服务器 (MDS) - MDS 使存储在一个或多个 MDT 中的元数据可供 Lustre客户器使用。每个 MDS 管理 Lustre 文件系统中的名称和目录，并为一个或多个本地 MDT 提供网络请求处理。“元数据目标 (MDT) - 每个文件系统至少有一个MDT。MDT 在 MDS 的附加存储上存储元数据〈例如文件名，上目录，权限和文件布局)。虽然共享存储目标上的MDT 可用于多个 MDS，但一次只能有一个 MDS 可以访问。如采当前 MDS 发生web, Wl A MDS 可以为MDT 提供服务，并将其提供给客户中。这被称为MDS故障切换。分布式命名空间环境 (DNE) 可文持多个 MDT。除保存文件系统根目录的主 MDT之外，还可以添加其他 MDS “it, fs MDS “aA AY MDT 来保存文件系统的子目录树。35\nLustre 文件系统操作手册 eke",
        "部辕一个文件系统) ，从而避免了在计算集群乙间复制数据，简化了存储管理。Lustre 文件系统不仅可将许多服务锅的存储容量进行聚合，也可将其 IO 吞吐量进行聚合并通过和外服务贷进行扩展。通过动态地添加服务锅，轻松实现整个集群的吞吐量和容量的提升。虽然 Lustre 文件系统可以在许多工作环境中运行，但也并非就是所有应用程序的最佳选择。当单个服务硕不能提供所需容量时，使用 Lustre 文件系统处理集群无疑是最适合的。由于其强大的锁定功能和数据一致性，即使在单个服务需环境下，Lustre 文件系统在大多数情况下也比其他文件系统表现得更好。Any, Lustre 文件系统并不特别适用于\" ORT\" 用户模式。这是由于在这种模式下客户端和服务器在同一节点上运行，缺少 Lustre 软件级别的数据复制，每个节点共享少量存储; QURAN RA tt BCE Dt, TREO A EE EIA ST a I)前将不可被访问。1.1.1. 性能特征Lustre 文件系统可运行在各种厂商的内核上。Lustre 安逆可根据客户端世点数量、人磁一存储量、囊宽进行扩展。可扩展性和性能取决于可用磁盘、网络市宽以及系统中服务俘的处理能力。Lustre 文件系统可以以多种配置进行部轨，这些配置的可扩展性远远超出了生产系统中迄今所观察到的规模和性能。下表中列出了一些 Lustre 文件系统的可扩展性和性能特征;特征 当前实际范围 已知生产环境使用客户端可扩展性 100-100000 50000+ 客户端, 许多或在10000 ~ 20000 之间客户端性能 单个客户端: 90% 网络带宽 TO; BASS Pig: 4.5 GB/sec IO总计:10 TB/sec I/O (FDRIB, OPA1) 1000 元数据 ops/sec 聚合市宽: 2.5 TB/sec I/O31\nLustre 文件系统操作手册这ay特征OSS 可扩展性OSS 性能MDS 扩展性MDS 性能文件系统可扩展性当前实际范围每个 OSS 文持采用 ldiskfs ，1到32个OST每个OST文持 3已知生产环境使用基于 ldiskfs ,32 个 OST,每个 OSS 连接每个 OST 容量亿",
        "的所有使得 Lustre 能件系统类型。FID-in-dirent 功能够识别多个 MDT 上的文件，独立于底层文能向后兼容 1.8 版本的 Idiskfs 磁盘格式。因此，从版本 1.8 FF级到版本 2.x 时，FID-in-dirent 功能不会目动后用。从版本 1.8 升级到版本 2.0 或 2.3 时，可手动启用FID-in-dirent，但这一操作只对新文件生效。LFSCK 文件系统一致性检查工具验证了MDT 和 OST 之间文件对象的一致性。具AUT F :.验证每个文件的 PID-in-dirent,37如其无效或丢失，则重新生成FID-in-dirent。\nLustre 文件系统操作手册 译者: Ba。验证每个 linkEA 条目，如其无效或丢失，则重新生成。linkEA 由文件名和父类FID 组成，它作为扩展属性存储在文件本身中。因此，linkEA 可以用来重建文件的完整路径名。有关文件数据在OST 上的位置的信息将作为扩展属性布局 EA，存储在由FID 标WARY MDT 对象中〈有具体如下图所示)。戎该文件是普通文件〈即不是目录或符号链接) ，则 MDT 对象指向包含文件数据的OST 上的1对NOST 对象。若该MDT 文件指向一个对象，则所有文件数据都存储在该对象中。若该MDT 文件指向多个对象, 则使用RAID0 将文件数据划分为多个对象，将每个对象存储在不同的 OST 上。Layout EA Stored Data Stored on OSTson MDT图 3: Lustre cluster at scale当客户端读写文件时，首先从文件的MDT 对象中获取布局EA ，然后使用这个信息ESCHER EBT I/O, ERS ART RY OSS 贡点进行交互。有具体过程如下图所示。38\nLustre 文件系统操作手册 译者:这ay1 File open requestedLayout EA returnedFID (Object J. Object K,...)Object Kwritten图 4: Lustre cluster at scaleLustre 文件系统的可用带宽如下:网络带宽等于OSS 到目标的总带宽。dena OSE Tet Atty (",
        "存储的后备文件系统。这使 Lustre 能够利用 ZFS 的可扩展性和数据完整性特性来实现单个存储目标。“ 符合 POSIX 标准: 完整的POSIX 测试套件以完全相同的方式传递到本地的 ext4文件系统。在集群中，大多数操作都是原子操作，因此客户端永远不会看到损坏的数据或元数据。Lustre 软件文持mmap 0 MPF I/O 操作。.高性能异构网络: Lustre 软件支持各种高性能低延迟的网络，人允许远程直接内存访问 (RDMA) 方式实现在 InfiniBand、IntelOmniPath 等高级网络上的快速高效网络传输。可使用 Lustre 路由桥接多个RDMA 网络以获得最佳性能。Lustre 软件同时也集成了网络诊断。。 高可用性: Lustre 文件系统通过OSTSs (OSS targets) 或者MDT (MDS target) 的共享存储分区实现主动/主动故隐切换。Lustre 文件系统可以与各种高可用性 CHA)管理融一起工作，以实现目动故障切换并消除了单氮故了区 (NSPF) 。这使得应用程序透明恢复成为可能。多重安逆保护 (MMP) 提供了对高可用性系统中的错误的综合保护，和否则将会导致文件系统损坏。可配置多个 MDT 的主动/主动故障切换。这人允许了通过添加 MDT 存储设备和 MDS蔬氮来扩展 Lustre 文件系统的元数据性能。\"安全性: 默认情况下，TCP 连接只人允许授权端口通过。UNIX 组成员身份在 MDS上进行验证。“访问控制列表 (ACL) 及扩展属性: Lustre 安全模型遵循 UNIX 文件系统原则，并使用POSIX ACL 进行增强。请注意一些附加功能，如 root squash.“互操作性: Lustre 文件系统运行在各种 CPU 架构和混合端群集上，并在连续发布的一些主要 Lustre 软件版本乙间具有互操作性。“基于对象的体系结构: 客户端与磁盘文件结构相互隔离，可在不影响客户端的情况下升级存储体系结构。33\nLustre 文件系统操作手册 译者: 李硕“字闻粒度文件和细粒度元数据锁定: 许多客户端可以同时读取和修改相同的文件或目录。Lustre 分布式锁管理种 (LDLM) 确保了文件系统中所有客户端和服务融之间的文件是一致",
        "MDT。除保存文件系统根目录的主 MDT之外，还可以添加其他 MDS “it, fs MDS “aA AY MDT 来保存文件系统的子目录树。35\nLustre 文件系统操作手册 eke<DCZR At在 Lustre 2.8 中，DNE 还允许文件系统将单个目录的文件分发到多个 MDT “5 fo分布在多个MDT 上的目录称为条带化目录。“对象存储服务希 (OSS): OSS 为一个或多个本地 OST 提供文件 IO 服务和网络请MDF. WAY, OSS 服务于两个到八个 O0ST，每个最多 16TiB ，在专用节点上配置一个MDT，在每个 OSS 蔬氮上配置两个或更多 OST，以及在大量计算节点上配置客户端。> 对象存储目标 (OST): 用户文件数据存储在一个或多个对象中，每个对象位于Lustre 文件系统的单独 OST 中。每个文件的对象数由用户配置，并可根据工作负载情况调试到最优性能。。 Lustre 客户器: Lustre 客户端是运行 Lustre 客户端软件的计算、可视化、棵面节ka, LARA Lustre 文件系统。Lustre 客户端软件为 Linux 虚拟文件系统和 Lustre AR ae GEE PRE PEP iTOE ELT “EL Ps, 〈(MGC) ，一个元数据客户端 (MDC) 和多个对象存储客户端90SC) 。一个客户端软件对应于文件系统中的一个 OST。WAKA (LOV) 通过聚合 OSC 以提供对所有 OST 的透明访问。因此，载入了Lustre文件系统的客户端会看到一个连贯的同步名称空间。多个客户端可以同时写入同一文件的不同部分，而其他客户端可以同时读取文件。罗辑元数据卷 (LMV) 通过聚合 MDC 提供一种与 LOV 文件访问方式类似的对所有 MDT 的透明访问。这人允许了客户端将多个 MDT 上的目录树视为一个单一的连贯名称空间，并将条带化目录合并到客户端形成一个单一目录以便用户和应用程序查看。下表给出了每个 Lustre 文件系统组件的附加存储要求，以及理想的硬件特性。MDSOSSsClien所需附加空间 硬件特性偏好S 1",
        "，并将条带化目录合并到客户端形成一个单一目录以便用户和应用程序查看。下表给出了每个 Lustre 文件系统组件的附加存储要求，以及理想的硬件特性。MDSOSSsClien所需附加空间 硬件特性偏好S 1-2% 的文件系统容量 ”足够大的 CPU 功率, 足够大的内存, 快速磁盘存储。1-128 TB per OST, EAB AZT aE, ARTE OSSs 间均匀分配并与网络1-8 OSTs per OSS 带宽匹配ts 无需本地存储 低延民，高网络放宽1.2.3 Lustre 网络 LNebLustre Networking (LNet) 是一种定制网络 API，提供处理 Lustre 文件系统服务融和客户端的元数据和文件 IO 数据的通信基础设施。30\nLustre 文件系统操作手册 译者: AA1.2.4 Lustre 集群在规模上，一个 Lustre 文件系统集群可以包含数百个 OSS FART TE Pe (如下图所示)。Lustre 集群中可以使用多种类型的网络，功能LustreClientsPOOOO:= InfiniBand network= Ethermet network1.3. LustreManagement Metadataservers (MiSs) servers [(MDSs}J MGT © MDTcba MGS 2 oes MIS 2factive) istandby) = fagtive) (standb vi¢ = failover capability =O55 7Object Storageservers (55s)LustreRouters=图 2: Lustre cluster at scale文件系统存储与 UOOSS 乙间的共享存储局用故队切换Qhject StorageTargets (O STs)Commodity Storage&)Enterprise-Class StorageArrays and SAN FabricLustre 使用文件标识符 (FID) 来替换用于识别文件或对象的 UNIX inode 编号。FID是一个 128 位的标识KF (OID),Lustre 目标中都是唯一的。这4符，其中 ，64 位用于存储唯一的序列号，32 位用于存储对象标识另外 32 位用于存储版本号。序列号在文件系统 COST 和 MDT) 中的所有使得 Lustre 能件系统类型。FID-in-dirent 功能够识别多个 MDT 上的文件，独立于底层文能向后兼容 1.8 版本的 Idiskfs 磁盘格式。因此，从版本 1.8"
    ]
}