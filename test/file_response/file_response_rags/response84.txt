{
    "query": "如何理解和应用 dom_stripesize 参数？它在启用Data-onMDT（DoM）特性时起到什么作用？",
    "summaries": [
        "本文档介绍了Lustre文件系统中DoM（Directory Object Manager）相关操作，包括使用`lfs getstripe`命令查看DoM文件的布局和大小，以及`lfs find`命令搜索具有特定布局或条带大小的DoM文件或目录。还详细说明了如何通过`lctl`工具设置和获取MDT上的`dom_stripesize`参数，该参数控制DoM文件的最大条带大小。此外，文档提到可以通过将`dom_stripesize`设为0来禁用DoM文件创建。最后简要提及了MDT的Lazy大小功能（LSOM）。",
        "该文本介绍了Lustre文件系统中DoM（Directory of Metadata）布局的设置和管理。首先，通过`lfs setstripe`命令可以为目录设置DoM布局，使得在此目录下创建的文件默认继承该布局。使用`lfs getstripe`可查看文件或目录的布局信息，包括组件大小、条带数量、条带大小、模式等。DoM组件的最大大小受多种限制，如Lustre的最小条带大小限制和MDT服务器的参数设置。此外，DoM布局允许将元数据分散到多个OST上，提高性能。",
        "当两个OST的空闲空间差异超过指定阈值时，使用加权分配法，该参数由qos_threshold_rr定义。默认qos_threshold设置为25，可通过命令调整。加权优先级由qos_prio_free参数控制，增加该值会提高对空闲空间的权重。当设置为100时，条带算法仅基于空闲空间。Lustre文件可分条在多个OST上，具体数量取决于MDT类型和功能。DoM功能通过将小文件存储在MDT上提升性能，支持组合布局，使用lfs setstripe命令创建。"
    ],
    "contents": [
        ":Imm pattern: mdtImm layout gen: 0Imm Stripe offset: 2Imm_ objects:lcome_id: 2lcme flags: 0lcome extent.e start: 1048576lome_extent.e end: EOFImm stripe count: 1Imm stripe size: 1048576Imm _ pattern: raid0OImm layout gen: 65535Imm stripe offset: -1我们可以看到该目录中的第一个文件 normfile 具有普通布局，而文件 domfile 继承了目录的默认布局，为 DoM 文件。注意尽管服务器的 DoM 大小限制会被设置成一个较低的值，该目录的默认布局设置仍会被新文件继承。20.2.3.DoM 条带大小限制DoM 组件的最大大小受到几种限制，以预防 MDT 最终被大文件填满。20.2.3.1. Lustre C/E AZ (LFS) 限制 1fs setstripe 允许将 MDT 布局的组件大小设置为 1GB, 但由于受 Lustre 中的最小条带大小所限〈见表 5.2\" 文件和文件系统限制\") ,其组件最大大小也只能为 64KB。同时，1fs setstripe -E end可以对每个文件有一个限制，如果对某一特定用途来说，这个限制可能小于 MDT 规定的限制。20.2.3.2.MDT 服务器限制 LOD 参数1odq.S$fsname-MDTxxxx.dqom stripesize 用于控制 DoM 组件的每个 MDT 的最大大小。如果用户指定的 DoM 组件较大，将被截断到MDT 指定的限制。因此，如果需要的话，每个MDT 上的 DoM 空间使用量可能不同，以获取平衡。它默认为 1IMB，可通过 lctl 工具进行更改。有关设置dom_stripesize的更多信息，请参见本章第 2.6 节\"dom stripesize 参数\"。247\nLustre 文件系统操作手册这ay20.2.4. 1fs getstripelfs getstripe 命令用于列出给定文件的分条/组件信息。对于 DoM 文件，以用来检查其布局和大小。1 lfs getstripe [--component-id|-I [comp_id]] [--layout|-L] \\2[--stripe-size|",
        "type f /mnt/lustre/mnt/lustre/domfile/mnt/lustre/domdir/domfileclient$S lfs find -L mdt -type d /mnt/lustre/mnt/lustre/domdir通过该命令可查找所有 DoM 对象，DoM 文件或具有默认 DoM 布局的目录。搜索指定条带大小的 DoM 文件/目录:client$ lfs find -L mdt -S -1200K -type f /mnt/lustre/mnt/lustre/domfile/mnt/lustre/domdir/domfileclient$ lfs find -L mdt -S +200K -type f£ /mnt/lustre/mnt/lustre/domfile/mnt/lustre/domdir/domfile第一个命令查找条市大小小于 1200KB 的所有 DoM 文件。第二个命令碍找条带大小大于 200KB 的所有 DoM 文件。这两种情况下都能返回所有 DoM 文件，因为这里的DoM 大小为 1IMB。249\n——Oo10——ULDNnOoLustre 文件系统操作手册 译者:这ay20.2.6. dom_stripesize BYMDT 通过LOD 设备上的参数 dom_stripesize (HMR at ESUA DoM 最大大小。必要时，可以为每个MDT 设置不同的 dom_stripesize 。该参数的默认值为1MB，可以使用 lclt 工具进行更改。lctl get_param lod. *MDT<index>* .dom_ stripesize20.2.6.2. Get 示例”运行下面的命令可获取服务需允许的最大 DoM Ky). Zia, FAN试创建了一个比参数信人还大的文件，和预期一样，该操作失败并报错。mds# lctl get Param lod. *MDTO000*.dom_stripesizelod. lustre-MDT0000-mdtlov.dom_stripesize=1048576mds# lctl get param -n lod. *MDT0000* .dom_ stripesize1048576client$ lfs setstripe -E 2M -L mdt /mnt/lustre/dom2mbCreate composite file /mnt/lustre/dom2mb failed. Invalid argumenterror: setstripe: create composite file '/mnt/lustre/dom2mb' failed:Invalid argument20.2.",
        "-L \\2 mdt [--component-end|-E end2 [STRIPE OPTIONS] ...] <filename>上面的命令创建了一个具有特殊组合布局的文件，它将第一个组件定义为 MDT组te, MDT 组件必须从偏移 0 开始并在enal结束。endl也是该组件的条带大小，并受MDT 的lod.*x .dom_stripesize限制。无需其他选项。其余组件使用正常的语法来创建组合文件。注意如果下个组件未指定条带信息，如:1 lfs setstripe -E 1M -L mdt -E EOF <filename>WW AAP EE SCE ARCA Ri BC20.2.1.2. 示例 FIER GE“ DOM 布局的文件。第一个组件为MDT 布局，被放置在MDT EF, Aiki (0, 1M). 58 SAPP Aa: [LIM，EOF) ，并在所有可用的OST 上进行分条。1 client$ 1fs setstripe -E 1M -L mdt -E -1 -S 4M -c -1 \\2 /mnt/lustre/domfile其布局如下图所示:MDT N OSTs| [o, 1MB)(0, 1M)[1M, EOF)|图 24: Lustre component相关布局信息也可通过 1fs getstripe 命令显示:1 clientS lfs getstripe /mnt/lustre/domfile2 /mnt/lustre/domfile3 Icom layout gen: 24 lem mirror count: 15 lcmentry count: 26 lome_id: 17 lome flags: init243\n89101213141516171819202122232425这ayLustre 文件系统操作手册 译lcome extent.e start: 0lcome_extent.e end: 1048576Imm stripe count: 0Imm stripe size: 1048576Imm pattern: mdtImm layout gen: 0Imm stripe offset: 0Imm_ objects:lcome_id: 2lcome_ flags: 0lcome extent.e start: 1048576lome_extent.e end: KOFImm stripe count: -1Imm stripe size: 4194304Imm _ pattern:",
        "DoM 文件，以用来检查其布局和大小。1 lfs getstripe [--component-id|-I [comp_id]] [--layout|-L] \\2[--stripe-size|-S] <dirname| filename1 clientS lfs getstripe -I1 /mnt/lustre/domfile23451012131415/mnt/lustre/domfilelcm layout gen: 3lem mirror count: 1lem entry count: 2lcome_id:lome flags:lome extent.e start:lome_extent.e end:Imm stripe count:Imm stripe size:Imm pattern:Imm layout_gen:Imm stripe offset:Imm_ objects:init0104857601048576mdt02DoM 组件布局和大小的简略信息课通过 -工选项配合-S 或 -了选项来获取:clientS lfs getstripe -I1 -L -S /mnt/lustre/domfileImm stripe size:Imm pattern:1048576mdtclientS lfs getstripe -I1 -L -E /mnt/lustre/domfilelome_extent.e end:Imm pattern:1048576mdt这两个命令都将返回布局类型及其大小。条带大小等于 DoM 文件中组件的范围大小，因此两者都可用于获取 MDT 上的范围大小。248\n——ULDOo10—ULDNnanLustre 文件系统操作手册泽者:这ay20.2.5. lfs findlfs find 命令可用于搜索以给定目录或文件名为根的目录树，以查找与指定参数相匹配的文件。下面的命令输出了 DoM 文件的新参数，用法类似于 Ifs getstripeAs 人命令.lfs find <directory|filename> [--layout|-L] [...]20.2.5.2. 示例 在目录 /mnt/lustre 下搜索所有 DoM 布局的文件:clients lfs find -L mdt /mnt/lustre/mnt/lustre/domfile/mnt/lustre/domdir/mnt/lustre/domdir/domfileclient$ lfs find -L mdt -type f /mnt/lustre/mnt/lustre/domfile/mnt/lustre/domdir/domfileclient$S lfs find -L mdt -type d /mnt/lustre/mnt/lustre/domdir通过",
        "两个OST 的空亲空间大小差超过指定浆值 〈黑认为 179%) 时，使用加权分配法。这两种分配方式中HEME HHqos threshold_rrr参数定义。暂时将 qos threshold 设置为25，请在 MGS 上运行:mds# lctl set param lod.fsname*.gos threshold _rr=2519.8.3. 调整可用空间和位置的权重加权分配法使用的加权优先级由qos_prio free参数设置。增加qos_prio_free 的值会增加衡量每个OST 上可用空间大小的权重，减少衡量 OST 上的条带分布方式的权重。软认值是91 〈昕分比)。当空闲空间优先级设置为 100〈百分比) 时，条带算法完全基于空亲空间，而不考虑位置。要将分配器权重永久地更改为 100，请在 MGS 上输入此命令:lctl conf param fsname-MDTO000-* .lod.qos prio free=100注意当 qos_prio_free设置为 100 时，仍然使用加权随机算法来分配条。如果 OST2的可用空间是 OST1 的两倍，则使用 OST2 的可能性是 OST1 的两倍，但不能保证就一定使用 OST2.19.9. Lustre 条带化内部参数根据能够存储在 MDT 上的属性的最大大小，单个文件可在有限数量的 OST 上进行分条。如果是基于 ldiskfs 的MDT 且没有局用 ea_inode 功能，则文件最多可以在 160241\n1Lustre 文件系统操作手册 译者:As大个OST 上分条。如果是基于 ZFS 的 MDT 或是基于 ldiskf 的 MDT 司用了 ea _inode功能，则文件可以在多达 2000 个 OST 进行分条。Lustre inode 使用扩展属性来记录每个对象所在的 OST 以及每个对象在该 OST 上的标识符。扩展属性的大小可以表示为条带数量的函数。如果使用基于 ldiskf 的 MDT，可以通过局用 MDT 上的 ea_inode 功能将文件分割在更多的 OST 上，最大数量为 2000:tune2fs -O ea _jinoqe /dev/mdtdev注意",
        "MDT，可以通过局用 MDT 上的 ea_inode 功能将文件分割在更多的 OST 上，最大数量为 2000:tune2fs -O ea _jinoqe /dev/mdtdev注意单个文件的最大条剖数不会限制整个文件系统中 OST 的最大数量，只会限制文件的最大大小和最大聚合带宽。(Lustre 2.11 中引入)第二十章 MDT 数据功能 (DoMD20.1. 简介LustreMDT 数据功能〈DoM) 通过将小文件直接放置 MDT 上来改进小文件 IO，通过避免使用容易被随机小 IO 事件〈将导致设备搜索) 影响流 IO 性能的 OST 来改进大文件I9。因此，用户在小文件 IO 模式和混合 IO 模式上都获得更好的一致性性能。DoM 文件的布局作为组合布局存储在磁盘上，是渐进式文件布局 (PFL) 的特例。DoM 文件的布局由文件的组件组成，放在 MDT 上，其余的组件放在 OST 上 CUR it要)。第一个组件放置在MDT 上的对象数据冉中。该组件只有一个条帝，大小等于组件大小。这种具有 MDT 布局的组件只能是组合布局中的第一个组件。其余组件像往币一样通过 RAIDO 布局放置在 OST 上。在超出 MDT 组件大小的文件之后，客户端进行数据写入或截断，OST 组件才被实例化。20.2. 用户命令Lustre 提供 1fs setstripe 命令以方便用尸创建 DoM 文件。此外，像往币一样，lfs getstripe 命令可用于列出给定文件的分条/组件信息。而1fs find 命令可用于搜索以给定目录或文件名为根的目录树，以查找与给定 DoM 组件参数〈如布局类型)匹配的文件。20.2.1. 1fs setstripelfs setstzrip命邻用于创建 DoM 文件。242\nany,ak4hayLustre Cf AER EF1 lfs setstripe --component-end|-E endl —-layout|-L \\2 mdt [--component-end|-E end2 [STRIPE OPTIONS] ...] <filename>上面的命令创建了一个具有特殊组合布局的文件，它将第一个组件定义为",
        "_id: 2lcome_ flags: 0lcome extent.e start: 1048576lome_extent.e end: KOFImm stripe count: -1Imm stripe size: 4194304Imm _ pattern: raid0OImm layout gen: 65535Imm stripe offset: -1上面的输出表明: 第一个组件大小为 1IMB，类型为mdt。第二个组件还未被示例化，见标志 LIcme flags: 0.如果有超过 IMB 的数据被写入文件，1fs getstripe 的输出也将相应地发生变101213化。client$ lfs getstripe /mnt/lustre/domfile/mnt/lustre/domfilelcm layout gen: 3lem mirror count: 1lem entry count: 2lcome_id: 1lome flags: initlcome extent.e start: 0lcome_extent.e end: 1048576Imm stripe count: 0Imm stripe size: 1048576Imm pattern: mdtImm layout gen: 0244\n141516171819202122232425262728—10Lustre 文件系统操作手册 译者:这ayImm stripe offset: 2Imm_ objects:lcome_id: 2Tcme flags: initlcome extent.e start: 10485764+lome_extent.e end: EOFImm stripe count: 2Imm stripe size: 4194304Imm pattern: raid0OImm layout gen: 0Imm stripe offset: 0Imm_ objects:- 0: { 1 ost_idx: 0, 1 fid: [0x100000000:0x2:0x0] }- 1: { 1 ost_idx: 1, 1 fid: [0x100010000:0x2:0x0] }如上所示，第二个组件有对象布置在 OSTs，条带大小为 4MB。20.2.2. 为现有目录设置 DoM 布局也可在现有目录上设置 DoM 布局。设置后，所有在此目录下创建的文件将默认继FE LEGA Jay olfs setstripe --component-end|-E endl --layout|-L mdt \\[--component-end|-E end2 [STRIPE OPTIONS] ...] <dirname>clientS mkdir /mnt/lustre/domdirclient$S touch",
        "/mnt/lustre/dom2mbCreate composite file /mnt/lustre/dom2mb failed. Invalid argumenterror: setstripe: create composite file '/mnt/lustre/dom2mb' failed:Invalid argument20.2.6.3. Set (CARY) 命令 暂时性地设置参数值，请运行 ct1 set_param:lctl set Param lod. *MDT<index>* .dom_stripesize=<value>20.2.6.4. Set CAAT) 示例 ZERO, HRA ae EA BA DoM 限制被更改为64KB ，并党试创建大小为 1IMB 的 DoM 文件。mds# lctl set param -n 1odq.xMDT0000x .dom_stripesize=64Kmds# lctl get param -n lod. *MDT0000* .dom_ stripesize65536client$ lfs setstripe -E 1M -L mdt /mnt/lustre/domCreate composite file /mnt/lustre/dom failed. Invalid argumenterror: setstripe: create composite file '/mnt/lustre/dom' failed:Invalid argument250\n—12ULDLustre 文件系统操作手册 译者:这ay20.2.6.5. Set (KA) 命令”永久性地设置参数值，请运行 1ct1 conf_param:lctl conf param <fsname>-MDT<index>.lod.dom_stripesize=<value>20.2.6.6. Set (KA) 示例“参数的新值被永久地存在配置日志中:mgs# lctl conf param lustre-MDT0000.lod.dom_stripesize=512Kmds# lctl get param -n lod. *MDT0000* .dom_ stripesize524288新设置将在几秒之内被应用，并永久保存到服务融配置中。20.2.7. 禁用 DoM“{lclt set param Hi lctl conf param将qdqom stripesize 设置为0 时，所选服务需将禁止 DoM 文件创建。注意DoM 文件仍可以使用默认的 DoM 布局在现有目录中创建。(Lustre 2.11 中引入)第二十一章 MDT 的 Lazy 大小功能 (LSoM)21.1. 简介在 Lustre 文件系统中，MDS",
        "endl --layout|-L mdt \\[--component-end|-E end2 [STRIPE OPTIONS] ...] <dirname>clientS mkdir /mnt/lustre/domdirclient$S touch /mnt/lustre/domdir/normfileclient$S lfs setstripe -E 1M -L mdt -E -1 /mnt/lustre/domdir/client$ lfs getstripe -d /mnt/lustre/domdirlcm layout gen: 0lem mirror count: 工lem entry count: 2lome_id: N/Alcome_ flags: 0lcome extent.e start: 0245\n121314151617181920—101213151617181920212223Lustre 文件系统操作手册这aylcome_extent.e end: 1048576stripe count: 0 stripe size:pattern: mdt stripe offset:lome_id: N/Alcme flags: 0lcome extent.e start: 1048576lome_extent.e end: EOFstripe count: 1pattern: raid0stripe size:stripe offset:-11048576 \\1048576 \\一工在上面的输出中，可以看到该目录具有仿 DoM 组件的默认布局。碍看该目录的文件布局:ClLients touch /mnt/lustre/domdir/domfileclient$ lfs getstripe /mnt/lustre/domdir/normfile/mnt/lustre/domdir/normfileImm stripe count: 2Imm _ stripe size: 1048576Imm pattern: raid0Jmm layout gen: 0Imm _ stripe offset: 1obdidx objid objid group1 3 0x30 3 0x3client$ lfs getstripe /mnt/lustre/domdir/domfile/mnt/lustre/domdir/domfilelcm layout gen: 2lem mirror count: 1lem entry count: 2lcome_id: 1lome flags: initlcome extent.e start: 0lcome_extent.e end: 1048576+Imm stripe count: 0+Imm stripe size: 1048576246\n2425262728293031323334353637这ayLustre 文件系统操作手册 译者:Imm pattern: mdtImm layout gen: 0Imm Stripe offset: 2Imm_ objects:lcome_id: 2lcme flags: 0lcome extent.e start: 1048576lome_extent.e"
    ]
}