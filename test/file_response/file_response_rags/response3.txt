{
    "query": "lfs setstripe 命令的作用是什么？在什么场景下使用？",
    "summaries": [
        "`lfs getstripe` 用于查看文件或目录的分片配置，包括分片数量、大小、模式等。`lfs setstripe` 用于修改分片配置，参数包括 `-c`（分片数量）、`-S`（分片大小）、`-i`（起始 OST 索引）。示例显示设置文件分片失败，但对目录设置成功后，新创建的文件使用了新的分片配置。",
        "由于Lustre工具不支持，旧的客户端会有一些限制。`lfs setstripe`命令用于创建具有复合布局的文件，可以添加或删除组件，并支持扩展为SEL组件。创建SEL文件时，使用`-E`和`-z`选项定义可扩展组件和扩展组件。例如，命令`lfs setstripe -E 1G -z 64M -E -1 -z 256M /mnt/lustre/file`创建了2对组件。`lfs getstripe`命令用于显示SEL文件的参数，如组件信息、扩展大小等。此外，可以将SEL布局模板设置到目录下，使新创建的文件默认继承该布局。",
        "Lustre 文件系统通过将文件分条到多个 OST 上，以提高峰值聚合带宽和性能。适用于大文件或高并发访问场景，最多支持 2000 个 OST。条带化可提升 IO 性能，但会增加开销和风险。选择合适的条带大小（如 1MB-4MB）有助于优化性能，避免锁定争用。使用 `lfs setstripe` 命令配置文件布局，设置条带数量、大小和起始 OST，以实现负载均衡和空间利用。"
    ],
    "contents": [
        "lmm_stripe_count:  1\nlmm_stripe_size:   1048576\nlmm_pattern:       raid0\nlmm_layout_gen:    0\nlmm_stripe_offset: 9\nobdidx           objid           objid           group\n9        22254252      0x15392ac                0\n## 设置 ost-1 的 stripe_count = -1\nnscctj@ln0:~/ost/ost-1$ cd ..\nnscctj@ln0:~/ost$ lfs setstripe -c -1 ost-1/\nnscctj@ln0:~/ost$ cd ost-1/\n## 创建文件并查看，是 120个 OST\nnscctj@ln0:~/ost/ost-1$ dd if=/dev/zero of=2.txt bs=100M count=8\n8+0 records in\n8+0 records out\n838860800 bytes (839 MB, 800 MiB) copied, 5.27194 s, 159 MB/s\nnscctj@ln0:~/ost/ost-1$ lfs getstripe 2.txt\n2.txt\nlmm_stripe_count:  120\nlmm_stripe_size:   1048576\nlmm_pattern:       raid0\nlmm_layout_gen:    0\nlmm_stripe_offset: 53\nobdidx           objid           objid           group\n53        21737589      0x14bb075                0\n59        22319048      0x1548fc8                0\n65        23144418",
        "釉上的人磁盘都可以管理线性的 IO，则不存在莞委。如宋每个文件都有 100 个对象 ，那么客户冰就会彼此竞争以获得服务硕的注意，并且每个节反上的磁盘将在 100 个不同的方向上寻找，导致不必要的竞争。“增加风险。 当文件在所有服务咒上进行条融化，而其中一人台服务吉出现故障，这坚文件的一小部分将丢失。相反，如采每个文件只有一个条带，丢失的文件会更少，但它们将宛全丢失。许多用户更能接受丢失部分文件《即使是全部内容)，而不是所有文件都丢失部分内容。19.2.1. 选择条带大小选择条带大小是一种权衡行为。下面将介绍较为合理的默认值。条齐大小对于单条审文件疫有影响。“ 条带大小必须是页大小的整数倍。Lustre 软件工具将强制执行 64KB 的整数倍(ia64 和 PPC64 区点的最大页大小) ，避免页规格较小的平台上的用尸创建可能会导致 ia64 客户端出现问题的文件。194\nLustre 文件系统操作手册 译者: 李硕。 推荐的最小条带大小是 S12KB。 虽然可以创建条带大小为 64KB 的文件，但最小的实际条带大小为 S12KB ，因为 Lustre 文件系统通过网络发送数据块大小为 1MB。选择更小的条带大小可能会导致磁盘 IO 效率低下，人性能下降。。适用于高速网络线性 VO 的条带大小在 1MB 到 4MB 之间。在大多数情况下，大于4MB 的条带大小可能导致更长的锁定保持时间，增加共享文件访问期间的争用情况。。最大条带大小为 4GB。 在访问非常大的文件时，使用较大的条带大小可以提高性能。它允许每个客户端独占访问文件的一部分。但如果条带大小与 IO 模式不匹配，较大的条带大小可能会适得其反。。 选择一个考虑到应用程序的写入模式的条带化模式。 跨越对象边界的写入效率要比在单个服务器上完整写入的效率略低。如果文件以一致旦对齐的方式写入，请将条带大小设置为 wzite () 大小的整数倍。19.3. 配置 Lustre 文件布局 〈条带化模式) (LEfEs setstripe)使用 Ifs",
        "文件以一致旦对齐的方式写入，请将条带大小设置为 wzite () 大小的整数倍。19.3. 配置 Lustre 文件布局 〈条带化模式) (LEfEs setstripe)使用 Ifs setstripe 命令创建指定文件布局〈条市化模式) 配置的新文件。1 lfs setstripe [--size|-s stripe size] [--stripe-count|-c stripe count][--overstripe-count|-C stripe count] \\2 [--index|-i start_ost] [--pool|-p pool name] filename|dirnamestripe_sizestripe size 表示移动到下一个 OST Ail] BLA OST APY BH ato BRUstripe _ size是1MB。将该参数设置为0, MITER AY). stripe_size值必须是 64 KB 的整数倍。stripe count (--stripe-count, --overstripe-count)stripe_count 表示要使用OST 的数量。默认值为 1。将其设置为0，则会使用该PRU Ai BUCH. f stripe_count 设置为-1 意味着对所有可用的 OST 进行分条。当使用 --overstripe-count时，必要时应在每个OST 上使用。start_oststart ost 是文件写入的第一个OST。start_ost 的默认值是-1，它允许 MDS选择起始索引。强烈建议使用此默认设置，因为它可根据需要通过 MDS 完成空间和负载均衡。如果将 start_ost 的值设置为非 -1，则该文件将从指定的 OST 索引开始。OST 索引编号从 0 开始。注意WR Ta REA OST 处于非活动状态或处于降级模式，则 MDS 将目动选择另一个目标。195\n———Lustre 文件系统操作手册 译者:As大如果 start ost {HW0, stripe count 值为1，则所有文件都将写入OST0, 直到空间耗尽。这很可能不是你想要的。如果您只希望调整 stripe count ，而保持其他参数为默认设置，请不要指定任何其他参数:client# lfs setstripe -c stripe",
        "由于 Lustre 工具不支持，所以旧的客户端会有一些限制。19.6.1. lfs setstripeIfs setstripe 命令用于创建具有复合布局的文件，也可以在现有文件中添加或删除组件。它还可以扩展为文持 SEL 组件。19.6.1.1. 创建SEL 文件“命令lfs setstripe2 [--component-end|-E endl] [STRIPE OPTIONS] ... filename34 STRIPE OPTIONS:5--extensiomsize, --ext-size, -Z <ext_siz&PSIN- 26 EA ST FRE ECE RIT EY PES RK) FE HAE ny 2时，这个选项会将声明的组件变成一对组件: 可扩展组件和扩展组件。示例下面的命令创建了 2 对可扩展组件和扩展组件:223\n1 # lfs setstripe -E 1G -z 64M -E -1 -z 256M /mnt/lustre/file123451012131415161718192021222325Lustre Cf AER EF这ayComponentl: Component2:[0,64MB) [64MB,1G)INIT’ed SELComponent3:[1G,1G)0-lenghtComponent4:[1G,EOF)SEL图 17: Create a SEL file图: 创建 SEL 文件注意正常情况下在创建时只实例化第一个PFL 组件，因此它立即被扩展到扩展大小〈第一个组件为 64M) ，而第三个组件则被保留为# lfs getstripe /mnt/lustre/file/rant/lustre/filelom layout gen: 4lom mirror count: 1lom_ entry count: 4lome_id: 1lome mirror id: 0lome flags: initlome extent.e start: 0lome_extent.e end: 67108864Imm stripe count: 1bkmm stripe size: 1048576bkmm pattern: raid0bkmm layout gen: 0bkmm stripe offset: 0bkmm objects:- 0: { 1 _ost_idx: 0, 1 fid: [0x100000000:0x5:0x0] }lome_id: 2lome mirror id: 0lcome flags: extensionlcome_extent.e start: 67108864lome extent.e",
        "文件分割到尽可能多的 OSS 上，以达到该文件所需的峰值聚合带宽。请注意，只有当文件大小很大或文件一次被许多节点访问时，才建议使用大量OSS 进行分条。目前，Lustre 文件可以在多达 2000 个 OST 上进行条带化。193\nLustre 文件系统操作手册 译者:As大“ 超出 OSS 带宽时用于提升性能。 如果客户端总带宽超过服务器带宽，且应用程序数据读写速率足够快而能够充分利用额外的 OSS 人带宽，则跨越多个 OSS 将文件条融化可以提高性能。最大有效条带数的限制为: 客户端/作业的 IO 28 BR BESOSS 性能。(由 Luster2.13 引入) 匹配条带与 VO 模式。当多个市点同时对一个文件进行写入时，可能有一个以上的客户痛会写到一个条带上，这会导致锁交换的问题，即客户端XT BA ATTA CPP ET FF, BEM VO Bar NE. WER IO 可以进行条价对齐，使每个条带只被一个客户器访问，就可以避免这个问题。从 Lustre 2.13 开始谎加了“overstriping\" 功能，人允许每个 OST 有多个条帝。这对于线程数超过 OST 数的情况特别有帮助，使得在这种情况下也可以将条人带数与线程数匹配。“为大文件提供空间。当单个 OST 没有足够多的空闲空间来存放整个文件时，可将文件分条。减少或避免使用条带化的原因:。 增加开销。 在常规操作 (如 stat 和unlink ) 期间，条带化会导致更多的锁定和额外的网络操作。即使这些操作并行执行，一次网络操作所花的时间也少于 100次操作。同时，服务硕竞争情况也会随之增加。考虑一个拥有 100 “SF A 100 个 OSS的集群，每个 OSS 合一个 O0ST。如宋每个文件只有一个对象并且人负载均匀分布，每人台服务釉上的人磁盘都可以管理线性的 IO，则不存在莞委。如宋每个文件都有 100 个对象 ，那么客户冰就会彼此竞争以获得服务硕的注意，并且每个节反上的磁盘将在",
        "文件名\nlfs getstripe 文件夹名\n# 举例\nnscctj@ln0:~/ost$ lfs getstripe 1.txt\n1.txt\nlmm_stripe_count:  1\nlmm_stripe_size:   1048576\nlmm_pattern:       raid0\nlmm_layout_gen:    0\nlmm_stripe_offset: 4\nobdidx           objid           objid           group\n4        23858623      0x16c0dbf                0\nnscctj@ln0:~/ost$ lfs getstripe 1.dir\n1.dir\nstripe_count:  1 stripe_size:   1048576 pattern:       0 stripe_offset: -1\n修改文件/文件夹的分片配置\n命令格式\n# 命令\nlfs setstripe -c <stripe_count> -S <stripe_size> -i <start_ost_idx> 文件名\nlfs setstripe -c <stripe_count> -S <stripe_size> -i <start_ost_idx> 文件夹名\n参数说明：\n- -c <stripe_count>  Number of OSTs to stripe over (0=fs default, -1 all)\n- -S <stripe_size>  Number of bytes on each OST (0=fs default) Can be specified with K, M or G (for KB, MB, GB respectively)\n- -i <start_ost_idx>  OST index of first stripe (-1=default round robin)\n实战举例\n## 创建大文件\nnscctj@ln0:~/ost$ dd if=/dev/zero of=1.txt  bs=100M count=4\n4+0 records in\n4+0 records",
        "lome flags:lome extent.e start:lome_extent.e end:stripe count: 1raid0lome id:lome mirror id:lome flags:lome extent.e start:lome_extent.e end:stripe count: 1raid019.6.2. lfs getstripeN/A0067108864stripe size: 1048576stripe offset: -1N/AN/Aextension671088641073741824extension size: 67108864stripe offset: -1N/AN/A010737418241073741824stripe size: 1048576stripe offset: -1N/AN/Aextension1073741824FOFextension size: 268435456stripe offset: -1pattern:pattern:pattern:pattern:lfs getstripem Ay WAR 2s xe FY SEL PFA RAH. KH,显示 SEL 文件的新参数。命令:220\nLustre 文件系统操作手册这ay1 lfs getstripe2 [--extensionsize|—--ext-size|-z] filename例1: 列出 SEL 组件信息假设我们已经有一个复合文件mntlustre/file，由以下命令创建:1 # lfs setstripe -E 1G -z 64M -E -1 -z 256M /mnt/lustre/file第 2个组件可以用以下命令列出:1 # lfs getstripe -I2 /mnt/lustre/file2 /mnt/lustre/file3 lem layout gen: 44 lcm mirror count: 15 lem entry count: 46 leome_ id: 27 lome mirror id: 08 lcme flags: extension9 Tcme extent.e start: 6710886410 lcome_extent.e end: 107374182411 Imm stripe count: 012 imm_extension size: 6710886413 Imm pattern: raid014 Imm layout gen: 015 Imm stripe offset: -1注意如上所示，SEL 组件由extension标志标记，1lmm_extension size EVR I指定的扩展大小。例 2: 列出扩展大小与例 1 中的文件相同，第二个组件的扩展名大小可以用以下方式列出:1 # lfs getstripe -z -I2 /mnt/lustre/file2 67108864例3: 扩展假设存在上例中相同的文件，假疫",
        ": 0, 1 fid: [0x100000000:0x5:0x0] }lome_id: 2lome mirror id: 0lcome flags: extensionlcome_extent.e start: 67108864lome extent.e end: 1073741824Imm _ stripe count: 0imm_extension size: 67108864224\n26272829303132333435363738394041424344454647484950Lustre 文件系统操作手册这ayImm pattern: raid0Imm layout gen: 0Imm stripe offset: -1lcome id: 3lome mirror id: 0leme flags: 0lcome extent.e start: 1073741824lome_extent.e end: 1073741824Imm stripe count: 1Imm stripe size: 1048576Imm pattern: raid0dImm layout gen: 0Imm stripe offset: -1lome id: 4lome mirror id: 0lcome flags: extensionlcome extent.e start: 1073741824lome extent.e end: EOFImm stripe count: 0Imm extension size: 268435456Imm pattern: raid0dImm layout gen: 0Imm stripe offset: -119.6.1.2. 创建 SEL 布局模板”与 PFL 类似，可以将一个 SEL 布局模板设置到一个目录下。之后，所有在其下创建的文件都将默认继承这个布局。# lfs setstripe -E 1G -z 64M -E -1 -z 256M /mnt/lustre/dir# ./lustre/utils/lfs getstripe /mnt/lustre/dir/mnt/lustre/dirlcm layout gen: 0lem mirror count: 1liom entry count: 4lome_id: N/A225\n131415161718192021222324252627282930313233Lustre 文件系统操作手册mek这aylome mirror id:lome flags:lome extent.e start:lome_extent.e end:stripe count: 1raid0lcome_id:lome mirror id:lome flags:lome extent.e start:lome_extent.e end:stripe count: 1raid0lome id:lome mirror id:lome flags:lome extent.e start:lome_extent.e end:stripe count: 1raid0lome id:lome mirror id:lome flags:lome extent.e start:lome_extent",
        "创建大文件\nnscctj@ln0:~/ost$ dd if=/dev/zero of=1.txt  bs=100M count=4\n4+0 records in\n4+0 records out\n419430400 bytes (419 MB, 400 MiB) copied, 1.08313 s, 387 MB/s\n## 查看stripe信息\nnscctj@ln0:~/ost$ lfs getstripe 1.txt\n1.txt\nlmm_stripe_count:  1\nlmm_stripe_size:   1048576\nlmm_pattern:       raid0\nlmm_layout_gen:    0\nlmm_stripe_offset: 65\nobdidx           objid           objid           group\n65        23108268      0x1609aac                0\n## 尝试设置已有文件的stripe 失败了\nnscctj@ln0:~/ost$ lfs setstripe -c -1 1.txt\nlfs setstripe: setstripe error for '1.txt': stripe already set\n## 创建文件夹\nnscctj@ln0:~/ost$ mkdir ost-1\nnscctj@ln0:~/ost$ cd ost-1\n## 创建文件并查看，是 1个 OST\nnscctj@ln0:~/ost/ost-1$ dd if=/dev/zero of=1.txt bs=100M count=8\n8+0 records in\n8+0 records out\n838860800 bytes (839 MB, 800 MiB) copied, 2.65672 s, 316 MB/s\nnscctj@ln0:~/ost/ost-1$ lfs getstripe 1.txt\n1.txt\nlmm_stripe_count:  1\nlmm_stripe_size:   1048576\nlmm_pattern:       raid0\nlmm_layout_gen:    0\nlmm_stripe"
    ]
}