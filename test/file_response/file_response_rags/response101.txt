{
    "query": "在 Lustre 文件系统中，如何通过标签挂载文件系统并指定故障切换模式？请结合标签挂载原理及failover.mode参数说明操作步骤。",
    "summaries": [
        "Lustre 文件系统名称限制为 8 个字符，文件系统和目标信息被编码到磁盘标签中，便于通过标签挂载，避免 SCSI 设备重新排序问题。标签挂载命令为 `mount -t lustre -L label /mount_point`，但不适用于多路径环境或快照场景。文件系统命名将逐步实现故障安全。启动时需按顺序挂载 MGT、MDT、OST 和客户端。关闭时需按客户端、MDT/MGT、OST 顺序卸载。使用 `/etc/fstab` 配置挂载，建议使用 `noauto` 并由高可用性程序管理。标签可通过 `e2label` 查看，格式化时应使用 `--index` 选项设置标签。注意客户端与 OSS 同节点时可能产生死锁，且不推荐在多路径环境中使用标签挂载。",
        "Lustre 文件系统操作手册摘要：使用 `umount` 命令优雅地关闭 Lustre OST、MDT 或 MGT，保留客户端连接状态。若使用 `-f` 强制标志，将中断连接且不恢复。对于故障切换模式，可通过 `--param=\"failover.mode=failout\"` 设置为 failout 模式，避免等待 OST 恢复。OST 降级时，MDS 不再分配新对象，可通过 `lctl set_param` 标记或恢复 OST 的降级状态。Lustre 支持多个文件系统，需确保 `--fsname` 唯一，挂载时使用对应 MGS 节点和文件系统名称。",
        "高可用性系统通过硬件或软件的备份实现，当主服务故障时自动切换到备用服务，确保应用和资源持续运行。故障切换过程是自动且透明的，通常依赖共享存储设备（如SAN、NAS等），并需在设备级别透明可见。为提高可靠性，推荐使用RAID技术保护存储。Lustre文件系统支持MDT和OST的故障切换配置，包括主动/被动和主动/主动模式，以提升可用性。故障切换功能由HA软件管理，确保资源不被同时访问，避免数据损坏。Lustre本身不提供数据冗余，需依赖存储设备的冗余能力。故障切换还可用于软件升级，避免集群中断。"
    ],
    "contents": [
        "文件系统操作于册 译者:这ay—/dev/sdal on /mnt/test/mdt type lustre (rw)N/dev/sda2 on /mnt/test/ost0O type lustre (rw)ULD192.168.0.21@tcp:/testfs on /mnt/testfs type lustre (rw)在这个例子中，MDT OST (ost0) 和文件系统 (testfs) 挂载成功。—LABEI=testf£s-MDT0000 /mnt/test/mdt lustre defaults, netdev,noauto 0 02 LABEI=testfs-OSTO0000 /mnt/test/ost0 lustre defaults, netdev,noauto 0 0通常，指定 noauto 并让高可用性 CHA) 程序包管理何时装载设备是比较明智的做法。如果您未使用故隐转移机制，请确保在挂载 Lustre 服务年之前已启动网络连接。如果您运行的是 Red Hat Enterprise Linux, SUSE Linux Enterprise Server, Debian 等操作系统〈或其他) ，请使用 这些人磁盘前网络连接已正稍局动。我们在这里通过磁盘标签进行挂载。设备的标签可以用e21abel1读取。如5emkfs. tastre AH xe-- index _— 则了刚刚格式化的 Lustre Ae 4 at HY tx SE BY以FFFF 2556, KRG ARE. IME EEN te OU DIY, ea SE之被更新。建议您始终使用--indqex 选项以确保在格式化时就完成标签设置。注意当客户端和 OSS 位于同一节点时，客户端和 OSS 乙间的内存压力可能导致死锁。注意在多路径环境中请不要使用按标签装载。13.4. 关闭文件系统若按照以下顺序全载所有客户端和服务右，Lustre 文件系统则将完全关闭。注意，凶载一个块设备只会让 Lustre 软件在该节氮上关闭。注意请注意在以下命令中 -a -t lustre 不是文件系统名, 它指代的是印载 /etc/mtab所有条目中的 lustre 类型 。1. Re ira在每个客户端节点上,运行 umount Ae SBA LEASE RSE:umount -a -t lustreDY PEER tit",
        "为 0。我们建议通过一个自动脚本来实现各个 RAID 设备状态的监控，如通过 MD-RAID的maaqm (8) 命令以及--monitot 来标记受影响的设备处于降级状态还是已恢复状态。13.8. 运行多个 Lustre 文件系统在确保NID:fsname 唯一性的情况下，Lustre 可文持多文件系统。每个文件系统在创建时都必须使用 --fsname 参数分配一个唯一的名称。如果只存在单个MGS ，则强制执行文件系统名称唯一性。如果存在多个 MGS 〈如每个 MDS 上都有一个MGS) FH管理员负责确保文件系统名称是唯一的。单个 MGS 和唯一的文件系统名称提供了单一的管理点，即使该文件系统尚未挂载，也可对该文件系统发出命令。Lustre 在单个MGS 上支持多个文件系统。由于只有一个MGS，fsname 保证是唯一的。Lustre 也人允许多个 MGS 共存。例如，不同的 Lustre 软件版本上同时使用了多个文件系统，需要多个 MGS。在这种情况下必须格外小心，以确保文件系统名称是唯一的。在未来可能互操作的所有系统中，每个文件系统都应该有一个唯一的 finame。默认情况下，mkfs .Lustre 命令将创建一个名为 Lustre的文件系统。如须在格式化时指定不同的文件系统名称〈限制为 8 个字符) ，请使用--fsname 选项:1 mkfs.lustre —-fsname=2 file system name注意127\n—234—12345678910111213—Lustre 文件系统操作手册 译者:新文件系统的MDT、OSTs 必须使用相同的文件名 (蔡代设备名)。例如对于新文件系统foo，MDT 和两个OSTS 将被命名为 foo-MDT0000 , foo-OST0000 和foo-OSTO0O001。在文件系统上挂载客户端，运行:client# mount -七 lustremgsnode:/new_fsname/mount point在文件系统foo 的裁入点 mntfoo 上挂载一个客户端，运行:client# mount -t lustre mgsnode:/foo /mnt/foo注意如果客户端要挂载多个文件系统，为避免文件在不同文件系统间移动时出现问题，请在/etc/xattr.conf 文件中增加: lustre.* skip注意为确保新的MDT 已被添加",
        "\"failover.mode=failout\" 选项进行指定:1 oss# mkfs.lustre --fsname=2 fsname --mgsnode=3 mgs NID --param-failover.mode=failout4 --ost --index=5 ost_index6 /dev/ost_ block deviceFE PIRI BHP, FE MGS (mds0) testfs文件系统上为 OSTs 指定了 failout 模式。1 oss# mkfs.lustre --fEsname=testfs --=mgsnode=mds0--paranefailover.mode=failout2 --ost --index=3 /dev/sdb在首次文件系统配置后，请使用 tunefs.1ustre 工具进行模式更改。在下面的例子中，横式被设置为 failout :1 $ tunefs.lustre --param failover.mode=failout2 /dev/ost_device注意在运行该命令前，请僵载所有会被 failover/failout 切换所影响的 OSTs.120\n———Lustre 文件系统操作手册 译者:As大13.7. 处置降级 OST BEER AEDILustre 具备告知功能，可以在当外部 RAID 阵列出现性能下降 〈以致整体文件系统性能下降) 时，及时告知 Lustre 系统。该性能下降通币是由于人役盘发生故障而未被更换，或更换了新磁盘正在重建所造成的。当 OST 处于降级状态时，MDS 将不会为其分配新对象，从而避免因OST 降级引起全局性能下降。每个OST 都有一个 degraded 参数，用于指定 OST 是否在降级模式下运行。将OST 标记为降级，请运行:lctl set Param obdfilter. {OST name} .degraded=1将 OST 恢复正冰模式，请运行:lctl set Param obdfilter. {OST name} .degraded=0WAU GETS OSTs 当前处于降级模式，请运行:lctl get_param obdfilter.* .degraded# OST 因重启或其它状况被重新挂哉，该标志将被重置为 0。我们建议通过一个自动脚本来实现各个 RAID 设备状态的监控，如通过 MD-RAID的maaqm (8) 命令以及--monitot 来标记受影响的设备处于降级状态还是已",
        "译者:As大主动/被动\" 对: 主动贡氮提供资源并提供数据，而被动节点通浓闲置。如果主动TRA ACAI BE, UU BS ORIFICE© “主动/主动\" 对: PNT ATR OKAS, BEM EE TOR. FER生故障的情况下，第二个节点从故障节氮接管资源。如果一个文件系统中只有一个MDT，那么可将两个 MDS 配置为“主动/被动\" 对，而 OSS 可部晋在”主动/主动\" 配置中，这样可以提高 OSS 的可用性且避免额外开销。iW THOL PF, 7 MDS itive MGS ，或者是妖一个 Lustre 文件系统的活动 MDS,此集群中没有区点朵置。如有果一个文件系统中有多个 MDT，则“主动/主动\" 故隐切换配置可用于为共享存储上的 MDT 提供服务的 MDS.3.2. Lustre 文件系统中的故障切换功能Lustre 软件提供的故障切换功能有以下几种场景。当客户端党试对故障 Lustre 目标DT VOM, EAM Sit, BM Lustre 目标的任一已配置的故障切换节氮收到回复。除 VO 操作可能需要更长时间来完成外，用户空间应用程序检 a eit TULLustre SC fF 24250 7 AY He Bit FRE OI PA PC OA Bt FT RO共享一个或多个存储设备。Lustre 文件系统可通过不同配置，提供 MDT OST 故障切换。\"MDT 故障切换: 可为一个MDT 配置两个 MDS 节点，但一次只有一个MDS A为MDT 提供服务。和它允许将两个或更多 MDT 分区放置在存储上，并由两个 MDSHSE Efi) + MDS 故障时，必一个 MDS 为无服务的 MDT 提供服务。这也就是”主动/主动\" 故隐切换对。- OST 故障切换: 可为一个OST 配置多个 OSS 节扣，但一次只有一个 9SS TERAOST 提供服务。可使用 umount/mount 命令在访问同一存储设备的 OSS “i AZ I移动 OST.--Servicenode选项可用在 Lustre 文件系统创建时",
        "，但一次只有一个 9SS TERAOST 提供服务。可使用 umount/mount 命令在访问同一存储设备的 OSS “i AZ I移动 OST.--Servicenode选项可用在 Lustre 文件系统创建时 (mkfs.lustre 命令) 使用。在Lustre 文件系统被激活后，也可以通过使用改选项 〈tunefs.lustre 命令) ，设置故隐转移HJ Ato Lustre 文件系统中的故隐切换功能可用于在连续版本之间升级 Lustre 软件，以避免集群运行的中断。注意Lustre 软件仅在文件系统级别提供故障切换功能。在完整的故障切换解决方案中，系统级组件的故障切换功能〈如布氮故隐检测或电源控制) 必须由第三方工具提供。OST 故障切换功能不能防御磁盘故障造成的损坏。如果用于 OST 的存储介质〈即物理磁盘) 发生故隐，则不能通过 Lustre 软件提供的功能恢复。我们强烈建议在 OST43\nLustre 文件系统操作于册 译痢:As大上使用某种形式的RAID。通贡，Lustre 假设存储是可靠的，所以疫有增加额外的可靠性功能。3.2.1 MDT 故障切换配置 〈主动/被动)如下图所示，通前配置两个 MDS 为“主动/被动\" 故阶切换对。请注意，两个丰氮都必须能够访问 MDT 和 MGS 的共吝存储。主 〈主动) MDS 管理 Lustre 系统元数据资源。当主 MDS Hy Sich, WDA Cia) MDS 将接管这些资源并为MDT 和 MGS 提供服务。注意在具有多个文件系统的环境中，MDS 可配置为准主动/主动配置，每个MDS HH这些 Lustre 文件系统中元数据的一个子集。MDTMDS 1 MLS?Actve for MDT Standby for MDT图 6: MDT_activepassive3.2.2 MDT 故障切换配置 〈主动/主动)MDT 可设置为“主动/主动\" 故障切换配置。故障切换集群由两个MDS 构建，如下图所未。44\nLustre 文件系统操作手册这ayMDTO MDT 1MDSO MDS1Active for MDTO, Active for MDT 1,standby for MDT 1 standby for MDTO图 7: MDT_activeactive3.2.3",
        "时间比例来衡量。可用性通过硬件和 或) 软件的副本来实现。这样，当主服务需发生故障或不可用时，备用服务需将进行切换，以运行应用和相关资源。该故障切换的过程在高可用性系统中是目动的，并在大多数情况下完全透明。一套故隐切换的硬件钱置包括共享资源的一对服务硕 〈通各是共享物理存储设备，可能基于 SAN，NAS，硬件 RAID, SCSI 或光纤通道技术) 。共享存储须在设备级别上透明，相同的LUN 须在两台服务器上可见。为确保物理存储级别的高可用性，推荐使用 RAID 阵列来防御硬盘驱动硕级别的故隐。注意Lustre 软件暂不提供数据元余，它依赖于备用存储设备的元余性。备用 OST 存储应为RAID S，或最好为RAID 6。MDT 存储应为RAID 1或RAID 10。3.1.1 故障切换功能为创建高可用的 Lustre 文件系统，电源管理软件或硬件、高可用性 CHA) 软件提供了以下故障切换功能:“资源屏蔽: 防止两个节点同时访问物理存储。“资源管理: 司动和停止 Lustre 资源、维护集群状态、执行其他资源管理任务。“健康监控: 验证硬件和网络资源的可用性，并响应 Lustre 软件提供的健康指示。这些功能可以由各种软件和《或) 硬件解决方案提供。HA 软件主要负责检剖 LustreFRA eee 1S AOC PPS ll CPt GR. Lustre 软件可与任何合资源 (IO) 屏向功能的 HA 软件配合使用。为完全实现资源屏散，HA 软件必须能够将发生改障的服务需完全关闭，或将其从共享存储设备上断开。寿两个活动节氮同时访问一个存储设备，则数据可能严重损坏。3.1.2 故障切换配置类型集群中的节点可以通过多种方式进行故障切换配置。它们通常成对配置 〈例如连接到共享存储设备的两个OST) ，但也存在其他故障切换配置方式。故障切换配置方式包括:42\nLustre 文件系统操作手册 译者:As大主动/被动\" 对: 主动贡氮提供资源并提供数据，而被动节点通浓闲置。如果主动TRA ACAI BE, UU BS ORIFICE© “主动/主动\" 对:",
        "sdo on /mnt/ostl type lustre (ro)4 /dev/sde on /mnt/ost2 type lustre (ro)56 [root@ossl ~]# umount -a -t lustre7 [155336.491445] Lustre: Failing over testfs-OSTO00028 [155336.556752] Lustre: server umount testfs-OSTO0002 complete13.5. FEAR as LR A tp关闭 lustre OST, MDT 或 MGT, 请运行 umount /mount point 命令。以下是在挂载点 /mnt/ost0 关闭 OST( ost0) testis 文件系统的例子:1 [root@oss1 ~]# umount /mnt/ost02 [ 385.142264] Lustre: Failing over testfs-OSTO0003 [ 385.210810] Lustre: server umount testfs-OSTO000 complete125\nLustre 文件系统操作手册 译者:As大使用 umount 命令是一种优雅地停止服务器的方式，因为它保留了客户端的连接状态。下次司动时，服务锅将重新连接客户端，然后执行恢复过程。如果使用了强制标志 (-£) ，服务器则会中断所有客户端连接并停止恢复。重新启动后，服务器不会进行恢复。任何当前连接的客户端在重新连接之前都会收到 IO 错误。注意如果您使用了 loop 设备，请加上 -d 标志，以安全地清除 loop 设备。13.6. 为 OSTS 指定故障切换模式在 Lustre 文件系统中，由于 OST 故障、网络故障、OST 未挂在等原因而无法访问HY OST 可以通过以下两种方式之一进行处置:。failout 模式: Lustre 客户端在超时后将立即接收到错误消息，而不是一直等待OST 恢复。。 failover 模式: Lustre 将等待 OST 恢复。默认情况下,，Lustre 文件系统在 OSTs FoR A failover 模式. 若您想采用 failout模式，请通过 --param=\"failover.mode=failout\" 选项进行指定:1 oss# mkfs.lustre --fsname=2 fsname --mgsnode=3 mgs NID --param-failover.mode=failout4 --ost --",
        "Lustre 文件系统名称限于 8 个字符。Lustre 已将文件系统和目标的相关信息编码到磁盘标签中，以方便通过标签进行挂载。这使得系统管理员可随意移动磁检，而不用担心出现 SCSI 磁静重新排序，使用钳误的/dev/device 作为共享设备等问题。文件系统命名很快将尽可能做到故障安全。目前，Linux 磁盘标签限于 16 个字符。为识别文件系统中的目标，预留了 8 个字符，其余 8 个字符则为文件系统名称预留 :fsname-MDT0000 或者2 fsname-OST0al9运行以下命令，通过标签进行挂载:122\nLustre 文件系统操作手册 译者:这ay1 mount -t lustre -L2 file system label3 /mount_point下面是通过标签挂载的一个例子:1 mds# mount -t lustre -L testfs-MDT0000 /mnt/mdt注意用标签进行挂载，不应使用在多路径环境中，也不应该使用在设备再创建快照时，为在这些情况下，多个块设备具有相同的标签。尽管文件系统名称被内部限制为 8 个字符，但实际上您可以在任何挂载点挂载客户端，因此文件系统用户并不受限于短名称。例如:1 client# mount -t lustre mds0@tcp0:/short2 /dev/long_mountpoint name13.2. 启动 Lustre第一次局动 Lustre 文件系统时，各组件必须按照以下顺序局动:1. 挂载 MGT。注意如采出现组合的MGITIMDT，Lustre 将目动地正确完成MGT 和 MDT 的挂载。2. 挂载 MDT.注意如果出现多个 MDTS，则将它们全部挂载 (Lustre 2.4 版本中引入)。3. HERE OST(s).4. 挂载客户端.13.3. FESR at启动 Lustre IRS a8 BRE BE ai AB, Rist ats >. Lustre 服务可以加入到/etc/fstabH:1 mount -t lustre得到类似如下输出:123\nLustre 文件系统操作于册 译者:这ay—/dev/sdal on /mnt/test/mdt type lustre (rw)N/dev/sda2 on /mnt/test/ost0O type lustre (",
        "etc/mtab所有条目中的 lustre 类型 。1. Re ira在每个客户端节点上,运行 umount Ae SBA LEASE RSE:umount -a -t lustreDY PEER tit I EI testis 文件系统的例子:1 [root@clientl ~]# mount |grep testfs2 XXX.XXX.0.11@tcp:/testfs on /mnt/testfs type lustre (rw,lazystatfs)4 [root@clientl ~]# umount -a -t lustre5 [154523.177714] Lustre: Unmounted testfs-client124\nLustre 文件系统操作于册 译者:这aX2. tek MDT 和 MGT在MGS 和MDS 节点上，运行 umount 命令:umount -a -t lustre以下是在组合的 MGS/MDS [Filek testis 文件系统的例子:1 [root@mds1 ~]# mount |grep lustre2 /dev/sda on /mnt/mgt type lustre (ro)3 /dev/sdbo on /mnt/mdt type lustre (ro)5 [root@mds1 ~]# umount -a -t lustre6 [155263.566230] Lustre: Failing over testfs-+¥DTO0007 [155263.775355] Lustre: server umount testfs-MDTOO000 complete8 [155269.843862] Lustre: server umount MGS complete对于独立的MGS 和MDS，命令不变，但需要先在 MDS 上运行，随后在 MGS 上运行。3. Haka OSTs在每个0SS 节点上，运行 umount 命令:umount -a -t lustreDXF EIZKOSS 1 ERS at_L AA OSTs 的 testis 文件系统的例子:1 [root@ossl ~]# mount |grep lustre2 /dev/sda on /mnt/ost0O type lustre (ro)3 /dev/sdo on /mnt/ostl type lustre (ro)4 /dev/sde on /mnt/ost2 type lustre (ro)56 [root@ossl ~]# umount"
    ]
}