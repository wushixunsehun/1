{
    "query": "在 Lustre 文件系统中，如何通过参数配置客户端的数据校验机制？请结合校验算法说明。",
    "summaries": [
        "Lustre 文件系统参数可通过多种工具设置和查看。首次格式化文件系统时，使用 `mkfs.lustre` 命令并添加 `--param` 选项设置可调试参数。当服务停止时，使用 `tunefs.lustre` 添加或修改参数，支持附加或清除原有参数。运行时可通过 `lctl` 设置临时或永久参数，其中 `lctl set_param` 用于临时设置，`lctl conf_param` 用于永久设置，并将参数写入配置文件。`lctl list_param` 可列出所有可设置参数，`lctl get_param` 用于报告当前参数值。",
        "Lustre 文件系统需要确保客户端正确执行 SELinux 策略，以保障数据访问的安全性。SELinux 策略信息通过 `getsepol` 命令获取，并在 nodemap 中设置 `sepol` 参数进行检查。若客户端策略不匹配，将被拒绝访问。为持久化配置，需使用 `-P` 选项保存设置。客户端需启用 `send_sepol` 参数以发送策略信息。此外，Lustre 支持 ZFS 快照功能，用于快速恢复文件，快照基于 Copy-On-Write 技术，需在 MGS 上通过 `lctl` 命令管理。快照应挂载在用户可访问节点，便于自主恢复文件。",
        "Lustre 文件系统支持通过扩展名和大小筛选文件，使用 `lfs find` 命令结合 `-z` 选项指定大小范围，如 `+64M` 表示大于 64M，`-64M` 表示小于 64M。同时支持 `!` 表示排除特定条件。Lustre 还提供对外布局（Foreign Layout）功能，允许创建指向 Lustre 命名空间外对象的文件和目录，通过 `lfs setstripe` 和 `lfs getstripe` 管理布局信息。此外，Lustre 使用两种分配算法管理空闲空间，循环分配和加权分配，用户可调整相关参数以优化性能。"
    ],
    "contents": [
        "的扩展名大小。文件中符合给定扩展大小的所有组件，都会被打印出来。 + 和 \"号可以指定最小和了节大的大小。增加了一个新的扩展组件标志。上只有人至少有一个 SEL 组件的文件才会被打印出来。注意负号搜索标志表示搜索的是有非 SEL 成分的文件〈不包括没有 SEL 成分的文件)。示例1 # lfs setstripe --extensiomsize 64M -c 1 -E -1 /mnt/lustre/file23 # lfs find --comp-flags extension /mnt/lustre/*4 /mnt/lustre/file56 # lfs find ! --comp-flags extension /mnt/lustre/*235\nLustre 文件系统操作手册 译者:这ay7 /mnt/lustre/file89 # lfs find -z 64M /mnt/lustre/*10 /mnt/lustre/file12 # lfs find -z +64M /mnt/lustre/*14 # lfs find -z -64M /mnt/lustre/*16 # lfs find -z +63M /mnt/lustre/*17 /mnt/lustre/file1819 # lfs find -z -65M /mnt/lustre/*20 /mnt/lustre/file2122 # lfs find -z 65M /mnt/lustre/*2324 # lfs find ! -z 64M /mnt/lustre/*2526 # lfs find ! -z +64M /mnt/lustre/*27 /mnt/lustre/file2829 # lfs find ! -z -64M /mnt/lustre/*30 /mnt/lustre/file3132 # lfs find ! -z +63M /mnt/lustre/*3334 # lfs find ! -z -65M /mnt/lustre/*3536 # lfs find ! -z 65M /mnt/lustre/*37 /mnt/lustre/file19.7. 对外布局Lustre 对外布局 (Foreign Layout) 功能是LOV #",
        "快照应挂载在用尸可访问的节反上《如登录和氮) ，以便用户在无需管理员干预的情况下恢复文件〈在意外删除或绑盖之后) 。用户访问时，可以目动挂载快照文件系统而不是挂载所有快照，从而降低登录和氮的开销〈当快照不在使用中)。从快照恢复丢失的文件通前比从任何脱机各份或远程副本进行恢复要快得多。请注意，快照并不会提高存储可靠性。与其他任何存储阵列一样，快照无法防御硬件故障。31.1.1. 需求所有 Lustre 服务囊目标必须是运行 Lustre 2.10 或更高版本的 ZFS 文件系统。此外，MGS 必须能够通过 ssh 或其他远程访问协议与所有服务兰进行通信，无需密码验证。该功能默认为后用状态，且不能蔡用。人快照的管理通过 MGS 上的1ct1命令完成。Lustre 快照基于 Copy-On-Write，快照和文件系统在文件系统上的文件发生更改前可能共享数据的同一副本。直到引用这些文件的快照被删除，存放已删除或已政盖文件的空间才会被释放。文件系统管理员需要根据系统的实际大小和使用情况建立快照的创建、备份、删除策略。330\n———BR Wo NO 一Nn—N3iLustre 文件系统操作手册对者 :这ay31.2. 配置快照工具从 MGS EFY/etc/ldev. cont 文件载入系统配置，调用相关 ZFS 命令来维护所有目标 (MGS/MDT/OST) 的 Lustre 快照。请注意，/etc/1Ldqev.conf 文件还有其他用途。文件的格式为:<host> foreign/- <label> <device [journal-path]/- [raidtab]的格式为:fsname-<role><index or <role<index>的格式为:[Imqlzfs:] [pool dir/]<pool>/<filesysten>快照只使用域、和。示例如下 :mgs# cat /etc/ldev.confhost-mdt1 - myfs-MDTO000 zfs: /tmp/myfs—mdt1/mdt1host-mdt2 - myfs-MDTO001 zfs:myfs-mdt2/mdt2host-ostl - OSTOO000 zfs:/tmp/myfs-ostl1/",
        "参数将映射#/proc/{fs,sys}/{linet, LIusttre}中的条目。lctl set param 命令使用以下语法:lctl Set Param -Pobdtype.obdname.proc file name=value如:# lctl set param -P osc.*.max dirty mb=1024osc.myth-OST0000-osc.max dirty mb=32osc.myth-OST0001-osc.max dirty mb=32osc.myth-OST0002-osc.max dirty mb=32132\nNn—234———ULD——Lustre 文件系统操作手册 译者:这ayosc.myth-OST0003-osc.max dirty mb=32osc.myth-OST0004-osc.max dirty mb=32用 -d (只市 -P) 删除永久参数，语法为:lctl Set Param -P -dobdtype.obdname.proc file name如:# Ictl set param -P -d osc.*.max dirty mb13.11.3.4，列出当前参数 列出所有 Lustre 或 LNet 可设置参数，运行 lct1llist param 命令:lctl list param [-FR]obdtype.obdname以下参数可用于 lctl list param 命令:-F, APPLE 8@ ,=' 分别用于表示目录，符号链接，可写文件。-R ，递归方式列出某路径下的所有文件。On:oss# lctl list param obdfilter.lustre-OST000013.11.3.5. 报告当前参数值 FA lctl get param 命令报告当前 Lustre 参数值的语法为:lcetl get param [-n]obdtype.obdname.proc file name以下示例显示了 RPC 持续服务时间 :oss# lctl get Param -n ost.*.ost_io.timeoutsservice : cur 1 worst 30 (at 1257150393, 85d23h58m54s ago) 1111以下示例报告了在该客户端上每个 OST 用于写回绥存的预留空间 :client# lctl get param osc.*.cur Grant Dytesosc.myth-OST0000-osc-ff£ff£8800376bdc00.cur_ grant bytes=2097152133\n—",
        "上执行适当的 SELinux策略 〈由 Linux 发行版提供) 。Lustre 服务锅上不需要 SELinux 策略。因为 Lustre 是一个分布式文件系统，所以使用MLS 的特殊性在于，Lustre 确实需要确保数据总是被节点访问，并正确执行 SELinux MLS 策略。否则，数据就无法得到保Po IAC Lustre 必须检查 SELinux 是人否在客户端正确执行了 SELinux 策略， 有正确的、未被修改的策略。而如果 SELinux 在客户端没有按预期执行该策略，服务器拒绝其访问 Lustre。30.4.1. 确定 SELinux 策略信息服务需使用一个代表 SELinux 状态信息的字符溃作参考，以检查客户端是否正确地执行 SELinux 策略。这个参考字符串可以通过在已知执行正确的 SELinux 策略的客户端节点上调用1_ getsepol命令行工具获得。1 client# 1 getsepol2 SELinux status info:1:mls:31:40afb76d077c441b69af58cccaaa2cab6364led6e21b0a887dc21a684F508b78£F描述 SELinux 策略的字符串的语法如下。1 mode:name:version:hash348\nLustre 文件系统操作手册其中 :。 mode 表示一个数字,告诉 SELinux 是在 Permissive 模式 (0) 还是强制模式 (1) 下执行。。 name 表示 SELinux 策略的名称。。 version 表示 SELinux 策略的版本。“hash 表示计算出的策略的二进制表示的哈而值，M/etc/selinux/name/policy/policy/policy. version中导出。30.4.2. 执行SELinux 策略检查可以通过在 nodemap 条目上设置 sepol 参数来执行 SELinux 策略检查。所有属于这个 nodemap 条目的客户端必须执行该参数摘述的 SELinux 策略，和否则将被拒绝访|Lustre 文件系统。例如:局—mgs# lctl nodemap set sepol --name restricted2 -—-sepol\"1 :mls:31: 40afb76d077c441b69af58cccaaa2ca63641led6e21b0a887dc21a684f£508b78 Ff\"it, 所 ”有 pt fidrestricted nodemap AY Beig 必须执行 SELinux 策 略， 该 策 略 的 描 述 匹fid1:mls:31:40afb76d077c441b69af58ccca2cab6364led6e21b0a887dc21ab684F508b78F.如果不匹配，当试图挂载或访问 Lustre 文件系统上的",
        "节点上的临时参数。这些参数将映射至/proc/{ffsvsys}/{lnet, LIustre}l。语法如下:lctl Set Param [-n] [-P]obdtype.obdname.proc file name=value如:# lctl set param osc.x .max dirty mb=1024osc.myth-OST0000-osc.max dirty mb=32osc.myth-OST0001-osc.max dirty mb=32osc.myth-OST0002-osc.max dirty mb=32131\nNn—234——ULDNn—ULDLustre 文件系统操作手册 译者:这ayosc.myth-OST0003-osc.max dirty mb=32osc.myth-OST0004-osc.max dirty mb=3213.11.3.2. 设置永久参数 Ictl conf param 用于设置永久参数。一般来说，1Lct1conf param 可用于设置 /proc/fs/lustre 文件中所有可设置参数，话法如下 :obdname|fsname.obdtype.proc file name=value)以下是 lctl conf param 命令的一些示例:mgs# lctl conf param testfs-MDT0000.sys.timeout=40$ lctl conf param testfis-MDT0000.mdt.identity upcall=NONE$ lctl conf param testfs.llite.max read_ahead_mb=16$ lctl conf param testfs-MDT0000.lov.stripesize=2M$ lctl conf param testfs-OST0000.osc.max dirty mb=29.15$ lctl conf param testfs-OST0000.ost.client cache _seconds=15$ lctl conf param testfs.sys.timeout=40注意通过1ct1 conf_param 售令设置的参数是永久性的，它们被写入了位于 MGS 的文件系统配置文件中。13.11.3.3. 用 Ictl set param -P 设置永久参数 Kis > 4 Mm 7 MGS 上的行。通过lct1l upcal1在每个主机上设置给定参数。这些参数将映射#/proc/{fs,sys}/{linet, LIusttre}中的条目。lctl set param 命令使用以下语法:lctl Set Param -Pobdtype.obdname.proc file name",
        "AY Beig 必须执行 SELinux 策 略， 该 策 略 的 描 述 匹fid1:mls:31:40afb76d077c441b69af58ccca2cab6364led6e21b0a887dc21ab684F508b78F.如果不匹配，当试图挂载或访问 Lustre 文件系统上的文件时，会得到PermissionDenied的提示。要删除sepo1参数，只需将其设置为空字符串即可。—mgs# lctl nodemap set sepol --name restricted --sepol ''30.4.3. 持久化 SELinux 策略检查为了持久化 SELinux 策略检查，必须使用LIct1 set param的-P选项来设置nodemap 上的sepo1人参数。—mgs# lctl set paramnodemap. restricted. sepol=1 :mls:31:40afb76d077c441b69af58cccaaa2ca63 641led6e21b0a887dc21a682 mgs# lctl set param -Pnodemap. restricted. sepol=1 :mls:31:40afb76d077c441b69af58cccaaa2ca63 641led6e21b0a887dc21a68这样，sepo1参数将被存储在 Lustre PCA, Gea ete ae a aR BUA349\nLustre 文件系统操作手册 译者:As大30.4.4. 客户端发送 SELinux 状态信息为了让 Lustre 客户端能够发送 SELinux 状态信息，在本地司用 SELinux,send_sepol ptirpc 内核模块的参数必须设置为非零。senq_sepol可以设置为以下值:。 0: 不发送 SELinux 策略信息。。-1: 每次请求都会获取 SELinux 策略信息。“N>0: 每隔 N 秒只获取 SELinux 策略信息。设置N=2 31-1 则只在挂载时获取SELinux 策略信息。在定义了sepol AY nodemap 中的客户端必须发送 SELinux 状态信息。而且他们执47 HY SELinux 策略必须与存储在 nodemap 中的策略相匹配。否则它们将被拒绝访问Lustre 文件系统。第三十一章 Lustre ZFS 快照31.1. 概述快照能够快速从先前创建的检查点恢复文件，而无需借助脱机符份或远程副本。快照还提供了存储的版本控制，用于恢复丢失的文件或乙前不同版本的文件。文件系统快照应挂载在用尸可访问的节反上《如登录和氮) ，以便用户在无需管理员干预的情况下恢复文件〈在意外删除或绑盖之后) 。用户访问时，可以目动挂载快照文件系统",
        "*3536 # lfs find ! -z 65M /mnt/lustre/*37 /mnt/lustre/file19.7. 对外布局Lustre 对外布局 (Foreign Layout) 功能是LOV #4] LMV 格式的扩展，和它人允许创建具有必要规格的空文件和目录，指癌 Lustre 命名空间以外的相应对象。230\n—NO&—NOLustre 文件系统操作手册新的LOVLMY 对外内部格式可以表示为:anaN这图 22: LOV/LMV foreign format图: LOV/LMV 对外布局19.7.1. lfs set[diz]striPelfs set[dir] stripe命令用于创建具有对外布局的文件或目录，通过调用相应的API，调用目身相应的 ioctlO。19.7.1.1. 创建对外文件/目录 “命令lfs set[dir]stripe \\--foreign[=<foreign type] --xattr|-x <layout string \\[--flags <hex bitmask>] [--mode <mode bits] \\{file,dir}name--foreign 和--xattz|1-x选项都是强制性的。<foreign_ type> d4〈默认信为”none\"，表示没有特殊行为)，而--flags和--modqe〈默认值为0666) 选项都是可选的。示例下面的命令创建一个“none\" 类型的对外文件，并这有 foo@bar\"LOV 内容和特定的模式和标志:# lfs setstripe --foreign=none --flags=0xda08 --mode=0640 \\--xattr=foo@bar /mnt/lustre/file图 23: Example: create a foreign file图: 创建对外文件19.7.2. lfs get[dir]stripelfs get[dir] stzipe命令可以用来检索对外的 LOV/MV 信息和内容。命令237ay\nLustre 文件系统操作手册 译者:这ay1 lfs get[dir]stripe [-v] filename列出对外的布局信息假设我们已经有了一个对外文件 名aptiustreMje，通过以下命令创建:1 # lfs setstripe --foreign=none --flags=O0xda08 --mode=0640 \\2 --xattr=foo@",
        "inodesyblock。13.11. 设置及查看 Lustre 参数以下选项可用于在 Lustre 中设置参数:。创建文件系统，请使用 mkfs.lustre。© 当服务吉停止运行时，请使用 tunefs.lustre。。当文件系统正在运行时，可用lcd来设置或奋看 Lustre 参数。13.11.1. 用mkfs . Lustre设置可调试参数当文件系统第一次进行格式化时，参数可通过在mkfs.lustre 命令中添加--param 选项进行设置，如:130\n—————ULDNn—ULDLustre 文件系统操作手册%ty这aymds# mkfs.lustre --mdt --param=\"sys.timeout=50\" /dev/sda13.11.2. 用tunefs .Lustre设置参数“AK at (OSS 或 MDS) 停止运行时，可通过 tunefs.lustre 命令及 --Param选项添加参数至现有文件系统，如:oss# tunefs.lustre --paran=-failover.node=192.168.0.13@tcp0 /dev/sdatunefs.lustre 命令诬加的为附加参数，即在已有参数的基础上诡加新的参数，而不是蔡代它们。探除所有的已有参数并使用新的参数，运行:mds# tunefs.lustre --erase-params --param=new parameterstunefs .Lustre可用于设置任何在 /proc/fs/lustre 文件中可设置的具有 OBD 设备的参数，可指定为 obdname|fsname. obdtype.proc file name= value。如:mds# tunefs.lustre --param mdt.identity upcall=NONE /dev/sdal13.11.3. 用 Lct1设置参数当文件系统运行时，1lctl 可用于设置参数 (临时或永久) 或报告当前参数值。临时参数在服务僚或客尸端未关闭时处于激活状态，永和久参数在服务胡和客户端重司后仍不注意Lotl list_param 可列出所有可设置参数。13.11.3.1. 设置临时参数 1ctl set_param 用于设置在当前运行节点上的临时参数。这些参数将映射至/proc/{ffsvsys}/{lnet, LIustre}l。语法如下:lctl Set Param [-n] [-P]obdtype.obdname.proc",
        "布局信息假设我们已经有了一个对外文件 名aptiustreMje，通过以下命令创建:1 # lfs setstripe --foreign=none --flags=O0xda08 --mode=0640 \\2 --xattr=foo@bar /mnt/lustre/file可以用下面的命令列出完整的对外布局信息:1 # lfs getstripe -v /mnt/lustre/file2 /mnt/lustre/file3 lfm magic: OxOBD7OBDO4 lfm length: 75 lfm type: none6 lfm flags: OxOOQOQO0ODA087 lfm value: foobar注如上所示，1Lfm_lIength字段的值是可变长度1fm_value字段中的字符数。19.7.3. lfs findlfs findq命令可以用来搜索所有的对外文件/目录或指定的对外文件/目录。1 lfs find2 [[!] --foreign[=<foreign_ type]Hay f--foreign[=<foreign_type>]i@Il, ，用于检索指定所有 [BH 4a eG定] 具有对外布局的文件和/或目录。示例1 # lfs setstripe --foreign=none --xattr=foo@bar /mnt/lustre/file2 # touch /mnt/lustre/file24 # lfs find --foreign /mnt/lustre/*5 /mnt/lustre/file7 # lfs find ! --foreign /mnt/lustre/*8 /mnt/lustre/file2910 # lfs find --foreign=none /mnt/lustre/*11 /mnt/lustre/file238\nLustre 文件系统操作手册 译者:As大19.8. 管理空闲空间为了优化文件系统性能，MDT 根据两种分配算法将文件分配给 OST。循环分本法CICS EDL. CHR iT aT ACE eT OSS 以提高网络带宽利用率) ，加权分配法优先考虑可用空间〈平衡OST 间的负载)。用户可以调整这两种算法的靖值和加权因子。MDT 为每个OST 预留总 OST 空间的 0.1%和 32 个 inode。如果可用空间小于该预留空间或空闲inode 少于32 “+, MDT 会停止为该 OST 分配对象。当"
    ]
}