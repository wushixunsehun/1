{
    "query": "当Lustre存储系统中某个ost节点报“raid卡timeout故障”时，值班人员应如何处理？需注意哪些特殊情况？",
    "summaries": [
        "在Lustre文件系统中，使用RAID设备时需注意以下几点：避免使用带有板载缓存的PCI适配卡，以免在HA故障转移时导致数据不一致；格式化RAID设备时，应确保IO请求与底层RAID匹配，以提升性能；对于RAID 5、6或1+0，需指定参数优化元数据布局；计算stripe width时，应使条带宽度匹配IO大小，避免“读-修改-写”操作。此外，建议将OST日志放在单独设备上，使用RAID 1阵列，并确保内存足够存储日志副本。连接SAN至Lustre时需考虑扩展性、成本及安全风险，直接访问存储可能带来安全隐患。网络端口绑定为可选配置。",
        "本文档介绍了Lustre文件系统的超时设置、LNet监控以及OST空间分配机制。Lustre超时确保RPC故障时在有限时间内完成，自适应超时默认启用，可通过设置at_max=0禁用。LND超时可调整以避免假性超时，增加LNet节点数量或调整超时参数有助于减少背压。LNet监控通过/proc/sys/lnet下的文件进行，包括peers和nis等信息，用于查看网络状态和信用值。OST空间分配根据可用空间的平衡情况选择循环或加权方式，可通过参数调整分配策略。",
        "Lustre 文件系统可能出现多种错误，如“received cancel for unknown lock cookie”和“went back in time”，通常与网络配置或磁盘缓存问题有关。当磁盘缓存未正确提交数据时，可能导致数据丢失或恢复失败。故障切换时若共享存储不一致，也会引发错误。多客户端使用 O_APPEND 写入文件存在锁竞争和性能问题。启动时因读取元数据可能导致延迟，但随着缓存增加会改善。内存不足、SCSI 队列大小过小等也会影响性能。在备份 ldiskfs 文件系统时，日志功能可保持一致性，但硬件故障仍需运行 e2fsck 恢复。"
    ],
    "contents": [
        ") 映射到本地主机 (127.0.0.1) 而不是正确的 IP 地址。这可能会产生这个错误:LustreError: (ldlm handle cancel()) received cancel for unknown lock cookieOxe74021a4b41b954e from nid Ox7f000001 (0:127.0.0.1)35.3.9. Ab#H\"LustreError: xxx went back in time\" 错误MDS 8k OSS 每次为客户机修改MDT 或 OST 磁盘文件系统的状态时，它都会为每个目标记录一个递增的操作交易编号，并将其与该操作的响应一起返回给客户机。当服务锅将这些事务提交到磁盘上时，会定期将 last_committed 事务编号返回给客户机，使其能够从内存中丢弃待处理的操作，因为在服务器故障时不再需要恢复这些操作。在某些情况下，在服务器被重启或故障后，会出现类似以下错误信息:LustreError: 3769:0: (amport.c:517:ptlrpc_ connect interpret () )testfs-ost12 UUID went back in time (transno 831 was previously committed,428\nLustre 文件系统操作手册 译者:这ay3 server now claims 791)!出现这种情况的原因是:\"您正在使用在数据写入实际执行前就声称有数据写入的人磁盘设备〈如具有大绥存的设备) 。如果该磁盘设备的故障或断电导致缓存丢失，那么您认为已完成的约定交易也将丢失。这非常严重，您应该在重新局动 Lustre 文件系统之前对该存储运47 e2fsck.。 根据 Lustre 软件的要求，用于故障切换的共享存储是缓存一致的。这确保了如采合服务硕接管另一合服务锅，它可以看到最新的准确数据副本。当服务需进行故障切换时，如果共享存储未提供所有端口之间的缓存一致性，则 Lustre 软件可能会产生错误。如果您知道错误的确切原因，则无需采取进一步行动。如有果您不知道，请与您的磁盘供应商进行深入探讨。如果错误发生在故障转移期间，请检查您的磁盘缓存设置。如果错误发生在未进行故障切换的重启后，请尝试如何能让磁盘写入成功，然后解雇数据",
        "需要昂贵的\" 读 -修改 -写\" 流程。以下为计算 stripe_width 的公式:stripe width blocks = chunk blocks* number of data disk= 1 MB,61\nLustre 文件系统操作手册 译者:As大其中 number of data _ disk 不包括 RAID 奇偶校验人磁盘 〈对RAID S，有一个奇偶校验人磁盘,，对RAID 6则是两个)。如有果RAID 配置不允许 chunk_blocks 恰好匹配 1 MB, lll选择接近 IMB (而不是更大) 的stripe width blocks.stripe width blocksh} {Hh WW 须 等 于chunk blocks *number of data disks) (4. {% #£ ff AA RAID 5 BK RAID 6 时 Wi 48xEstripe width blocks#X, RAID1+0 则不需要。在文件系统设备 (/dev/sde) 上运行 -reformat，为底层 ldiskfs 文件系统将指定 RAID配置。--mkfsoptions \"other _ options -E stride=chunk blocks, stripe width=stripe width block\"例如，如采一个合 6 个磁盘的RAID 6，配置有4个数据和 2 个奇偶校验磁斑，那么 chunk blocks <= 1024KB/4 = 256KB。由于数据磁盘的数量为 2 的指数，条带宽度恰好为1MB。6.4.2 外部日志的参数设置如果您已经配置了 RAID 阵列并直接使用它作为 0ST，则其中包换了数据和元数据。为了获得更好的性能，我们建议将 OST 日志放在一个单独的设备上上，创建一个小型RAID 1 阵列，并将其作为 OST 的外部日志。在一般的 Lustre S/F ASH, DUA OST 日志最大为 1GB，默认的 MDT 日志大小最大为4GB ，以处理高频率事务而不阻赛日志刷新。此外，因日志在 RAM 中有副本，须确保有足够的内存来保存所有日志副本。文件系统日志选项为 mkfs.lustre，使用 --mkfsoptions",
        "，请与您的磁盘供应商进行深入探讨。如果错误发生在故障转移期间，请检查您的磁盘缓存设置。如果错误发生在未进行故障切换的重启后，请尝试如何能让磁盘写入成功，然后解雇数据设备损坏问题或磁盘错误。35.3.10. Lustre 错误: \"Slow Start Page Write\"当操作花很长的时间分配一批内存页时，会出现slow start_pPage_write消县。请驳使用这些内存页接收网络通信，然后再用于写入们盘。35.3.11. 多客户端O_APPEND 写入的劣势多客户端通过oO_APPEND写入单个文件是可能的，但存在很多缺点，使它成为次优解决方案。。每个客户端都需要对所有 OST 进行BOF 锁定。这是由于在检查所有 OST 之前，很难知道哪个 OST 保存了文件的结尾。所有的客户端都使用同一个O_APPEND，因此存在很大的锁定开销。。 第二个客户端在第一个客户端完成写入之前不能获取所有锁，客户端只能顺序写入。”为避免死锁，它们以已知的一致顺序获取锁。对于条融化文件来说，客户端在狂取所有 OSTsS 的锁前无法知道哪个 OST 持有文件的下一部分。35.3.12. Lustre 文件系统启动时的减速当 Lustre 文件系统司动时，它需要从磁盘读入数据。重司后运行的第一个 mdsrate，MDS 需要等街所有 OST 完成对象预创建，这将导致文件系统司动时的减速429\n12Lustre 文件系统操作手册 译者:As大文件系统运行一段时间后，绥存中将包含更多的数据，从磁盘读取关键元数据引起的可变性将大大地消除。文件系统现在从绥存中读取数据。35.3.13. OST 上的日志信息\"Out of Memory\"规划 OSS 贡点硬件时，请把 Lustre 文件系统中多个组件的内存使用情况列入考感。WRATFAVE, \"out of memory\" 消妃将被记录。在正半操作期间，以下几种状况表明服务融节扣内存不足:。 内核\"out of memory\" 和/或\"room-killer\" 消息。 Lustre\"kmalloc of 'mmm' (NNNN bytes) failed...\" JHA。 Lustre BK AY SERIA NUERE RE\"try to",
        "为\"stale\"。Lustre 客户端定期癌指定的时间段内没有通信的服务需发送\"ping\"消县。文件系统中客户端和服务人逢之间的任何网络话动和 ping 的效用相同。服务如等竺客户端回复初始 AST〈锁取消请求) 的时间。对于OST，默认值为 20 秒;) 对于MDS，默认值为 6 秒。如果客户端回复 AST，服务货将给它一个正明的超时《客户问超时时间的一半)来刷新任何脏数据并释放锁。内部调试故阶钩。软认值为 0，表示不会触发或注入任何故隐。超时时触发 Lustre 调试日志的转储。歌认信为 0，表示不会触发Lustre 调试日志的转储。发生驱和逐时触发 Lustre 调试日志的转储。默认值 0，表示不会触发 Lustre 调试日志的转储。LNet 信息位于/proc/sysy/lnet 的以下文件中:303\nLustre 文件系统操作手册详这ay- peers - 显示此和氮已知的所有 NID ，并提供有关队列状态的信息。示例:1 # lctl get param peers2 nid refs state max rtr min tx min queue3 O@1Lo 1 ~rtr 0 0 0 0 0 04 192.168.10.35@tcp 1 ~rtr 8 8 8 8 6 05 192.168.10.36@tcp 1 ~rtr 8 8 8 8 6 06 192.168.10.37@tcp 1 ~rtr 8 8 8 8 6 0表中各条目含义如下 :KA 说明refs 引用计数。state 如果和点是路由器，则表示路由融的状态。对应值有: NA 一表示和点不是Bt airs up/down—fR NW Gitar) 是否为局动状态。max 此对等节点的最大并发发送数。ctr 路由缓冲区信用值。min 历史最低路由缓训区信用值。tx 发送信用值。queue 活动/排队中的发送总字布数。信用值被初始化以允许一定数量的操作〈如上方示例所示，max列为8)。LNet 跟踪了监控时间段内看到的最低信用值，以显示此时间段",
        "4GB ，以处理高频率事务而不阻赛日志刷新。此外，因日志在 RAM 中有副本，须确保有足够的内存来保存所有日志副本。文件系统日志选项为 mkfs.lustre，使用 --mkfsoptions 参数。例如:--mkfsoptions \"other options -j -J device=/dev/mdJ\"创建一个外部日志，请在 OSS 上的每个 OST FAT LA FLERE:1. 创建一个 400 MB (或更大) 的日志分区 (建议使用RAID 1，在本例中，/dev/sdb 是RAID 1 设备)。2. 在分区上创建一个日志设备。运行:[oss#] mke2fs - b 4096 -O journal dev /dev/sdb journal size日志大小以 4096 FERAL. YH, IGB 的日志大小为 2602144。3. 创建 OST。在本例中，被用作 OST 的 /dev/sde 是RAID 6 设备，运行:[oss #] mkfs.lustre --ost... \\--—mkfsoptions =\"-J device=/dev/sdb1\" /dev/sdc4. 正常装入 OST.02\nLustre 文件系统操作手册这ay6.5. 连接 SAN 至 Lustre 文件系统根据您的集群规模和工作负载情况，您可能希望通过 SAN 连接至 Lustre 文件系统。在连接之前，请孝感以下因素:。在许多 SAN 文件系统中，客户端在更新时，会单独分配块或 node，并将之锁定。Lustre 文件系统的设计避免了这种在块和 inode 上的高度竞争。。Lustre 文件系统具有高度可扩展性，可拥有非常多的客户端。SAN 交换机无法扩FES, Tn SAN 的平均端口成本通肖比其他网络要高。。 FRIES Pain LA direct-to-SAN 方式接入的文件系统存在安全风险，这是因为客户端能够读 SAN 磁盘上的任何数据，行为不端的客户端可通过多种方式破坏文件系统，如不佳的文件系统、网络或其他内核软件，粳糕的布线，损坏的内存等等。风险伴随直接访问存储的客户端数量的增加而成倍增加。第七章网络端口绑定设置注意网络痛口绑定为可选",
        "。queue 活动/排队中的发送总字布数。信用值被初始化以允许一定数量的操作〈如上方示例所示，max列为8)。LNet 跟踪了监控时间段内看到的最低信用值，以显示此时间段内的高峰拥挤。低的信用值表示资源更加拥挤。当前处理中的信用值 〈传输信用值) 显示在tx列中。可用的最大发送信用祝显示在max中，且永远不会发生变化。可供对等下氮使用的路由天缓冲区数量显示在ztt列中。因此，Ftz -七x是处理中的传输数目。尽管可以设置使nax>=ztz，通各情况下，rtr == max。路由绥补信用与发送信用之比 (rtz/x) 如果小于max表示操作正在进行中;如果大于max，则表示操作被阻止。LNet 还限制了并发发送和分配给单个对等节点的路由硕缓冲区数量，从而避免对等节氮占用所有资源。\"nis 一显示该站扣上队列当前健康状况。504\n这ayLustre 文件系统操作手册 译者:示例:# ctl get param nis nid refs peer maxtx min O@lo 3 0 0 0 0192.168.10.34@tcp 4 8 256 256 252表中条目的含义如下:条目 说明nid 网络接口。refs ， 内部引用数。peer ”此NID 上氮对点的发送信用数，用于调整缓冲池的大小。max 此 NID 的最大发送信用值。tx 此NID 当前可用的发送信用值。min 此NID 当前可用的最低信用值queue 活动/排队中的发送总字数。分析:(max - tx) 为当前活动的发送数量。活动发送量很大或越来越多则表示可能存在问题。39.7. 在 OST 上分配空闲空间可用空间分配使用循环法还是加权法，由OST 之间可用空间的不平衡状况决定。OST 之间的可用空间相对平衡时，使用更快的循环分配务。任何两个 OST 的可用空间兰别超过指定国值时，使用加权分配需可 以使用 以下两个可调参数调玫可用上 x间分布:。 lod.*.gos_threshold_rr 一在此文件中设置",
        "和/或\"room-killer\" 消息。 Lustre\"kmalloc of 'mmm' (NNNN bytes) failed...\" JHA。 Lustre BK AY SERIA NUERE RE\"try to free pages\" WA35.3.14. EE SCSI VO 大小某些 SCSI SK aIRE PERAK VO 大小对于高性能的 Lustre 文件系统而言仍然过小。我们已经调整了不少驱动程序，但您仍然可能会发现某些驱动程序使用 Lustre 文件系统时性能不理想。由于默认值是硬编码的，您需要重新编译驱动程序来更改默认值。另外，一些驱动程序的默认设置可能是错误的。如果您察觉到IO PE AB RZ, HL Lustre 文件系统统计信息的分析表明其IO 不是1MB，请检查 /sys/block/device/queue/max sectors kb。如果max_sectors _kb值小于 1024，请将其设置为 1024 或更大，从而提高性能。如果更改max_sectors kb值没有改变 Lustre IO 大小，您可能需要检查 SCSI 驱动程序AF第三十六章故障恢复36.1. 在备份 ldiskfs 文件系统上恢复错误或损坏OSS, MDS 或MGS 服务句裔省时, 无需在文件系统上运行e2fck，ldiskfs journaling会确保文件系统在系统崩溃时仍保持一致。客户端不直接访问 ldiskfs 文件系统，因此客户端朋溃与服务吉文件系统一致性无关。只有当有事件导致了 ldiskfs journaling 无法处理的问题时 〈如硬件设备故障或IO错误) ，才需要在设备上运行 e28ck。如果 ldiskfs 内核代码检测到磁盘损坏，它会将文件系统挂载为只读，以防止进一步损坏，但仍允许该设备的读取访问。这在服务器的系统日志中显示为\"-30\" (EROFS) 错误，例如:Dec 29 14:11:32 mookie kernel: LDISKFS-fs error (device sdz):ldiskfs_ lookup: unlinked inode 5384166 in dir #145170469430\nLustre 文件系统操作手册 译者:这ay3 Dec 29 14:11:32 mookie kernel: Remounting filesystem readonly在这种情况下，通常只需要在损坏设备上运行 e2fick，然后再重新启动设备。在",
        "阵列中才文持)，否则阵列的电源中断可能会导致无序写入或写丢失，或者奇偶校验损坏或元数据损坏，从而导致数据丢失。MDS 或 0SS ace hy) PCI 适配夯卡上如宁有板载读或写回缓存，那么在高可用人性(HA) 故障转移配置中是不安全的，因为这将导致节氮之间的不一致，可能立即或最终损坏文件系统。不应使用此类设备，或应条用板载缓存。如有果司用了回写绥存，则需要在阵列断电后进行文件系统检查。这也可能导致数据ERAU, Sm SCTE BY, FTE DOE Se EAE Ge, Ble 28 DBS(FAB StF BAK TE6.4. Idiskfs RAID 设备的格式化选项当在 RAID 设备上格式化 ldiskfs 文件系统时，确保 IO 请求与底层 RAID 匹配是有好处的。这避免了 Lustre 的 RPC 产生不必要的和磁静操作，从而大大降低性能。在格式化OST或MDT时，可使用--mkfsoptions 参数以指定额外的参数项。对于RAID 5, RAID 6或RAID 1+0 存储，在 --mkfsoptions 下指定以下参数可改进文件系统元数据的布局，确保不是所有的分配位图都存储在单一的磁盘上:-E stride = chunk blockschunk_blocks 变量以 4096 字市块为单位,含义是在移动到下一个磁盘前，写入到单个磁盘的连续数据量。它同时也被叫做 RAID 条带大小。它适用于MDT 和 OST 上的文件系统。6.4.1 计算 mkfs 的文件系统参数为了获得最好的性能，建议使用含 5 个或 9 个磁盘的RAID 5 或合 6 个或 10 个磁盘的RAID 6，每个磁盘上都有一个不同的控制荐。条带宽度应为最佳的最小IO 大小。理想情况下，RAID 配置应使得 IMB 的 Lustre RPC 可正巧匹配甲个RAID 条带，而不需要昂贵的\" 读 -修改 -写\" 流程。以下为计算 stripe_width 的公式:stripe width blocks = chunk blocks* number of data disk= 1",
        "新开) 时在有限时间内乞成。每个 LND 有单独的 LND 超时参数设置。设置S_LND标志记录 LND thy. ETA eI ATT EAS, tea Lustre 日志中的D_NETERROR消轧，或使用以下命令将D_NETERROR消妃打印到控制人台 :lctl set param printk=+neterrorHAZE ESR i ar A) BE we LND 假性超时。为避免这种情况，请增加 LNet fe a are区的数量来减少背压，或增加网络上所有节点的LND 超时。同时，也可考虑增加系统中 LNet 路由器节点总数，从而使路由句总从宽与服务器总佛宽相匹配。。 Lustre timeouts 一在未启用上自适应超时时，Lustre 超时可确保了RPC 出现故障时在有限时间内完成。目适应超时默认为司用状态，要在运行时禁用上自适应超时，请在 MGS 上将at_max设置为0:502\nLustre 文件系统操作手册 译者:这ay# Ictl conf param fsname.sys.at_max=0注意在运行时更改目适应超时的状态可能会导致客户端和时的超时、恢复和重连。Lustre 超时的消息将始终打印在控制合上。如果 Lustre 超时未伴随 LND 超时，请增加服务磺和客户端上的 Lustre 超时时间。使用如下命令进行设置:# lctl set param timeout=30Lustre 超时参数 :We数timeoutldlm_ timeoutfail locdump on timeoutdump on eviction39.6. LNet 监控说明客户端等待服务需完成 RPC 的时间 〈软认为 100 秒) 。服务需等竺正明客户端完成了RPC 的时间为此时间的一半，等待单个批量请求〈最多读取或写入 4MB) 完成的时间为此时间的四分之一。客己问在超时时间的四分之一处 ping 可恢复目标 CMDS 和QOST)，服务需将等竺超时时间的一倍半再驱逐客户端、将其设置为\"stale\"。Lustre 客户端定期癌指定的时间段内没有通信的服务需发送\"ping\"消县。文件系统中客户端和服务人逢之间的任何网络话动和 ping 的效用相同。服务如等竺客户端回复初始"
    ]
}