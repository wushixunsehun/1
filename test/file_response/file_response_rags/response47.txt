{
    "query": "处理网络链路断开报警时，若训练端口无效，下一步应如何操作？",
    "summaries": [
        "链路断开时需确定端口位置，区分SWM-NRM、SWM-SWM或SWM-IO类型，使用脚本训练端口或拔插光纤。通道数减少影响带宽但不影响通信，可暂缓处理。握手变化或重传次数过多需关注，但一般不紧急处理。根据报警级别采取相应措施，如绕路由、重启服务器或联系二线处理。",
        "文本主要描述了服务器链路异常的处理方法，包括链路握手变化、重传次数过多、链路断开及通道数减少等问题。对于红色报警（链路断开）和黄色警告（通道数减少），需通过训练端口、拔插光纤、检查FEC、更换NIS卡等方式处理。若lane缺失，可通过执行特定脚本进行训练，并根据寄存器值判断是否恢复。若服务器端口训练无效，则需定位通信板端口并进行进一步训练。处理过程中需记录端口信息并交接给接班人员。",
        "该文本描述了处理通信板端口lane异常的步骤。首先使用`single_port.sh`命令对指定芯片、端口和板卡进行训练，通过输出判断lane是否正常。若训练后仍存在问题，需检查fec配置，并确保其开启。若问题仍未解决，需拔插链路重新训练，或排查光纤、nis卡故障。对于大量链路报警情况，需根据报警位置判断是否为NRM掉电，通过命令查询并drain节点后重启NRM恢复。"
    ],
    "contents": [
        "的板卡掉电，先用绕路由脚本把该板卡绕过去，然后可查询掉电原因，在部门群里通知。如果是ION/IOS板卡掉电，立即联系二线确认影响范围、联系科大更换对应板卡。\n机柜掉电：先联系运维查看供电情况，不清楚影响情况联系二线。\nnetwork故障报警：如果节点不多，值班人员先drain起来即可；如果节点很多，且10分钟仍没有恢复，需要联系二线确认一下。\n5.2.3 链路问题\n5.2.3.1 链路断开\n说明：链路断开先确定位置以及报警的两个端口，即确认是SWM-NRM、SWM-SWM或者是SWM-IO服务器。一般来讲，SxxxxxPUxx链路断开是SWM-NRM；同时SxxxxxPUxx和IOxxxxPUxx链路断开或者IOxxxxPUxx和IOxxxxPUxx断开，是SWM-SWM；IOxxxxPUxx断开是SWM-IO。如果是SWM-IO参考5.2.2服务器链路。\n报警项：SxxxxxPUXX链路连接断开\nS16B02PU13链路断开链接\n\nS16B02PU12链路断开链接\n\nS16A02PU16链路断开链接\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\n管理节点\n\n管理节点\n\n管理节点\n\n硬件\n\n硬件\n\n硬件\n\nPe\n\n° PH\n\n° PH\n处理方法：\n链路断开（握手失败）可以先尝试使用脚本进行端口训练。\n根据报警的PU端口号，对照下图中的芯片+端口号，然后使用脚本进行训练。\n|\n\nCOCORCOSS\n\n| |\n\n2 OO\n\nCOGOTOGOS\n\nCOCORCOOS\n\n2 3Ee\n\nLs]\n\nNI\n\n‘3aEe!\n\nNalBs\n\n25 | 13 | 35 | 36\n[ORR] OCH] TAY\non | os | a5\n\n30H |\n7\npry\n\n[Rer ae SCH] IC\n\nalgloele|\n\nORR] OO] SE\n\n片\n\nR50_0\n\n站\n‘1G [elelslals ss]\n\nR50[2]芯\n\nLas\n\nNT\nKNee\nNE ae\nNd cele\nBal ale\nKN aa 国\n=ma\nsae FF\nia\naa1\nHL 只\nHi ©\nHa\n|\n| RS\nKal\n| Bl\n|",
        "_single_port.sh命令，该命令的参数跟查看lane的命令一样是3个，分别是：芯片号-端口号-板卡号\nCroot@mn30 swum_p\n\nort_train]# ./lanebist_train_single_port.sh\n\n3 31 IONCOSNM10\n\nist set of swm=\nss rs rst (eq_rst) of sum\nist end of swm=\npes soft rst of su\n\nOx01f £00051 1bf{e9|\n\nLb该行倒数第3、4位为e9表示握手成功\n\n9x00000000001023\n\n该行最后1位为f表示lane正常\n训练完后可以从输出上看通信板端口的lane已经恢复。\nion34对应1平面的通信板端口用同样方法训练，然后用（1）中提到的mta_status.sh命令在ion34上进行确认。\nCroot@ion34 “]# cd /root/shelltools_zni/\nCroot@ion34 shelltools_. znilt./mta_status.sh\n\nUNKNOWN (0x420b0)\nUNKNOWN (0x42100)\nport2-fec\nUNKNOHN (0x430b0)\nUNKNOWN (0x43100)\nUNKNOWN (0x43820)\nUNKNOHN (0x43830)\nUNKNOHN (0x43840)\nUNKNOWN (0x43850)\nmtip\n\nUNKNOWN (0x4a340)\nUNKNOHN (0x4a350)\nUNKNOWN (0x44300)\nUNKNOWN (0x46300)\n\nOxb0000\n0x13264]\n\n0x10010\n0x132¢f]\n0x0\n0x0\n0x0\n0x0\n\n0x200\n\n0x1ff00\n0x1ff00\nOx1 fF F00\n\nOF F50\n\nOF F50\n\n100842108421\n0511 bFe904\n0511 bfe904\nion34上两个平面的lane都恢复正常。\n两端训练后仍缺lane\n需要进一步定位是服务器-线缆-通信板哪里的问题，一般分析流程如下：\n注意事项：\n排查过程中，无论哪一步，都要训练两端后再查看状态。\n（3）查看或配置fec\n在/home/test641/smu/cmu_Bin目录，使用以下脚本配置查看或配置fec；其中0表示pcs关fec，1表示开fec；0x0000000000000001表示已关fec，0x0000000000000016表示已开fec：\n[root@mn31%TH3 cmu_Bin]# ./read_fec_or",
        "-/eq_training.sh\n\nCroot@ion34 zni_lane_bist]# cd ..\nCroot@ion34 shelltools_znil# ./mta_status.sh\n\nUNKNOHN(0x420b0)=0xb000006b50\n\nUNKNOHN (03442100)=0x13206\n\nport2-fec\n\nUNKNOHN(0x430b0)=0x1000009F50\n\nUNKNOHN (03443100)=0x3209\n\nUNKNOHN(0x43820)=x0\n\nUNKNOHN(0x43830)=0x0\n\nUNKNOHN(0x43840)=0x0\n\nUNKNOHN(0x43850)=x0\n\nmtip\n\nUNKNOHN(0x42340)=0x200\n\nUNKNOHN(0x42350)=Ox1# 0000842108421\n\nUNKNOHN(0x44300)=0x1ff000511bfe902\n=0x1ff000511afe902\n\nUNKNOWN (0x46300)\n这时候需要对没有恢复lane的平面的通信板端口进行训练，参考下面流程。\n（2）定位通信板端口\n通过服务器上的/etc/sn_zni.id文件找到故障服务器（本例为ion34）对应通信板的端口位置。\n平面0\n\nSIONC10-PU18] ”8107-p31\nion34在/etc/sn_zni.id文件中的对应位置\n端口对应关系如下图：\n3S10NA10-PU18\n\n||Caaamamm eras Si B31\n\nraw\n\neeu\n\nCO SWM10\n\nzl Lela\n\n| A框:C0\nBHE:C1\n\n通信柜-c框:C2\n\n__ D#E:C3\n通信板端口位置为IONC0SWM10板卡上3号芯片的31号端口\n登录管理节点mn30或者mn31，进入目录/home/test641/smu/swm_port_train，执行./znr_lane_port.sh命令，该命令参数有3个，分别是：芯片号-端口号-板卡号\nCroot@mn30 swm_port_train]# ./znr_lane_port.sh 3 31 IONCOSNM10\n\n9x00000000001020\n最后一位非f说明缺lane\n训练通信板端口\n登录管理节点mn30或mn31，进入目录/home/test641/smu/swm_port_train，执行./lanebist_train_single_port.sh命令，该命令的参数跟查看lane的命令一样是3个，分别是：芯片号-端口号-板卡号\nCroot@mn30 swum_p\n\nort_train]# ./",
        "以下脚本配置查看或配置fec；其中0表示pcs关fec，1表示开fec；0x0000000000000001表示已关fec，0x0000000000000016表示已开fec：\n[root@mn31%TH3 cmu_Bin]# ./read_fec_or_pcs_port.sh\n\nusage: ./read_fec_or_pcs_port.sh chip port location\n\neg../read_fec_or_pcs_port.sh 236PO8OCOONRM1/PO80COOCPM1/SOOCOSWM1/IONCOSWMO/IOSCOSWMO\n[root@mn31%TH3 cmu_Bin]# ./config_fec_or_pcs_port.sh\n\nusage: ./config_fec_or_pcs_port.sh chip port location0/1[pcs/fec]\n\neg../config fec or pcs port.sh 233POSOCOONRM1/PO80COOCPM1 1\n目前全部链路的fec都是打开的状态，读取当前链路的fec，如果不是打开的状态，需要配置打开。\n（4）以上操作之后，如果链路还是断开或者缺lane的情况，将链路拔插后训练。需要根据报警的端口和服务器，将两端都拔插之后，再训练。\n（5）以上操作无效的话，考虑是光纤或者服务器的nis卡出了问题，服务器两条光纤交换插入，如果两个口指示灯跟刚才一样，那应该是nis卡的问题，参考ion章节更换nis卡；如果是指示灯亮灭状态有变化，那说明是光纤问题，联系科大或二线。\n5.2.5 swm大量链路报警\n5.2.5.1 每个通信框只有一条链路报警\nmn26\n\nmn26\n\nmn26\n\nmn26\n\nmn26\n\nmn26\n\nS10A09PU05链路断开链接\n\nS11C09PU05链路断开链接\n\nS14C09PU05链路断开链接\n\n509D09PU05链路断开链接\n\nS12C09PU05链路断开链接\n\nS15D09PU05链路断开链接\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\n硬件\n\n硬件\n\n硬件\n\n硬件\n\n硬件\n\n硬件\n\n。 严重\n\n=z\n\n。 严重\n\n=z\n\n。 严重\n\n=z\n每一个通信框有一条报警。大概率是某个NRM掉电，按照流程处理，主要步骤顺序为：通过端口查询",
        "（1）需要训练服务器端口。\n进入目录/root/shelltools_zni/zni_lane_bist，执行./eq_training.sh（同时训练两个端口），等待几秒钟执行完后，返回上层目录，再通过./mta_status.sh查看lane是否恢复。\nCroot@ion33 shelltools_znil# cd /root/shelltools_zni/zni_lane_bist/\n\nLroot@ion33 zni_lane_bist]# 1s\n\n1-bist-set 2-bist-start 3-read_cnt eq_training_only.sh fec_eq-shmta_status.sh\n1.log2. log4-bist—aining.shhss_write_reg_zni\n\n[root@ion33 zni_lane bist 4]. /eq_training.sh |\nport0 set.\nport2 set.\nportd end.\nport2 end.\n\nLroot@ion33 zni_lane_bist]# cd ../\nLroot@ion33 shelltools_: znilt./mta_status.sh\n\nUNKNOHN (0:=b50\nUNKNOHN(0%42100)=0x1320F\n\nport2-fec\nUNKNOWN (0x430b0=0x1000\nUNONNC0X2t60) = xt sao |\n\nUNKNOWN (0x43820)=0x0\n\nUNKNOWN (0x43830)=0x0\n\nUNKNOWN (0x43840)=0x0\n\nUNKNOWN (0x43850)=0x0\n\nmtip\n\nUNKNOWN (0x4a340)=0x200\n\nUNKNOWN (0x4a350)=Ox1f£0000842108421,\nUNKNOWN (0x44300)=Ox1ff000511bf e902\nUNKNOWN (0x46300)=Ox1ff000511bf e902\n服务器端口训练完后，如果lane恢复，则处理完成。\n有时遇到训练完后lane仍然缺少的情况，如下图所示在ion34上两个端口训练后lane都没有恢复：\nCroot@ion34 shelltools_znil# cd zni_lane_bisty\n\n[rooteion34 zni_lane_bist]#|\n\nport0 set.\nport2 set.\nport0 end.\nport2 end.\n\n-/eq_training.sh\n\nCroot@ion34 zni_lane_bist]# cd ..\nCroot@ion34 shelltools_znil# ./mta_status.sh\n\nUNKNOHN(0x420b0)=",
        "Nd cele\nBal ale\nKN aa 国\n=ma\nsae FF\nia\naa1\nHL 只\nHi ©\nHa\n|\n| RS\nKal\n| Bl\n| selk\n-一全\n\nLaz} a2 | 10 | 22 | 20 | 22 | 23\n./lanebist_train_opposite_port.sh+芯片号+端口号+板卡号 可以同时训练此端口和对端。\n[root@mn31%TH3 ~]# cd /home/test641/smu/nrm_port_train/\n[root@mn31%TH3 nrm_port_train]# ./lanebist_train_opposite_port.sh 2 6 S05C0SWM1\n[root@nn31%TH3 nrm_port_train]# ./lanebist_train_opposite_port.sh 3 6 P699C92NRM1\n\nlanebist train PCB P699C92NRM1 3:0----2:6 S95C9SWM1\n0x01ff000511b8该行倒数3、4位是e9表示握手成功 (MISES) , eM ERIKS.\n\n6x000000000032014T) 该行最后一位是f表示通道数正常 (网络带席正常) ，非债示带遍小，但不影响网络通信\n如果上述操作处理不好，可以根据端口号去机房拔插一下两端的光纤线。参考5.2.1.4使用脚本swm_opposite_port.sh查询对端，并将芯片+端口转换成PU的格式（参考5.2.1.3），在机柜上寻找对应的标签。以上面的例子来说：\n3 0 P009C02NRM1 对应P009C02NRM1PU20\n2 6 S05C0SWM1 对应 S05C0SWM1PU08\n在机房分别拔插这两个端口。要把两端的线都拔掉，再依次插上。再重复一次（1）中的操作。\n如果拔插还是不行，联系科大641处理。\n5.2.3.2 链路通道数减少\n报警项（黄色警告）：xx通道数减少\nS02A02PU22,通道数减少\n\nTH-3F\n\n管理节点\n\n硬件\n与5.2.3.1处理方法一样，但是一般不着急处理，通道数减少只影响带宽，并不影响链路的通断。\n5.2.3.3 链路握手变化/重传次数过多\n报警项（黄色警告）：xx链路端口握手变化/xx链路端口重传次数",
        "_read.sh\n[root@nn31%TH3 swm_port_train]# ./swm_train_read.sh S94C2SwWM1\n- S94C2SwM1-9 =\n- Se4C2SWM1-1 -\n\nP@11CO1NRM1\nP@13COONRM1\nP@13CO1NRM1\nP@13CO2NRM1\nP@13CO3NRM1\nP@14COONRM1\nP@14CO1NRM1\nP@14CO2NRM1\nP@14CO3NRM1\n<=port no used.\n\nf\nf\nf\nf\nf\nf\nf\nf\nf\n0\n以上“14 0”、“14 f”表示链路断开。\n5.2.2 网络报警一些说明\n0平面普通通信机柜（S00-S07）单条链路断开报警，报警级别是警告，值班人员无需立即处理，可以尝试训练链路或拔插光纤。累计4条以上警告会触发红报警，值班人员需要注意。\n1平面普通通信机柜（S09-S16）单条链路断开报警，报警级别是严重，需要立即处理，可以尝试训练链路或拔插光纤，拔插无效可以通过路由容错（绕路由）脚本（参考5.2.9）将该框先绕过去。\nION/IOS通信机柜链路报警，单条链路或多条链路断开，确认是通信机柜互联还是连接服务器的端口。如果是通信机柜互联，一般需要立即处理，需要确认是否有板卡掉电，若无掉电，需要训练链路或拔插光纤；若是服务器端口，需要确认对应服务器是否死机，若服务器死机则重启服务器，若未死机只有高速网有问题，则查找服务器的光纤端口，进行拔插。\nNRM掉电：影响本框作业，判断板卡位置，S00-S07每框有一条链路断开即为0平面nrm掉电，可以按照手册处理，此时节点通信还在，只要不是读写高的作业都能拯救，如果恢复不成功，需要报告二线处理；如果报警是S09-S16每框一条链路，那么是1平面nrm掉电，对应框的作业已经掉了，可以尝试按照手册处理，第二天再报告二线即可。\nSwm掉电：查询掉电板卡位置，如果是S00~S07、S09~S16机柜的板卡掉电，先用绕路由脚本把该板卡绕过去，然后可查询掉电原因，在部门群里通知。如果是ION/IOS板卡掉电，立即联系二线确认影响范围、联系科大更换对应板卡。\n机柜掉电：",
        "严重\n\n=z\n\n。 严重\n\n=z\n\n。 严重\n\n=z\n每一个通信框有一条报警。大概率是某个NRM掉电，按照流程处理，主要步骤顺序为：通过端口查询到具体的NRM，先将这一计算框内全部节点drain起来，再重启NRM处理恢复。\n使用yhst+ NRM板卡编号可以查看该框的板卡加电状态，如果nrm显示0表示掉电。\ndrain相关节点、挂作业：在对应的管理服务器上drain上相关的节点。\n具体命令为：ccst+机框号，例如需要drain的机框为16机柜A框：使用命令ccst 16a来获取该框所有的节点。\n将其中的idle节点和alloc节点drain起来，节点涉及的作业挂起来。\nyhq -w $alloc_list\nyhcontrol suspend $jobid\n5.2.5.2 报警集中在某个柜或者某个框\nmn26\n\nmn26\n\nmn26\n\nmn26\n\nmn26\n\nmn26\n\nmn26\n\nmn26\n\n措述\n\nS12B02NR1PORT26链路断开链接\n\nS12B03NROPORT17链路断开链接\n\nS12B07NR1PORT39链路断开链接\n\nS12B03NROPORT14链路断开链接\n\nS12B07NR1PORT28链路断开链接\n\nS12B03NROPORT18链路断开链接\n\nS12B01NR1PORT10链路断开链接\n\nS12B02NR1PORT22链路断开链接\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\n管理节点\n\n管理节点\n\n管理节点\n\n类型\n\n硬件\n\n硬件\n\n硬件\n\n硬件\n\n硬件\n\n硬件\n\n硬件\n\n硬件\n\n。 严重\n\n。 严重\n\n。 严重\n\n。 严重\n\n。 严重\n\n。 严重\n\n。 严重\n\n。 严重\n从上图判断，可能是S12B框有个板卡掉线，通过yhst查看该框状态。\nmn26\n\nmn26\n\nmn26\n\nmn26\n\nmn26\n\nmn26\n\nmn26\n\n措述\n\nS14C09PU05链路断开链接\n\nS14C08PU30链路断开链接\n\nS14C09PU02链路断开链接\n\nS14C09PU00链路断开链接\n\nS14C09PU01链路断开链接\n\nS14C09PU03链路断开链接\n\nS14C09PU04链路断开链接\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\nTH-3F\n\nTH-3F",
        "一般不着急处理，通道数减少只影响带宽，并不影响链路的通断。\n5.2.3.3 链路握手变化/重传次数过多\n报警项（黄色警告）：xx链路端口握手变化/xx链路端口重传次数过多\nS01COOPU04 握手次数发生变化\n\nTH-3F\n\n管理节点\n\n硬件\n如果报警比较频繁的话，联系科大641科室，或者把对应两端口的线拔下来，记录好对应端口，交班的时候跟接班人员交代一下，接班人员将两端插好，执行5.2.3.1中（1）操作。\n5.2.4 服务器链路断开/通道数减少\n报警项（红色）：IONxx链路断开（同时可能会有很多oss to ion route不通、89.72.106.xx路由down）\n报警项（黄色警告）：IONxx链路通道数减少\n带高速网的服务器包括：MN节点、SMU节点、ION节点、LN节点。\n断开处理操作步骤：训练端口，拔插光纤，查看fec，更换nis卡。\n检测服务器端的lane是否正常\n登录服务器，进入目录/root/shelltools_zni，执行./mta_status.sh\n[rooteion33“]# cd /root/shelltools_zni/\nCroot@ion33 shelltools_znil# ./mta_status.sh\nUNKNOWN (0x420b0)Oxf0005f50\n\nUNKNOWN CO:\nport2-fec\nUNKNOHN CO:\nUNKNOHN CO:\n\n42100)\n\n0x10205\n\n430b0)\n\n0x8b50\n\n43100)\n\n0x8\n\nUNKNOWN (0x43820)\nUNKNOWN (0x43830)\nUNKNOWN (0x43840)\nUNKNOWN (0x43850)\n\nmtip\n\nUNKNOWN (0x4a340)\nUNKNOWN (0x4a350)\nUNKNOWN (0x44300)\n\nUNKNOWN (0x46300)\n\n0x0\n0x0\n0x0\n0x0\n\n0x200\nOx1FF0000842108421\nOx1Ff000511bff\nOx1ff000511.\n观察寄存器42100（0平面）和43100（1平面）的值的最后一位，如果不为f，说明缺少lane。\n最后两行如果不是e9就是链路断开。\n链路断开和缺lane可以通过以下步骤来解决：\n（1）需要训练服务器端口。\n进入目录/root/shelltools_zni/zni_lane_bist，执行./eq_training.sh（同时训练两个端口），等待几秒钟执行完后，返回上层目录，再"
    ]
}