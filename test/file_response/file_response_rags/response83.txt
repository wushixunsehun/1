{
    "query": " Lustre文件系统如何通过设置 changelog_mask 精细控制Changelog日志的采集范围？在哪些场景下需要这样做？",
    "summaries": [
        "Lustre 文件系统中的 Changelogs 用于记录文件系统操作。用户可通过 lctl 和 lfs 命令注册、注销和清除 Changelog 用户。注销操作会清除该用户的记录。Changelog 记录包含操作类型、时间戳、用户信息等。通过 lfs changelog 可以显示记录，而设置 changelog_mask 可控制记录的操作类型。Changelogs 还可用于审计，以跟踪和评估系统操作。",
        "Lustre 文件系统可通过添加 OST 或客户端进行扩展，使用 `mkfs.lustre` 和 `tunefs.lustre` 等工具进行配置。文件布局默认为 1MB 条带大小，可通过 `lfs setstripe` 修改。Lustre 支持故障切换，但需依赖外部 HA 软件如 Corosync 和 Pacemaker 实现高可用性。故障切换需配置 RPC 设备和电源管理工具，如 PowerMan 或 STONITH。每个存储目标需与备用节点配对，并通过 `mkfs.lustre` 指定服务节点以实现故障转移。",
        "Lustre 文件系统操作手册摘要：系统参数设置中，device 会被忽略，删除参数将使用默认值。停用导入后需重新激活，此设置在重启后生效。建议使用 lctl {get, set, list} param 以提高可移植性。Lustre 可在常规文件上模拟虚拟块设备，通过 blockdev_attach 等命令管理。Changelog 用于记录文件系统操作，注册和注销用户需注意空间占用。调试选项包括启动调试守护程序、转储日志等。ll_decode_filter_fid 工具用于解码 OST 对象信息，帮助恢复文件布局。"
    ],
    "contents": [
        "一changelog_deregister id 注销现有的 changelog 用户。如果用户的\" 清除\" 记录号是该设备的最小值，则 changelog 记录将被清除，直到出现下一个设备最小值。调试选项debug daemondebug kernel [file] [raw]debug file input_file [output _ file]clearmark textfilter subsystem _id|debug_maskshow subsystem _id|debug_maskdebug list subsystems|typesmodules path说明启动和停止调试守护程序，并控制输出文件名和大小。将内核调试缓冲区转储到 stdout 或文件中。将内核转储的调试日志从二进制转换为纯文本格式。BRA AVA ih在内核调试缓冲区中插入标记文本。通过子系统或担码过滤内核调试消息。显示特定类型的消息。列出所有子系统和调试类型。提供 GDB 友好的模块信息。300\n——Lustre 文件系统操作手册 译者:这ay选项 说明44.3.4. 选项使用以下选项调用 lct。选项 说明--qevice 用于操作的设备《由名称或编号指定)。请参阅 device list。--ignore errors | ignore errors ， 在脚本处理期间忽略错误。44.3.5. 示例letl$ letlIctl > dl0 UP mgc MGC192.168.0.20@tcp btbb24e3-7deb-2f fa-eab0-44dffe00F692 51 UP ost OSS OSS _uuid 32 UP obdfilter testfs-OSTO000 testfs-OSTOO000 UUID 3lctl > dk /tmp/log Debug log: 87 lines, 87 kept, 0 dropped.letl > quit也可参见\"14. mkfs.lustre\", \"15. mount.lustre\", \"3. Ictl\".44.4. ll_decode_filter_fidll_ decode filter fid 实用程序用于显示 Lustre 对象ID 和MDT 的父FID。44.4.1. 梗概11 decode filter fid object file [object file ...]44.4.2. 说明lL_ decode filter fid 实用程序为指定 OST 对象解码并打印 Lustre OST 对象ID、MDTFID 和条带索引，这些信息存储在每个",
        "。利用这些脚本您可以快速设置一些简单的标准 Lustre 配置。第十一章 Lustre 故障切换配置11.1. 故障切换环境设置Lustre 软件提供了在 Lustre 文件系统层面的故障切换机制，但没有提供完整的故障切换解雇方案。一般来说，完整的故障切换解雇方案会为失效的系统级别组件提供故障切换功能，例如切换失效的硬件或应用，甚至切换失效的整个节点。但是 Lustre 没有提供这部分功能。诸如节点监视、故障检测和资源保护等故障切换功能必须由外部 HA 软件提供，例如 PowerMan，或由 Linux 操作系统供应商提供的开源 Corosync 和 Pacemaker软件包。其中，Corosync 提供了检测故障的文持，Pacemaker 则在检测到故障后采取行动。11.1.1 选择电源设备Lustre 文件系统中的故障切换需要使用远程电源控制 (Remote Power Control, RPC)机制，它具有多种配置。例如，Lustre 服务器节点可能配备了文持远程电源控制的IPMI/BMC 设备。我们不推荐使用过去一度稼见的相关软件。有关推荐的设备，请参阅PowerMan 集群电源管理工具网站上的RPC 支持设备列表。11.1.2 选择电源管理软件在将 IO 重定癌到故障转移节扣之前，需要验证故障节氮已经关闭，Lustre we hii V7)换机制需要 RPC 和管理功能软件来验证这一点。这样可以避免重复在两个节点上挂载同一个服务，产生不可逆的数据损坏风险。Lustre 可使用很多不同的电源管理工具，但最常见的两个软件包是 PowerMan 和 Linux-HA (又名STONITH ) 。PowerMan 集群电源管理工具可用于集中控制 RPC 设备。它为多种 RPC 提供了原生文持，甚专家级的配置简化了新设备添加操作。 (最新版本的 PowerMan)STONITH (Shoot The Other Node In The Head) 是一套电源管理工具，早在 Red Hat103\n1234Lustre 文件系统操作手册 译者:As大Enterprise Linux 6 之前就已经包含在 Linux-HA 包中。Linux-HA 对许多电源控制设备具备原生文持，具备可扩展性〈使用 Expect 脚本来进行目动化控制)，提供了相关软件来检测和处置故障。Red Hat Enterprise Linux",
        ":0x50:0xb] mdd_obd-lustre-MDT0000-0注意MARK 记录表明了 Changelog 记录状态变化。112\n——ULDNn—ULDNn—ULDLustre 文件系统操作手册 译者:这ay”显示 Changelog 索引及注册用户显示某个设备 (lustre-MDR0000) 上的当前最大 Changelog 索引及已注册的 Changelog用户:mds# lctl get param madqdq.1ustrerMDT0000.chnangelog Usersmdd.lustre-MDTO000.changelog users=current index: 8ID index (idle seconds)cl2 8 (180)。 显示 Changelog #44,在某个设备上 (lustre-MDRO000) 显示当前 Changelog #549 :mds# lctl get Param mdd.lustre-MDTO0000.changelog maskmdd.lustre-MDTO000.changelog_mask=MARK CREAT MKDIR HLINK SLINK MKNOD UNLNK RMDIR RENME RNMTO CLOSE LYOUT \\TRUNC SATTR XATTR HSM MTIME CTIME MIGRT。 设置 Changelog #44,在某个设备上 (lustre-MDRO0000) 设置 Changelog #805:mds# lctl set param mdd.lustre-MDT0000.changelog_mask=HLINKmdd.lustre-MDTO000.changelog_mask=-HLINK$ lis changelog clear lustre-MDTO000 cll 0S mkdir /mnt/lustre/mydir/fooS cp /etc/hosts /mnt/lustre/mydir/foo/fileS In /mnt/lustre/mydir/foo/file /mnt/lustre/mydir/myhardlinkATMS HE AY A RANA TE Changelog 中显示:S lfs changelog lustre-MDTO0009 O3HLINK 16:06:35.291636498 2018.01.09 0x0 t=[0x200000402: 0x4:0x0] ef=Oxf \\u=500:500 nid=10.128.11.159@tcp p=[0x200000007: 0x3:0x0] myhardLlink12.1.3 Changelogs 审计Lustre Changelogs 的一个特殊用例是审计。根据其在维基百科上的定义，信息技术审计被用来评估机构的信息资产保护及合理分发信息至授权机构的能力。基本上，饭根113\nLustre 文件系统操作手册 译者:这aXTe 4 Wa oh NS MT A OC TET",
        "对于系统范围的参数，device 将被忽略。删除参数设置〈下次重司时使用默认值)。将值设置为空也会删除参数设置。在停用操作后重新激活导入。此设置仅在重新启动后有效 Chil conf param).停用导入，特别是不要将新文件条囊分配给OSC。在MDS 上运行1ct1 deactivate会在OST上阻正其分配新对象。在 Lustre 各户端上运行lctl deactivates SMe (VE IA] OST 上对象时返回 -EIO AN EFAS KE在重新司动 MDT Bk OST 时中止恢复过程。使用 procf 接口并不总是可以访问 Lustre 可调参数，这取诀于平台。而 Lct1{get,set,list} param可作为独立于平台的解雇方案，从而避免直接引用/proc/{ffsvsys}j/{lustre, LInet}。考虑到未来使用过程中的可移植性，请使用LIctl {get,set,list} param.虚拟块设备操作Lustre 可以在常规文件上模拟虚拟块设备。当您尝试通过文件设置空间交换时，需要使用此功能。选项blockdev_attachfilename/dev/lloop device说明EH IL Lustre 文件添加到块设备。如果设备贡点不存在，则使用1ct1创建它。由于模拟需使用的是动态主纺号，我们建议您使用Ict1s创建设备 点 °blockdev_ detach /dev/lloop device 删除虚拟块设备。blockdev_info /dev/lloop device 提供有关附加到设备节点的 Lustre 文件的售=|Ju O559\nLustre 文件系统操作手册这ay选项Changelogs说明选项 说明changelog_register 为特定设备注册新的 changelog 用户。每个文件系统操作发生时，相应 changelog 条目将永久保存在MDT 上，仅在超出所有注册用户的最小设置点时进行清除〈请参阅1fs changelog _ clear)。如果 changelog 用户注册了却从不使用这些记录，则可能导致 cnangelog 占用大量空间，最终填满 MDT。一~ 一changelog_deregister id 注销现有的 changelog 用户。如果用户的\" 清除\" 记录号是该设备的最小值，则 changelog 记录将被清除，直到出现下一个设备最小值。调试选项",
        "15:27 ..8.0M -rw-r--r-- 1 root root 8.0M Oct 16 15:27 zero.dat当 Lustre 文件系统配置完成，则可投入使用。103\nLustre 文件系统操作手册 译者:这ay10.2. 其他附加配置选项这一部分我们将介绍如何扩展 Lustre 文件系统并利用 Lustre 配置实用程序更改配置。10.2.1. 扩展 Lustre 文件系统Lustre 文件系统可以通过诡加 OST 或客户端来进行扩展。如须创建附加 OST，请参照上述步又3 和步骤 5 的说明。如须安装更多客户站，请为每个客尸端重复执行步又6。10.2.2. 更改条带化默认配置文件布局条带类型的默认配置如下表所示:文件布局参数 默认值 ”说明stripe size 1 MB 在移到下一个OST 之前写入一个OST 的数据量。stripe_count | 单个文件所使用的 OSTs 个数。start ost -1 每个文件用于创建对象的首个 OST。默认值为 -1，人允许 MDS根据可用空间和负载平衡来选择起始索引。强烈建议不要将此参数的默认值更改为 -1 以外的值。使用1fs setstripe来更改文件布局配置。10.2.3. 使用 Lustre 配置实用程序如须进行其他附加配置，Lustre 提供了一些实用的配置工具:。 mkfs.lustre: 用于为 Lustre 服务器格式化磁艳。。tunefs.Iustre: 用于在 Lustre 目标磁盘上修改配置信息。\"lct1: 用于通过 ioctl 接口直接控制 Lustre 功能，人允许访问各种配置、维护和调试功AbHE o* mount.lustre: 用于启动 Lustre 客户端或目标服务器。104\nLustre 文件系统操作手册这aX实用程序 本 可用来配置和查询有关文件的一些不同选项功能。注意一些示例脚本可在 Lustre 软件安装目录中找到。如您安装了 Lustre 源代码，则脚本位于 luster /tests 子目录中。利用这些脚本您可以快速设置一些简单的标准 Lustre 配置。第十一章 Lustre 故障切换配置11.1. 故障切换环境设置Lustre 软件提供了在 Lustre 文件系统层面的故障切换机制，但没有提供",
        "object file ...]44.4.2. 说明lL_ decode filter fid 实用程序为指定 OST 对象解码并打印 Lustre OST 对象ID、MDTFID 和条带索引，这些信息存储在每个 OST 对象的\"trusted.fid\" 属性中。当 OST 文件系统在本地挂载为 ldiskfs 类型时，可通过1L_ decode filter fid 访问。561\nLustre 文件系统操作手册 译者: 李硕\"trusted.fid\" 扩展属性在首次修改 〈数据写入或属性集) 时即被存储在 OST 对象上，并在此之后不可被 Lustre 访问或修改。即使通滑情况下LFSCK 可以重建整个OST 对象目录层次结构, OST 对象ID (objid)在OST 目录损坏的情况下仍非角有用。MDS FID 可用于确定 OST 对象所使用的 MDSinode。条于索引可以在 MDT inode 丢失的情况下联合其他 OST 对象来重建文件布局。44.4.3. 示例—root@ossl# cd /mnt/ost/lost+found2 root@ossl# 11 decode filter fid #12345([4,5, 8]ULD#123454: objid-690670 seq=0 parent=[0x751c5: Oxfce6e605: 0x0]&#123455: objid-614725 seq=0 parent=[0x18d11: Oxebba84eb: 0x1]Nn#123458: objid=533088 seq=0 parent=[0x21417:0x19734d61: 0x0]上面的例子中显示了 lost + found 中的三个十进制对象 ID “y 690670. 614725 和533088 的文件。当前所有 OST 对象的对象序列号 〈以前的对象组) 为 0。MDT 父节点FID 是序列格式为oidq:idx的十六进制数。由于在所有这些情况下序列号都低于 0x100000000，因此 FID 位于传统的 mode 和 Generation In FID (IGIF) 命名空间中，并直接映射到 MDT inode = seq 和 generation = oid 值， MDT inode 分别为Ox751c5. Ox18d11 和 0x21417。对于 MDT 父序列号大于 0x200000000 的对象，",
        "-HA 包中。Linux-HA 对许多电源控制设备具备原生文持，具备可扩展性〈使用 Expect 脚本来进行目动化控制)，提供了相关软件来检测和处置故障。Red Hat Enterprise Linux 6 之后，Linux-HA 在开源社区被 Corosync 和|Pacemaker 的组合所取代。Red Hat Enterprise Linux 用户可以从 Red Hat 获得使用 CMAN的集群管理功能。11.1.3 选择高可用性软件Lustre 文件系统必须设置高可用性 (HA) 软件以启用完整的 Lustre 故障切换解决方案。上述 HA 软件包，除了 PowerMan 之外，都同时提供了电源管理和集群管理。使用Pacemaker 来设置故障转移，请参阅:。 Pacemaker 项目网站。在 Lustre 文件系统中使用 Pacemaker 详解11.2. Lustre 文件系统故障切换的准备工作为使 Pustre 文件系统其具备高可用性，我们通过第三方 HA 应用程序对其进行配置和管理。每个存储目标 (MGT, MGS, OST) 都必须与另一个备用节点相关联，以创建故障切换对。当客户端挂载文件系统时，此配置信息由 MGS 传送给客户端在挂载存储目标时，其配置信息会转发 MGS。与此相关的一些规则是;。初次挂载目标时，MGS 从目标读取配置信息 〈诸如 mgt vs. ost, failnode, fsname) ，并将该存储目标配置到 Lustre 文件系统上。如果 MGS 是首次读取到这一挂载配置，则该节点将成为该存储目标的\" 主\" 节点。。再次挂载目标时，MGS 从目标读取当前配置，并根据需要重新配置 MGS 数据库里的目标信息使用mkfs .1ustre命令格式化目标时，通过--servicenode选项来指定目标的故障切换服务节氮。在下面的示例中，文件系统 testfs 中编号为0 的 OST 被格式化，两个服务节点被指定成该 OST 的故障切换对:mkfs.lustre —-reformat --ost --fsname testfs --mgsnode=192.168.10.1@o03ib \\--index=0 —-servicenode=192.168.10.7@o2ib \\-—-servicenode=192.168.10.8@o2ib \\/dev/sdb106\nLustre 文件系统",
        "lctl 命令在MDT 节Fa _ETEM当所有 changelog 用户处理完成了某个节点之前的记录时，记录被完全删除。12.1.1.4 Lect1 changelog deregister 注销 changelog 用户 ，请运行:lctl --device mdt_ device changelog deregister useridchangelog deregister cll 在完成注销操作时，相当于快速执行了 lfs changelog clearcll 0 命令。12.1.2 Changelogs 命令示例以下是一些不同的 Changelogs 命令的示例。 注册 Changelog 用户为某个设备 (lustre-MDT0000) 注册一个新的 Changelog HF:mds# lJctl --device lustre-MDT0000 changelog registerlustre-MDTO000: Registered changelog userid ‘'cll'。 显示 Changelog 记录在MDT 上显示 Changelog 记录 :S lfs changelog lustre-MDTO0001 O2MKDIR 15:15:21.977666834 2018.01.09 0x0 t=[0x200000402: 0x1:0x0] ef=Oxf \\u=500:500 nid=10.128.11.159@tcp p=[0x200000007: 0x1:0x0] pics2 O1CREAT 15:15:36.687592024 2018.01.09 0x0 t=[0x200000402: 0x2:0x0] ef=Oxf \\u=500:500 nid=10.128.11.159@tcp p=[0x200000402: 0x1:0x0] chloe.jpg3 O6UNLNK 15:15:41.305116815 2018.01.09 0x1 t=[0x200000402: 0x2:0x0] ef=Oxf \\u=500:500 nid=10.128.11.159@tcp p=[0x200000402: 0x1:0x0] chloe.jpg4 O7RMDIR 15:15:46.468790091 2018.01.09 0x1 t=[0x200000402: 0x1:0x0] ef=Oxf \\u=500:500 nid=10.128.11.159@tcp p=[0x200000007: 0x1:0x0] picsChangelog 记录包含了如下信息:LeCHoperation type (numerical/text)timestampdatestamp111\nLustre 文件系统操作手册%my这ay5 flags6 t=target FID7 ef-extended_flags8 u=uid:gid9 nid=client NID10 p=parent FID11 target name显示格式为:—rec# operation type",
        "my这ay5 flags6 t=target FID7 ef-extended_flags8 u=uid:gid9 nid=client NID10 p=parent FID11 target name显示格式为:—rec# operation type (numerical/text) timestamp datestamp flags t=target FID \\2 ef=extended_flags u-uid:gid nid-client NID p=parent_FID target name如:2 O1CREAT 15:15:36.687592024 2018.01.09 0x0 t=[0x200000402: 0x2:0x0] ef=Oxf \\—2 u=500:500 nic=10.128.11.159%@tcp p=[0x200000402:0x1:0x0] chloe.jpg。 清除 Changelog 记录通知设备某个特定用户 (cll) 已经不需要相关记录 (3 及3 之前的):$ lfs changelog clear lustre-MDT0000 cll 3确认 changelog clear 操作成功，运行 Ifs changelog。我们看到只显示了 id-3 以后的SA:S lfs changelog lustre-MDTO000—2 4 O7RMDIR 15:15:46.468790091 2018.01.09 0x1 t=[0x200000402: 0x1:0x0] ef=Oxf \\ULDu=500:500 nid=10.128.11.159%tcp p=[0x200000007:0x1:0x0] pics。 注销 Changelog 4在革个设备上 (lustre-MDRO000) 注销革个 Changelog 用户 (cll):1 mds# lctl --device lustre-MDT0000 changelog deregister cll2 lustre-MDTOO00: Deregistered changelog user 'cll'注销操作清除了该用户所有 Changelog 记录。1 $ 1Lfs changelog Lustre-MDT00002 5 OOMARK 15:56:39.603643887 2018.01.09 0x0 t=[0x20001: 0x0: 0x0] ef=Oxf \\3 u=500:500 nid=0@<0:0> p=[0:0x50:0xb] mdd_obd-lustre-MDT0000-0注意MARK 记录表明了 Changelog 记录状态变化。112\n——ULDNn—ULDNn—ULDLustre 文件系统操作手册 译者:这ay”显示 Changelog"
    ]
}